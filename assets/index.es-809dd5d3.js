import{a as S1,c as x1,e as P1,h as O1,j as C1,k as A1,l as R1,m as T1,n as N1,o as $1,r as gr,t as Ci,s as F1,v as ue,w as D1,x as Df,y as To,z as Lf,A as Uf,B as jf,D as L1,E as kc,G as Mf,H as qf,I as U1,J as zf,K as j1,L as M1,M as q1,R as z1,_ as k1,N as Oc,U as B1}from"./app-0b588ede.js";import"./index-d08623ec.js";function Bc(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function kf(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Bc(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function Cc(n,t){t||(t=n.reduce((a,u)=>a+u.length,0));const r=kf(t);let s=0;for(const a of n)r.set(a,s),s+=a.length;return Bc(r)}const nl={...S1,...x1,...P1,...O1,...C1,...A1,...R1,...T1,...N1,...$1};function Bf(n,t,r,s){return{name:n,prefix:t,encoder:{name:n,prefix:t,encode:r},decoder:{decode:s}}}const sl=Bf("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),uc=Bf("ascii","a",n=>{let t="a";for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return t},n=>{n=n.substring(1);const t=kf(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}),Hf={utf8:sl,"utf-8":sl,hex:nl.base16,latin1:uc,ascii:uc,binary:uc,...nl};function yr(n,t="utf8"){const r=Hf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Bc(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}function or(n,t="utf8"){const r=Hf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8"):r.encoder.encode(n).substring(1)}var ol=globalThis&&globalThis.__spreadArray||function(n,t,r){if(r||arguments.length===2)for(var s=0,a=t.length,u;s<a;s++)(u||!(s in t))&&(u||(u=Array.prototype.slice.call(t,0,s)),u[s]=t[s]);return n.concat(u||Array.prototype.slice.call(t))},H1=function(){function n(t,r,s){this.name=t,this.version=r,this.os=s,this.type="browser"}return n}(),V1=function(){function n(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return n}(),K1=function(){function n(t,r,s,a){this.name=t,this.version=r,this.os=s,this.bot=a,this.type="bot-device"}return n}(),W1=function(){function n(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return n}(),G1=function(){function n(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return n}(),J1=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Q1=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,al=3,Y1=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",J1]],cl=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function X1(n){return n?ul(n):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new G1:typeof navigator<"u"?ul(navigator.userAgent):tb()}function Z1(n){return n!==""&&Y1.reduce(function(t,r){var s=r[0],a=r[1];if(t)return t;var u=a.exec(n);return!!u&&[s,u]},!1)}function ul(n){var t=Z1(n);if(!t)return null;var r=t[0],s=t[1];if(r==="searchbot")return new W1;var a=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);a?a.length<al&&(a=ol(ol([],a,!0),rb(al-a.length),!0)):a=[];var u=a.join("."),f=eb(n),g=Q1.exec(n);return g&&g[1]?new K1(r,u,f,g[1]):new H1(r,u,f)}function eb(n){for(var t=0,r=cl.length;t<r;t++){var s=cl[t],a=s[0],u=s[1],f=u.exec(n);if(f)return a}return null}function tb(){var n=typeof process<"u"&&process.version;return n?new V1(process.version.slice(1)):null}function rb(n){for(var t=[],r=0;r<n;r++)t.push("0");return t}const ib={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};var Bt={},nb={get exports(){return Bt},set exports(n){Bt=n}},wn=typeof Reflect=="object"?Reflect:null,hl=wn&&typeof wn.apply=="function"?wn.apply:function(t,r,s){return Function.prototype.apply.call(t,r,s)},wo;wn&&typeof wn.ownKeys=="function"?wo=wn.ownKeys:Object.getOwnPropertySymbols?wo=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:wo=function(t){return Object.getOwnPropertyNames(t)};function sb(n){console&&console.warn&&console.warn(n)}var Vf=Number.isNaN||function(t){return t!==t};function Be(){Be.init.call(this)}nb.exports=Be;Bt.once=ub;Be.EventEmitter=Be;Be.prototype._events=void 0;Be.prototype._eventsCount=0;Be.prototype._maxListeners=void 0;var ll=10;function No(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(Be,"defaultMaxListeners",{enumerable:!0,get:function(){return ll},set:function(n){if(typeof n!="number"||n<0||Vf(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");ll=n}});Be.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Be.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Vf(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Kf(n){return n._maxListeners===void 0?Be.defaultMaxListeners:n._maxListeners}Be.prototype.getMaxListeners=function(){return Kf(this)};Be.prototype.emit=function(t){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);var a=t==="error",u=this._events;if(u!==void 0)a=a&&u.error===void 0;else if(!a)return!1;if(a){var f;if(r.length>0&&(f=r[0]),f instanceof Error)throw f;var g=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw g.context=f,g}var E=u[t];if(E===void 0)return!1;if(typeof E=="function")hl(E,this,r);else for(var N=E.length,T=Yf(E,N),s=0;s<N;++s)hl(T[s],this,r);return!0};function Wf(n,t,r,s){var a,u,f;if(No(r),u=n._events,u===void 0?(u=n._events=Object.create(null),n._eventsCount=0):(u.newListener!==void 0&&(n.emit("newListener",t,r.listener?r.listener:r),u=n._events),f=u[t]),f===void 0)f=u[t]=r,++n._eventsCount;else if(typeof f=="function"?f=u[t]=s?[r,f]:[f,r]:s?f.unshift(r):f.push(r),a=Kf(n),a>0&&f.length>a&&!f.warned){f.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=n,g.type=t,g.count=f.length,sb(g)}return n}Be.prototype.addListener=function(t,r){return Wf(this,t,r,!1)};Be.prototype.on=Be.prototype.addListener;Be.prototype.prependListener=function(t,r){return Wf(this,t,r,!0)};function ob(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Gf(n,t,r){var s={fired:!1,wrapFn:void 0,target:n,type:t,listener:r},a=ob.bind(s);return a.listener=r,s.wrapFn=a,a}Be.prototype.once=function(t,r){return No(r),this.on(t,Gf(this,t,r)),this};Be.prototype.prependOnceListener=function(t,r){return No(r),this.prependListener(t,Gf(this,t,r)),this};Be.prototype.removeListener=function(t,r){var s,a,u,f,g;if(No(r),a=this._events,a===void 0)return this;if(s=a[t],s===void 0)return this;if(s===r||s.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete a[t],a.removeListener&&this.emit("removeListener",t,s.listener||r));else if(typeof s!="function"){for(u=-1,f=s.length-1;f>=0;f--)if(s[f]===r||s[f].listener===r){g=s[f].listener,u=f;break}if(u<0)return this;u===0?s.shift():ab(s,u),s.length===1&&(a[t]=s[0]),a.removeListener!==void 0&&this.emit("removeListener",t,g||r)}return this};Be.prototype.off=Be.prototype.removeListener;Be.prototype.removeAllListeners=function(t){var r,s,a;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var u=Object.keys(s),f;for(a=0;a<u.length;++a)f=u[a],f!=="removeListener"&&this.removeAllListeners(f);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=s[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(a=r.length-1;a>=0;a--)this.removeListener(t,r[a]);return this};function Jf(n,t,r){var s=n._events;if(s===void 0)return[];var a=s[t];return a===void 0?[]:typeof a=="function"?r?[a.listener||a]:[a]:r?cb(a):Yf(a,a.length)}Be.prototype.listeners=function(t){return Jf(this,t,!0)};Be.prototype.rawListeners=function(t){return Jf(this,t,!1)};Be.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):Qf.call(n,t)};Be.prototype.listenerCount=Qf;function Qf(n){var t=this._events;if(t!==void 0){var r=t[n];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Be.prototype.eventNames=function(){return this._eventsCount>0?wo(this._events):[]};function Yf(n,t){for(var r=new Array(t),s=0;s<t;++s)r[s]=n[s];return r}function ab(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function cb(n){for(var t=new Array(n.length),r=0;r<t.length;++r)t[r]=n[r].listener||n[r];return t}function ub(n,t){return new Promise(function(r,s){function a(f){n.removeListener(t,u),s(f)}function u(){typeof n.removeListener=="function"&&n.removeListener("error",a),r([].slice.call(arguments))}Xf(n,t,u,{once:!0}),t!=="error"&&hb(n,a,{once:!0})})}function hb(n,t,r){typeof n.on=="function"&&Xf(n,"error",t,r)}function Xf(n,t,r,s){if(typeof n.on=="function")s.once?n.once(t,r):n.on(t,r);else if(typeof n.addEventListener=="function")n.addEventListener(t,function a(u){s.once&&n.removeEventListener(t,a),r(u)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var $o={},ss={};Object.defineProperty(ss,"__esModule",{value:!0});function lb(n){if(typeof n!="string")throw new Error(`Cannot safe json parse value of type ${typeof n}`);try{return JSON.parse(n)}catch{return n}}ss.safeJsonParse=lb;function fb(n){return typeof n=="string"?n:JSON.stringify(n,(t,r)=>typeof r>"u"?null:r)}ss.safeJsonStringify=fb;var So={},hc={get exports(){return So},set exports(n){So=n}},fl;function db(){return fl||(fl=1,function(){let n;function t(){}n=t,n.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},n.prototype.setItem=function(r,s){this[r]=String(s)},n.prototype.removeItem=function(r){delete this[r]},n.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},n.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},n.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof gr<"u"&&gr.localStorage?hc.exports=gr.localStorage:typeof window<"u"&&window.localStorage?hc.exports=window.localStorage:hc.exports=new t}()),So}var lc={},Bn={},dl;function pb(){if(dl)return Bn;dl=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.IKeyValueStorage=void 0;class n{}return Bn.IKeyValueStorage=n,Bn}var Hn={},pl;function gb(){if(pl)return Hn;pl=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.parseEntry=void 0;const n=ss;function t(r){var s;return[r[0],n.safeJsonParse((s=r[1])!==null&&s!==void 0?s:"")]}return Hn.parseEntry=t,Hn}var gl;function yb(){return gl||(gl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=Ci;t.__exportStar(pb(),n),t.__exportStar(gb(),n)}(lc)),lc}Object.defineProperty($o,"__esModule",{value:!0});$o.KeyValueStorage=void 0;const mn=Ci,yl=ss,vb=mn.__importDefault(db()),mb=yb();class Zf{constructor(){this.localStorage=vb.default}getKeys(){return mn.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return mn.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(mb.parseEntry)})}getItem(t){return mn.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(t);if(r!==null)return yl.safeJsonParse(r)})}setItem(t,r){return mn.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(t,yl.safeJsonStringify(r))})}removeItem(t){return mn.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(t)})}}$o.KeyValueStorage=Zf;var bb=$o.default=Zf,En={},Vn={},fc={},Kn={};let Gi=class{};const wb=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Gi},Symbol.toStringTag,{value:"Module"})),_b=F1(wb);var vl;function Eb(){if(vl)return Kn;vl=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.IHeartBeat=void 0;const n=_b;class t extends n.IEvents{constructor(s){super()}}return Kn.IHeartBeat=t,Kn}var ml;function ed(){return ml||(ml=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),Ci.__exportStar(Eb(),n)}(fc)),fc}var dc={},Vi={},bl;function Ib(){if(bl)return Vi;bl=1,Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.HEARTBEAT_EVENTS=Vi.HEARTBEAT_INTERVAL=void 0;const n=ue;return Vi.HEARTBEAT_INTERVAL=n.FIVE_SECONDS,Vi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Vi}var wl;function td(){return wl||(wl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),Ci.__exportStar(Ib(),n)}(dc)),dc}var _l;function Sb(){if(_l)return Vn;_l=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.HeartBeat=void 0;const n=Ci,t=Bt,r=ue,s=ed(),a=td();class u extends s.IHeartBeat{constructor(g){super(g),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||a.HEARTBEAT_INTERVAL}static init(g){return n.__awaiter(this,void 0,void 0,function*(){const E=new u(g);return yield E.init(),E})}init(){return n.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,E){this.events.on(g,E)}once(g,E){this.events.once(g,E)}off(g,E){this.events.off(g,E)}removeListener(g,E){this.events.removeListener(g,E)}initialize(){return n.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Vn.HeartBeat=u,Vn}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=Ci;t.__exportStar(Sb(),n),t.__exportStar(ed(),n),t.__exportStar(td(),n)})(En);var Re={},pc,El;function xb(){if(El)return pc;El=1;function n(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}pc=t;function t(r,s,a){var u=a&&a.stringify||n,f=1;if(typeof r=="object"&&r!==null){var g=s.length+f;if(g===1)return r;var E=new Array(g);E[0]=u(r);for(var N=1;N<g;N++)E[N]=u(s[N]);return E.join(" ")}if(typeof r!="string")return r;var T=s.length;if(T===0)return r;for(var j="",G=1-f,J=-1,B=r&&r.length||0,Y=0;Y<B;){if(r.charCodeAt(Y)===37&&Y+1<B){switch(J=J>-1?J:0,r.charCodeAt(Y+1)){case 100:case 102:if(G>=T||s[G]==null)break;J<Y&&(j+=r.slice(J,Y)),j+=Number(s[G]),J=Y+2,Y++;break;case 105:if(G>=T||s[G]==null)break;J<Y&&(j+=r.slice(J,Y)),j+=Math.floor(Number(s[G])),J=Y+2,Y++;break;case 79:case 111:case 106:if(G>=T||s[G]===void 0)break;J<Y&&(j+=r.slice(J,Y));var ce=typeof s[G];if(ce==="string"){j+="'"+s[G]+"'",J=Y+2,Y++;break}if(ce==="function"){j+=s[G].name||"<anonymous>",J=Y+2,Y++;break}j+=u(s[G]),J=Y+2,Y++;break;case 115:if(G>=T)break;J<Y&&(j+=r.slice(J,Y)),j+=String(s[G]),J=Y+2,Y++;break;case 37:J<Y&&(j+=r.slice(J,Y)),j+="%",J=Y+2,Y++,G--;break}++G}++Y}return J===-1?r:(J<B&&(j+=r.slice(J)),j)}return pc}var gc,Il;function Pb(){if(Il)return gc;Il=1;const n=xb();gc=a;const t=I().console||{},r={mapHttpRequest:B,mapHttpResponse:B,wrapRequestSerializer:Y,wrapResponseSerializer:Y,wrapErrorSerializer:Y,req:B,res:B,err:G};function s(b,F){return Array.isArray(b)?b.filter(function(te){return te!=="!stdSerializers.err"}):b===!0?Object.keys(F):!1}function a(b){b=b||{},b.browser=b.browser||{};const F=b.browser.transmit;if(F&&typeof F.send!="function")throw Error("pino: transmit option must have a send function");const $=b.browser.write||t;b.browser.write&&(b.browser.asObject=!0);const te=b.serializers||{},se=s(b.browser.serialize,te);let pe=b.browser.serialize;Array.isArray(b.browser.serialize)&&b.browser.serialize.indexOf("!stdSerializers.err")>-1&&(pe=!1);const Te=["error","fatal","warn","info","debug","trace"];typeof $=="function"&&($.error=$.fatal=$.warn=$.info=$.debug=$.trace=$),b.enabled===!1&&(b.level="silent");const qe=b.level||"info",m=Object.create($);m.log||(m.log=ce),Object.defineProperty(m,"levelVal",{get:ie}),Object.defineProperty(m,"level",{get:de,set:Q});const O={transmit:F,serialize:se,asObject:b.browser.asObject,levels:Te,timestamp:J(b)};m.levels=a.levels,m.level=qe,m.setMaxListeners=m.getMaxListeners=m.emit=m.addListener=m.on=m.prependListener=m.once=m.prependOnceListener=m.removeListener=m.removeAllListeners=m.listeners=m.listenerCount=m.eventNames=m.write=m.flush=ce,m.serializers=te,m._serialize=se,m._stdErrSerialize=pe,m.child=V,F&&(m._logEvent=j());function ie(){return this.level==="silent"?1/0:this.levels.values[this.level]}function de(){return this._level}function Q(W){if(W!=="silent"&&!this.levels.values[W])throw Error("unknown level "+W);this._level=W,u(O,m,"error","log"),u(O,m,"fatal","error"),u(O,m,"warn","error"),u(O,m,"info","log"),u(O,m,"debug","log"),u(O,m,"trace","log")}function V(W,X){if(!W)throw new Error("missing bindings for child Pino");X=X||{},se&&W.serializers&&(X.serializers=W.serializers);const Qe=X.serializers;if(se&&Qe){var He=Object.assign({},te,Qe),Br=b.browser.serialize===!0?Object.keys(He):se;delete W.serializers,E([W],Br,He,this._stdErrSerialize)}function Ie(St){this._childLevel=(St._childLevel|0)+1,this.error=N(St,W,"error"),this.fatal=N(St,W,"fatal"),this.warn=N(St,W,"warn"),this.info=N(St,W,"info"),this.debug=N(St,W,"debug"),this.trace=N(St,W,"trace"),He&&(this.serializers=He,this._serialize=Br),F&&(this._logEvent=j([].concat(St._logEvent.bindings,W)))}return Ie.prototype=this,new Ie(this)}return m}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=r,a.stdTimeFunctions=Object.assign({},{nullTime:ye,epochTime:y,unixTime:_,isoTime:S});function u(b,F,$,te){const se=Object.getPrototypeOf(F);F[$]=F.levelVal>F.levels.values[$]?ce:se[$]?se[$]:t[$]||t[te]||ce,f(b,F,$)}function f(b,F,$){!b.transmit&&F[$]===ce||(F[$]=function(te){return function(){const pe=b.timestamp(),Te=new Array(arguments.length),qe=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var m=0;m<Te.length;m++)Te[m]=arguments[m];if(b.serialize&&!b.asObject&&E(Te,this._serialize,this.serializers,this._stdErrSerialize),b.asObject?te.call(qe,g(this,$,Te,pe)):te.apply(qe,Te),b.transmit){const O=b.transmit.level||F.level,ie=a.levels.values[O],de=a.levels.values[$];if(de<ie)return;T(this,{ts:pe,methodLevel:$,methodValue:de,transmitLevel:O,transmitValue:a.levels.values[b.transmit.level||F.level],send:b.transmit.send,val:F.levelVal},Te)}}}(F[$]))}function g(b,F,$,te){b._serialize&&E($,b._serialize,b.serializers,b._stdErrSerialize);const se=$.slice();let pe=se[0];const Te={};te&&(Te.time=te),Te.level=a.levels.values[F];let qe=(b._childLevel|0)+1;if(qe<1&&(qe=1),pe!==null&&typeof pe=="object"){for(;qe--&&typeof se[0]=="object";)Object.assign(Te,se.shift());pe=se.length?n(se.shift(),se):void 0}else typeof pe=="string"&&(pe=n(se.shift(),se));return pe!==void 0&&(Te.msg=pe),Te}function E(b,F,$,te){for(const se in b)if(te&&b[se]instanceof Error)b[se]=a.stdSerializers.err(b[se]);else if(typeof b[se]=="object"&&!Array.isArray(b[se]))for(const pe in b[se])F&&F.indexOf(pe)>-1&&pe in $&&(b[se][pe]=$[pe](b[se][pe]))}function N(b,F,$){return function(){const te=new Array(1+arguments.length);te[0]=F;for(var se=1;se<te.length;se++)te[se]=arguments[se-1];return b[$].apply(this,te)}}function T(b,F,$){const te=F.send,se=F.ts,pe=F.methodLevel,Te=F.methodValue,qe=F.val,m=b._logEvent.bindings;E($,b._serialize||Object.keys(b.serializers),b.serializers,b._stdErrSerialize===void 0?!0:b._stdErrSerialize),b._logEvent.ts=se,b._logEvent.messages=$.filter(function(O){return m.indexOf(O)===-1}),b._logEvent.level.label=pe,b._logEvent.level.value=Te,te(pe,b._logEvent,qe),b._logEvent=j(m)}function j(b){return{ts:0,messages:[],bindings:b||[],level:{label:"",value:0}}}function G(b){const F={type:b.constructor.name,msg:b.message,stack:b.stack};for(const $ in b)F[$]===void 0&&(F[$]=b[$]);return F}function J(b){return typeof b.timestamp=="function"?b.timestamp:b.timestamp===!1?ye:y}function B(){return{}}function Y(b){return b}function ce(){}function ye(){return!1}function y(){return Date.now()}function _(){return Math.round(Date.now()/1e3)}function S(){return new Date(Date.now()).toISOString()}function I(){function b(F){return typeof F<"u"&&F}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return b(self)||b(window)||b(this)||{}}}return gc}var Ki={},Sl;function rd(){return Sl||(Sl=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.PINO_CUSTOM_CONTEXT_KEY=Ki.PINO_LOGGER_DEFAULTS=void 0,Ki.PINO_LOGGER_DEFAULTS={level:"info"},Ki.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Ki}var ir={},xl;function Ob(){if(xl)return ir;xl=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.generateChildLogger=ir.formatChildLoggerContext=ir.getLoggerContext=ir.setBrowserLoggerContext=ir.getBrowserLoggerContext=ir.getDefaultLoggerOptions=void 0;const n=rd();function t(g){return Object.assign(Object.assign({},g),{level:(g==null?void 0:g.level)||n.PINO_LOGGER_DEFAULTS.level})}ir.getDefaultLoggerOptions=t;function r(g,E=n.PINO_CUSTOM_CONTEXT_KEY){return g[E]||""}ir.getBrowserLoggerContext=r;function s(g,E,N=n.PINO_CUSTOM_CONTEXT_KEY){return g[N]=E,g}ir.setBrowserLoggerContext=s;function a(g,E=n.PINO_CUSTOM_CONTEXT_KEY){let N="";return typeof g.bindings>"u"?N=r(g,E):N=g.bindings().context||"",N}ir.getLoggerContext=a;function u(g,E,N=n.PINO_CUSTOM_CONTEXT_KEY){const T=a(g,N);return T.trim()?`${T}/${E}`:E}ir.formatChildLoggerContext=u;function f(g,E,N=n.PINO_CUSTOM_CONTEXT_KEY){const T=u(g,E,N),j=g.child({context:T});return s(j,T,N)}return ir.generateChildLogger=f,ir}(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.pino=void 0;const t=Ci,r=t.__importDefault(Pb());Object.defineProperty(n,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(rd(),n),t.__exportStar(Ob(),n)})(Re);class Cb extends Gi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let Ab=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}};class Rb{constructor(t,r){this.logger=t,this.core=r}}let Tb=class extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}},Nb=class extends Gi{constructor(t){super()}},$b=class{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}};class Fb extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}}let Db=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r}},Lb=class{constructor(t,r){this.projectId=t,this.logger=r}},Ub=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},jb=class{constructor(t){this.client=t}};const Mb=n=>JSON.stringify(n,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),qb=n=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=n.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function zb(n){if(typeof n!="string")throw new Error(`Cannot safe json parse value of type ${typeof n}`);try{return qb(n)}catch{return n}}function kb(n){return typeof n=="string"?n:Mb(n)||""}var Hc={},id={};(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=D1,r=Df;n.DIGEST_LENGTH=64,n.BLOCK_SIZE=128;var s=function(){function g(){this.digestLength=n.DIGEST_LENGTH,this.blockSize=n.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},g.prototype.update=function(E,N){if(N===void 0&&(N=E.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var T=0;if(this._bytesHashed+=N,this._bufferLength>0){for(;this._bufferLength<n.BLOCK_SIZE&&N>0;)this._buffer[this._bufferLength++]=E[T++],N--;this._bufferLength===this.blockSize&&(u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(N>=this.blockSize&&(T=u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,E,T,N),N%=this.blockSize);N>0;)this._buffer[this._bufferLength++]=E[T++],N--;return this},g.prototype.finish=function(E){if(!this._finished){var N=this._bytesHashed,T=this._bufferLength,j=N/536870912|0,G=N<<3,J=N%128<112?128:256;this._buffer[T]=128;for(var B=T+1;B<J-8;B++)this._buffer[B]=0;t.writeUint32BE(j,this._buffer,J-8),t.writeUint32BE(G,this._buffer,J-4),u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,J),this._finished=!0}for(var B=0;B<this.digestLength/8;B++)t.writeUint32BE(this._stateHi[B],E,B*8),t.writeUint32BE(this._stateLo[B],E,B*8+4);return this},g.prototype.digest=function(){var E=new Uint8Array(this.digestLength);return this.finish(E),E},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(E){return this._stateHi.set(E.stateHi),this._stateLo.set(E.stateLo),this._bufferLength=E.bufferLength,E.buffer&&this._buffer.set(E.buffer),this._bytesHashed=E.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(E){r.wipe(E.stateHi),r.wipe(E.stateLo),E.buffer&&r.wipe(E.buffer),E.bufferLength=0,E.bytesHashed=0},g}();n.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function u(g,E,N,T,j,G,J){for(var B=N[0],Y=N[1],ce=N[2],ye=N[3],y=N[4],_=N[5],S=N[6],I=N[7],b=T[0],F=T[1],$=T[2],te=T[3],se=T[4],pe=T[5],Te=T[6],qe=T[7],m,O,ie,de,Q,V,W,X;J>=128;){for(var Qe=0;Qe<16;Qe++){var He=8*Qe+G;g[Qe]=t.readUint32BE(j,He),E[Qe]=t.readUint32BE(j,He+4)}for(var Qe=0;Qe<80;Qe++){var Br=B,Ie=Y,St=ce,M=ye,U=y,D=_,h=S,P=I,oe=b,ge=F,_e=$,Ne=te,Fe=se,Pe=pe,xt=Te,mt=qe;if(m=I,O=qe,Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=(y>>>14|se<<32-14)^(y>>>18|se<<32-18)^(se>>>41-32|y<<32-(41-32)),O=(se>>>14|y<<32-14)^(se>>>18|y<<32-18)^(y>>>41-32|se<<32-(41-32)),Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,m=y&_^~y&S,O=se&pe^~se&Te,Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,m=a[Qe*2],O=a[Qe*2+1],Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,m=g[Qe%16],O=E[Qe%16],Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,ie=W&65535|X<<16,de=Q&65535|V<<16,m=ie,O=de,Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=(B>>>28|b<<32-28)^(b>>>34-32|B<<32-(34-32))^(b>>>39-32|B<<32-(39-32)),O=(b>>>28|B<<32-28)^(B>>>34-32|b<<32-(34-32))^(B>>>39-32|b<<32-(39-32)),Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,m=B&Y^B&ce^Y&ce,O=b&F^b&$^F&$,Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,P=W&65535|X<<16,mt=Q&65535|V<<16,m=M,O=Ne,Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=ie,O=de,Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,M=W&65535|X<<16,Ne=Q&65535|V<<16,Y=Br,ce=Ie,ye=St,y=M,_=U,S=D,I=h,B=P,F=oe,$=ge,te=_e,se=Ne,pe=Fe,Te=Pe,qe=xt,b=mt,Qe%16===15)for(var He=0;He<16;He++)m=g[He],O=E[He],Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=g[(He+9)%16],O=E[(He+9)%16],Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,ie=g[(He+1)%16],de=E[(He+1)%16],m=(ie>>>1|de<<32-1)^(ie>>>8|de<<32-8)^ie>>>7,O=(de>>>1|ie<<32-1)^(de>>>8|ie<<32-8)^(de>>>7|ie<<32-7),Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,ie=g[(He+14)%16],de=E[(He+14)%16],m=(ie>>>19|de<<32-19)^(de>>>61-32|ie<<32-(61-32))^ie>>>6,O=(de>>>19|ie<<32-19)^(ie>>>61-32|de<<32-(61-32))^(de>>>6|ie<<32-6),Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,g[He]=W&65535|X<<16,E[He]=Q&65535|V<<16}m=B,O=b,Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=N[0],O=T[0],Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,N[0]=B=W&65535|X<<16,T[0]=b=Q&65535|V<<16,m=Y,O=F,Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=N[1],O=T[1],Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,N[1]=Y=W&65535|X<<16,T[1]=F=Q&65535|V<<16,m=ce,O=$,Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=N[2],O=T[2],Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,N[2]=ce=W&65535|X<<16,T[2]=$=Q&65535|V<<16,m=ye,O=te,Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=N[3],O=T[3],Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,N[3]=ye=W&65535|X<<16,T[3]=te=Q&65535|V<<16,m=y,O=se,Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=N[4],O=T[4],Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,N[4]=y=W&65535|X<<16,T[4]=se=Q&65535|V<<16,m=_,O=pe,Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=N[5],O=T[5],Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,N[5]=_=W&65535|X<<16,T[5]=pe=Q&65535|V<<16,m=S,O=Te,Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=N[6],O=T[6],Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,N[6]=S=W&65535|X<<16,T[6]=Te=Q&65535|V<<16,m=I,O=qe,Q=O&65535,V=O>>>16,W=m&65535,X=m>>>16,m=N[7],O=T[7],Q+=O&65535,V+=O>>>16,W+=m&65535,X+=m>>>16,V+=Q>>>16,W+=V>>>16,X+=W>>>16,N[7]=I=W&65535|X<<16,T[7]=qe=Q&65535|V<<16,G+=128,J-=128}return G}function f(g){var E=new s;E.update(g);var N=E.digest();return E.clean(),N}n.hash=f})(id);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertSecretKeyToX25519=n.convertPublicKeyToX25519=n.verify=n.sign=n.extractPublicKeyFromSecretKey=n.generateKeyPair=n.generateKeyPairFromSeed=n.SEED_LENGTH=n.SECRET_KEY_LENGTH=n.PUBLIC_KEY_LENGTH=n.SIGNATURE_LENGTH=void 0;const t=To,r=id,s=Df;n.SIGNATURE_LENGTH=64,n.PUBLIC_KEY_LENGTH=32,n.SECRET_KEY_LENGTH=64,n.SEED_LENGTH=32;function a(M){const U=new Float64Array(16);if(M)for(let D=0;D<M.length;D++)U[D]=M[D];return U}const u=new Uint8Array(32);u[0]=9;const f=a(),g=a([1]),E=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),N=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),T=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),j=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),G=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function J(M,U){for(let D=0;D<16;D++)M[D]=U[D]|0}function B(M){let U=1;for(let D=0;D<16;D++){let h=M[D]+U+65535;U=Math.floor(h/65536),M[D]=h-U*65536}M[0]+=U-1+37*(U-1)}function Y(M,U,D){const h=~(D-1);for(let P=0;P<16;P++){const oe=h&(M[P]^U[P]);M[P]^=oe,U[P]^=oe}}function ce(M,U){const D=a(),h=a();for(let P=0;P<16;P++)h[P]=U[P];B(h),B(h),B(h);for(let P=0;P<2;P++){D[0]=h[0]-65517;for(let ge=1;ge<15;ge++)D[ge]=h[ge]-65535-(D[ge-1]>>16&1),D[ge-1]&=65535;D[15]=h[15]-32767-(D[14]>>16&1);const oe=D[15]>>16&1;D[14]&=65535,Y(h,D,1-oe)}for(let P=0;P<16;P++)M[2*P]=h[P]&255,M[2*P+1]=h[P]>>8}function ye(M,U){let D=0;for(let h=0;h<32;h++)D|=M[h]^U[h];return(1&D-1>>>8)-1}function y(M,U){const D=new Uint8Array(32),h=new Uint8Array(32);return ce(D,M),ce(h,U),ye(D,h)}function _(M){const U=new Uint8Array(32);return ce(U,M),U[0]&1}function S(M,U){for(let D=0;D<16;D++)M[D]=U[2*D]+(U[2*D+1]<<8);M[15]&=32767}function I(M,U,D){for(let h=0;h<16;h++)M[h]=U[h]+D[h]}function b(M,U,D){for(let h=0;h<16;h++)M[h]=U[h]-D[h]}function F(M,U,D){let h,P,oe=0,ge=0,_e=0,Ne=0,Fe=0,Pe=0,xt=0,mt=0,ot=0,Le=0,Xe=0,Ze=0,at=0,ze=0,et=0,$e=0,Ve=0,ht=0,je=0,Pt=0,Dt=0,Ht=0,Vt=0,jt=0,Yt=0,ar=0,Hr=0,Xt=0,Xr=0,gi=0,Ti=0,lt=D[0],it=D[1],ft=D[2],dt=D[3],ct=D[4],nt=D[5],Ot=D[6],Ct=D[7],pt=D[8],At=D[9],gt=D[10],bt=D[11],yt=D[12],Ye=D[13],Rt=D[14],Tt=D[15];h=U[0],oe+=h*lt,ge+=h*it,_e+=h*ft,Ne+=h*dt,Fe+=h*ct,Pe+=h*nt,xt+=h*Ot,mt+=h*Ct,ot+=h*pt,Le+=h*At,Xe+=h*gt,Ze+=h*bt,at+=h*yt,ze+=h*Ye,et+=h*Rt,$e+=h*Tt,h=U[1],ge+=h*lt,_e+=h*it,Ne+=h*ft,Fe+=h*dt,Pe+=h*ct,xt+=h*nt,mt+=h*Ot,ot+=h*Ct,Le+=h*pt,Xe+=h*At,Ze+=h*gt,at+=h*bt,ze+=h*yt,et+=h*Ye,$e+=h*Rt,Ve+=h*Tt,h=U[2],_e+=h*lt,Ne+=h*it,Fe+=h*ft,Pe+=h*dt,xt+=h*ct,mt+=h*nt,ot+=h*Ot,Le+=h*Ct,Xe+=h*pt,Ze+=h*At,at+=h*gt,ze+=h*bt,et+=h*yt,$e+=h*Ye,Ve+=h*Rt,ht+=h*Tt,h=U[3],Ne+=h*lt,Fe+=h*it,Pe+=h*ft,xt+=h*dt,mt+=h*ct,ot+=h*nt,Le+=h*Ot,Xe+=h*Ct,Ze+=h*pt,at+=h*At,ze+=h*gt,et+=h*bt,$e+=h*yt,Ve+=h*Ye,ht+=h*Rt,je+=h*Tt,h=U[4],Fe+=h*lt,Pe+=h*it,xt+=h*ft,mt+=h*dt,ot+=h*ct,Le+=h*nt,Xe+=h*Ot,Ze+=h*Ct,at+=h*pt,ze+=h*At,et+=h*gt,$e+=h*bt,Ve+=h*yt,ht+=h*Ye,je+=h*Rt,Pt+=h*Tt,h=U[5],Pe+=h*lt,xt+=h*it,mt+=h*ft,ot+=h*dt,Le+=h*ct,Xe+=h*nt,Ze+=h*Ot,at+=h*Ct,ze+=h*pt,et+=h*At,$e+=h*gt,Ve+=h*bt,ht+=h*yt,je+=h*Ye,Pt+=h*Rt,Dt+=h*Tt,h=U[6],xt+=h*lt,mt+=h*it,ot+=h*ft,Le+=h*dt,Xe+=h*ct,Ze+=h*nt,at+=h*Ot,ze+=h*Ct,et+=h*pt,$e+=h*At,Ve+=h*gt,ht+=h*bt,je+=h*yt,Pt+=h*Ye,Dt+=h*Rt,Ht+=h*Tt,h=U[7],mt+=h*lt,ot+=h*it,Le+=h*ft,Xe+=h*dt,Ze+=h*ct,at+=h*nt,ze+=h*Ot,et+=h*Ct,$e+=h*pt,Ve+=h*At,ht+=h*gt,je+=h*bt,Pt+=h*yt,Dt+=h*Ye,Ht+=h*Rt,Vt+=h*Tt,h=U[8],ot+=h*lt,Le+=h*it,Xe+=h*ft,Ze+=h*dt,at+=h*ct,ze+=h*nt,et+=h*Ot,$e+=h*Ct,Ve+=h*pt,ht+=h*At,je+=h*gt,Pt+=h*bt,Dt+=h*yt,Ht+=h*Ye,Vt+=h*Rt,jt+=h*Tt,h=U[9],Le+=h*lt,Xe+=h*it,Ze+=h*ft,at+=h*dt,ze+=h*ct,et+=h*nt,$e+=h*Ot,Ve+=h*Ct,ht+=h*pt,je+=h*At,Pt+=h*gt,Dt+=h*bt,Ht+=h*yt,Vt+=h*Ye,jt+=h*Rt,Yt+=h*Tt,h=U[10],Xe+=h*lt,Ze+=h*it,at+=h*ft,ze+=h*dt,et+=h*ct,$e+=h*nt,Ve+=h*Ot,ht+=h*Ct,je+=h*pt,Pt+=h*At,Dt+=h*gt,Ht+=h*bt,Vt+=h*yt,jt+=h*Ye,Yt+=h*Rt,ar+=h*Tt,h=U[11],Ze+=h*lt,at+=h*it,ze+=h*ft,et+=h*dt,$e+=h*ct,Ve+=h*nt,ht+=h*Ot,je+=h*Ct,Pt+=h*pt,Dt+=h*At,Ht+=h*gt,Vt+=h*bt,jt+=h*yt,Yt+=h*Ye,ar+=h*Rt,Hr+=h*Tt,h=U[12],at+=h*lt,ze+=h*it,et+=h*ft,$e+=h*dt,Ve+=h*ct,ht+=h*nt,je+=h*Ot,Pt+=h*Ct,Dt+=h*pt,Ht+=h*At,Vt+=h*gt,jt+=h*bt,Yt+=h*yt,ar+=h*Ye,Hr+=h*Rt,Xt+=h*Tt,h=U[13],ze+=h*lt,et+=h*it,$e+=h*ft,Ve+=h*dt,ht+=h*ct,je+=h*nt,Pt+=h*Ot,Dt+=h*Ct,Ht+=h*pt,Vt+=h*At,jt+=h*gt,Yt+=h*bt,ar+=h*yt,Hr+=h*Ye,Xt+=h*Rt,Xr+=h*Tt,h=U[14],et+=h*lt,$e+=h*it,Ve+=h*ft,ht+=h*dt,je+=h*ct,Pt+=h*nt,Dt+=h*Ot,Ht+=h*Ct,Vt+=h*pt,jt+=h*At,Yt+=h*gt,ar+=h*bt,Hr+=h*yt,Xt+=h*Ye,Xr+=h*Rt,gi+=h*Tt,h=U[15],$e+=h*lt,Ve+=h*it,ht+=h*ft,je+=h*dt,Pt+=h*ct,Dt+=h*nt,Ht+=h*Ot,Vt+=h*Ct,jt+=h*pt,Yt+=h*At,ar+=h*gt,Hr+=h*bt,Xt+=h*yt,Xr+=h*Ye,gi+=h*Rt,Ti+=h*Tt,oe+=38*Ve,ge+=38*ht,_e+=38*je,Ne+=38*Pt,Fe+=38*Dt,Pe+=38*Ht,xt+=38*Vt,mt+=38*jt,ot+=38*Yt,Le+=38*ar,Xe+=38*Hr,Ze+=38*Xt,at+=38*Xr,ze+=38*gi,et+=38*Ti,P=1,h=oe+P+65535,P=Math.floor(h/65536),oe=h-P*65536,h=ge+P+65535,P=Math.floor(h/65536),ge=h-P*65536,h=_e+P+65535,P=Math.floor(h/65536),_e=h-P*65536,h=Ne+P+65535,P=Math.floor(h/65536),Ne=h-P*65536,h=Fe+P+65535,P=Math.floor(h/65536),Fe=h-P*65536,h=Pe+P+65535,P=Math.floor(h/65536),Pe=h-P*65536,h=xt+P+65535,P=Math.floor(h/65536),xt=h-P*65536,h=mt+P+65535,P=Math.floor(h/65536),mt=h-P*65536,h=ot+P+65535,P=Math.floor(h/65536),ot=h-P*65536,h=Le+P+65535,P=Math.floor(h/65536),Le=h-P*65536,h=Xe+P+65535,P=Math.floor(h/65536),Xe=h-P*65536,h=Ze+P+65535,P=Math.floor(h/65536),Ze=h-P*65536,h=at+P+65535,P=Math.floor(h/65536),at=h-P*65536,h=ze+P+65535,P=Math.floor(h/65536),ze=h-P*65536,h=et+P+65535,P=Math.floor(h/65536),et=h-P*65536,h=$e+P+65535,P=Math.floor(h/65536),$e=h-P*65536,oe+=P-1+37*(P-1),P=1,h=oe+P+65535,P=Math.floor(h/65536),oe=h-P*65536,h=ge+P+65535,P=Math.floor(h/65536),ge=h-P*65536,h=_e+P+65535,P=Math.floor(h/65536),_e=h-P*65536,h=Ne+P+65535,P=Math.floor(h/65536),Ne=h-P*65536,h=Fe+P+65535,P=Math.floor(h/65536),Fe=h-P*65536,h=Pe+P+65535,P=Math.floor(h/65536),Pe=h-P*65536,h=xt+P+65535,P=Math.floor(h/65536),xt=h-P*65536,h=mt+P+65535,P=Math.floor(h/65536),mt=h-P*65536,h=ot+P+65535,P=Math.floor(h/65536),ot=h-P*65536,h=Le+P+65535,P=Math.floor(h/65536),Le=h-P*65536,h=Xe+P+65535,P=Math.floor(h/65536),Xe=h-P*65536,h=Ze+P+65535,P=Math.floor(h/65536),Ze=h-P*65536,h=at+P+65535,P=Math.floor(h/65536),at=h-P*65536,h=ze+P+65535,P=Math.floor(h/65536),ze=h-P*65536,h=et+P+65535,P=Math.floor(h/65536),et=h-P*65536,h=$e+P+65535,P=Math.floor(h/65536),$e=h-P*65536,oe+=P-1+37*(P-1),M[0]=oe,M[1]=ge,M[2]=_e,M[3]=Ne,M[4]=Fe,M[5]=Pe,M[6]=xt,M[7]=mt,M[8]=ot,M[9]=Le,M[10]=Xe,M[11]=Ze,M[12]=at,M[13]=ze,M[14]=et,M[15]=$e}function $(M,U){F(M,U,U)}function te(M,U){const D=a();let h;for(h=0;h<16;h++)D[h]=U[h];for(h=253;h>=0;h--)$(D,D),h!==2&&h!==4&&F(D,D,U);for(h=0;h<16;h++)M[h]=D[h]}function se(M,U){const D=a();let h;for(h=0;h<16;h++)D[h]=U[h];for(h=250;h>=0;h--)$(D,D),h!==1&&F(D,D,U);for(h=0;h<16;h++)M[h]=D[h]}function pe(M,U){const D=a(),h=a(),P=a(),oe=a(),ge=a(),_e=a(),Ne=a(),Fe=a(),Pe=a();b(D,M[1],M[0]),b(Pe,U[1],U[0]),F(D,D,Pe),I(h,M[0],M[1]),I(Pe,U[0],U[1]),F(h,h,Pe),F(P,M[3],U[3]),F(P,P,N),F(oe,M[2],U[2]),I(oe,oe,oe),b(ge,h,D),b(_e,oe,P),I(Ne,oe,P),I(Fe,h,D),F(M[0],ge,_e),F(M[1],Fe,Ne),F(M[2],Ne,_e),F(M[3],ge,Fe)}function Te(M,U,D){for(let h=0;h<4;h++)Y(M[h],U[h],D)}function qe(M,U){const D=a(),h=a(),P=a();te(P,U[2]),F(D,U[0],P),F(h,U[1],P),ce(M,h),M[31]^=_(D)<<7}function m(M,U,D){J(M[0],f),J(M[1],g),J(M[2],g),J(M[3],f);for(let h=255;h>=0;--h){const P=D[h/8|0]>>(h&7)&1;Te(M,U,P),pe(U,M),pe(M,M),Te(M,U,P)}}function O(M,U){const D=[a(),a(),a(),a()];J(D[0],T),J(D[1],j),J(D[2],g),F(D[3],T,j),m(M,D,U)}function ie(M){if(M.length!==n.SEED_LENGTH)throw new Error(`ed25519: seed must be ${n.SEED_LENGTH} bytes`);const U=(0,r.hash)(M);U[0]&=248,U[31]&=127,U[31]|=64;const D=new Uint8Array(32),h=[a(),a(),a(),a()];O(h,U),qe(D,h);const P=new Uint8Array(64);return P.set(M),P.set(D,32),{publicKey:D,secretKey:P}}n.generateKeyPairFromSeed=ie;function de(M){const U=(0,t.randomBytes)(32,M),D=ie(U);return(0,s.wipe)(U),D}n.generateKeyPair=de;function Q(M){if(M.length!==n.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${n.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(M.subarray(32))}n.extractPublicKeyFromSecretKey=Q;const V=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function W(M,U){let D,h,P,oe;for(h=63;h>=32;--h){for(D=0,P=h-32,oe=h-12;P<oe;++P)U[P]+=D-16*U[h]*V[P-(h-32)],D=Math.floor((U[P]+128)/256),U[P]-=D*256;U[P]+=D,U[h]=0}for(D=0,P=0;P<32;P++)U[P]+=D-(U[31]>>4)*V[P],D=U[P]>>8,U[P]&=255;for(P=0;P<32;P++)U[P]-=D*V[P];for(h=0;h<32;h++)U[h+1]+=U[h]>>8,M[h]=U[h]&255}function X(M){const U=new Float64Array(64);for(let D=0;D<64;D++)U[D]=M[D];for(let D=0;D<64;D++)M[D]=0;W(M,U)}function Qe(M,U){const D=new Float64Array(64),h=[a(),a(),a(),a()],P=(0,r.hash)(M.subarray(0,32));P[0]&=248,P[31]&=127,P[31]|=64;const oe=new Uint8Array(64);oe.set(P.subarray(32),32);const ge=new r.SHA512;ge.update(oe.subarray(32)),ge.update(U);const _e=ge.digest();ge.clean(),X(_e),O(h,_e),qe(oe,h),ge.reset(),ge.update(oe.subarray(0,32)),ge.update(M.subarray(32)),ge.update(U);const Ne=ge.digest();X(Ne);for(let Fe=0;Fe<32;Fe++)D[Fe]=_e[Fe];for(let Fe=0;Fe<32;Fe++)for(let Pe=0;Pe<32;Pe++)D[Fe+Pe]+=Ne[Fe]*P[Pe];return W(oe.subarray(32),D),oe}n.sign=Qe;function He(M,U){const D=a(),h=a(),P=a(),oe=a(),ge=a(),_e=a(),Ne=a();return J(M[2],g),S(M[1],U),$(P,M[1]),F(oe,P,E),b(P,P,M[2]),I(oe,M[2],oe),$(ge,oe),$(_e,ge),F(Ne,_e,ge),F(D,Ne,P),F(D,D,oe),se(D,D),F(D,D,P),F(D,D,oe),F(D,D,oe),F(M[0],D,oe),$(h,M[0]),F(h,h,oe),y(h,P)&&F(M[0],M[0],G),$(h,M[0]),F(h,h,oe),y(h,P)?-1:(_(M[0])===U[31]>>7&&b(M[0],f,M[0]),F(M[3],M[0],M[1]),0)}function Br(M,U,D){const h=new Uint8Array(32),P=[a(),a(),a(),a()],oe=[a(),a(),a(),a()];if(D.length!==n.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${n.SIGNATURE_LENGTH} bytes`);if(He(oe,M))return!1;const ge=new r.SHA512;ge.update(D.subarray(0,32)),ge.update(M),ge.update(U);const _e=ge.digest();return X(_e),m(P,oe,_e),O(oe,D.subarray(32)),pe(P,oe),qe(h,P),!ye(D,h)}n.verify=Br;function Ie(M){let U=[a(),a(),a(),a()];if(He(U,M))throw new Error("Ed25519: invalid public key");let D=a(),h=a(),P=U[1];I(D,g,P),b(h,g,P),te(h,h),F(D,D,h);let oe=new Uint8Array(32);return ce(oe,D),oe}n.convertPublicKeyToX25519=Ie;function St(M){const U=(0,r.hash)(M.subarray(0,32));U[0]&=248,U[31]&=127,U[31]|=64;const D=new Uint8Array(U.subarray(0,32));return(0,s.wipe)(U),D}n.convertSecretKeyToX25519=St})(Hc);const Bb="EdDSA",Hb="JWT",nd=".",sd="base64url",Vb="utf8",Kb="utf8",Wb=":",Gb="did",Jb="key",Pl="base58btc",Qb="z",Yb="K36",Xb=32;function Zb(n){if(typeof n!="string")throw new Error(`Cannot safe json parse value of type ${typeof n}`);try{return JSON.parse(n)}catch{return n}}function Ac(n){return typeof n=="string"?n:JSON.stringify(n)}function xo(n){return or(yr(Ac(n),Vb),sd)}function od(n){const t=yr(Yb,Pl),r=Qb+or(Cc([t,n]),Pl);return[Gb,Jb,r].join(Wb)}function ew(n){return or(n,sd)}function tw(n){return yr([xo(n.header),xo(n.payload)].join(nd),Kb)}function rw(n){return[xo(n.header),xo(n.payload),ew(n.signature)].join(nd)}function Ol(n=To.randomBytes(Xb)){return Hc.generateKeyPairFromSeed(n)}async function iw(n,t,r,s,a=ue.fromMiliseconds(Date.now())){const u={alg:Bb,typ:Hb},f=od(s.publicKey),g=a+r,E={iss:f,sub:n,aud:t,iat:a,exp:g},N=tw({header:u,payload:E}),T=Hc.sign(s.secretKey,N);return rw({header:u,payload:E,signature:T})}var rs={},ad="%[a-f0-9]{2}",Cl=new RegExp("("+ad+")|([^%]+?)","gi"),Al=new RegExp("("+ad+")+","gi");function Rc(n,t){try{return[decodeURIComponent(n.join(""))]}catch{}if(n.length===1)return n;t=t||1;var r=n.slice(0,t),s=n.slice(t);return Array.prototype.concat.call([],Rc(r),Rc(s))}function nw(n){try{return decodeURIComponent(n)}catch{for(var t=n.match(Cl)||[],r=1;r<t.length;r++)n=Rc(t,r).join(""),t=n.match(Cl)||[];return n}}function sw(n){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=Al.exec(n);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch{var s=nw(r[0]);s!==r[0]&&(t[r[0]]=s)}r=Al.exec(n)}t["%C2"]="�";for(var a=Object.keys(t),u=0;u<a.length;u++){var f=a[u];n=n.replace(new RegExp(f,"g"),t[f])}return n}var ow=function(n){if(typeof n!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof n+"`");try{return n=n.replace(/\+/g," "),decodeURIComponent(n)}catch{return sw(n)}};(function(n){const t=jf,r=ow,s=Lf,a=Uf,u=y=>y==null,f=Symbol("encodeFragmentIdentifier");function g(y){switch(y.arrayFormat){case"index":return _=>(S,I)=>{const b=S.length;return I===void 0||y.skipNull&&I===null||y.skipEmptyString&&I===""?S:I===null?[...S,[T(_,y),"[",b,"]"].join("")]:[...S,[T(_,y),"[",T(b,y),"]=",T(I,y)].join("")]};case"bracket":return _=>(S,I)=>I===void 0||y.skipNull&&I===null||y.skipEmptyString&&I===""?S:I===null?[...S,[T(_,y),"[]"].join("")]:[...S,[T(_,y),"[]=",T(I,y)].join("")];case"colon-list-separator":return _=>(S,I)=>I===void 0||y.skipNull&&I===null||y.skipEmptyString&&I===""?S:I===null?[...S,[T(_,y),":list="].join("")]:[...S,[T(_,y),":list=",T(I,y)].join("")];case"comma":case"separator":case"bracket-separator":{const _=y.arrayFormat==="bracket-separator"?"[]=":"=";return S=>(I,b)=>b===void 0||y.skipNull&&b===null||y.skipEmptyString&&b===""?I:(b=b===null?"":b,I.length===0?[[T(S,y),_,T(b,y)].join("")]:[[I,T(b,y)].join(y.arrayFormatSeparator)])}default:return _=>(S,I)=>I===void 0||y.skipNull&&I===null||y.skipEmptyString&&I===""?S:I===null?[...S,T(_,y)]:[...S,[T(_,y),"=",T(I,y)].join("")]}}function E(y){let _;switch(y.arrayFormat){case"index":return(S,I,b)=>{if(_=/\[(\d*)\]$/.exec(S),S=S.replace(/\[\d*\]$/,""),!_){b[S]=I;return}b[S]===void 0&&(b[S]={}),b[S][_[1]]=I};case"bracket":return(S,I,b)=>{if(_=/(\[\])$/.exec(S),S=S.replace(/\[\]$/,""),!_){b[S]=I;return}if(b[S]===void 0){b[S]=[I];return}b[S]=[].concat(b[S],I)};case"colon-list-separator":return(S,I,b)=>{if(_=/(:list)$/.exec(S),S=S.replace(/:list$/,""),!_){b[S]=I;return}if(b[S]===void 0){b[S]=[I];return}b[S]=[].concat(b[S],I)};case"comma":case"separator":return(S,I,b)=>{const F=typeof I=="string"&&I.includes(y.arrayFormatSeparator),$=typeof I=="string"&&!F&&j(I,y).includes(y.arrayFormatSeparator);I=$?j(I,y):I;const te=F||$?I.split(y.arrayFormatSeparator).map(se=>j(se,y)):I===null?I:j(I,y);b[S]=te};case"bracket-separator":return(S,I,b)=>{const F=/(\[\])$/.test(S);if(S=S.replace(/\[\]$/,""),!F){b[S]=I&&j(I,y);return}const $=I===null?[]:I.split(y.arrayFormatSeparator).map(te=>j(te,y));if(b[S]===void 0){b[S]=$;return}b[S]=[].concat(b[S],$)};default:return(S,I,b)=>{if(b[S]===void 0){b[S]=I;return}b[S]=[].concat(b[S],I)}}}function N(y){if(typeof y!="string"||y.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function T(y,_){return _.encode?_.strict?t(y):encodeURIComponent(y):y}function j(y,_){return _.decode?r(y):y}function G(y){return Array.isArray(y)?y.sort():typeof y=="object"?G(Object.keys(y)).sort((_,S)=>Number(_)-Number(S)).map(_=>y[_]):y}function J(y){const _=y.indexOf("#");return _!==-1&&(y=y.slice(0,_)),y}function B(y){let _="";const S=y.indexOf("#");return S!==-1&&(_=y.slice(S)),_}function Y(y){y=J(y);const _=y.indexOf("?");return _===-1?"":y.slice(_+1)}function ce(y,_){return _.parseNumbers&&!Number.isNaN(Number(y))&&typeof y=="string"&&y.trim()!==""?y=Number(y):_.parseBooleans&&y!==null&&(y.toLowerCase()==="true"||y.toLowerCase()==="false")&&(y=y.toLowerCase()==="true"),y}function ye(y,_){_=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},_),N(_.arrayFormatSeparator);const S=E(_),I=Object.create(null);if(typeof y!="string"||(y=y.trim().replace(/^[?#&]/,""),!y))return I;for(const b of y.split("&")){if(b==="")continue;let[F,$]=s(_.decode?b.replace(/\+/g," "):b,"=");$=$===void 0?null:["comma","separator","bracket-separator"].includes(_.arrayFormat)?$:j($,_),S(j(F,_),$,I)}for(const b of Object.keys(I)){const F=I[b];if(typeof F=="object"&&F!==null)for(const $ of Object.keys(F))F[$]=ce(F[$],_);else I[b]=ce(F,_)}return _.sort===!1?I:(_.sort===!0?Object.keys(I).sort():Object.keys(I).sort(_.sort)).reduce((b,F)=>{const $=I[F];return $&&typeof $=="object"&&!Array.isArray($)?b[F]=G($):b[F]=$,b},Object.create(null))}n.extract=Y,n.parse=ye,n.stringify=(y,_)=>{if(!y)return"";_=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},_),N(_.arrayFormatSeparator);const S=$=>_.skipNull&&u(y[$])||_.skipEmptyString&&y[$]==="",I=g(_),b={};for(const $ of Object.keys(y))S($)||(b[$]=y[$]);const F=Object.keys(b);return _.sort!==!1&&F.sort(_.sort),F.map($=>{const te=y[$];return te===void 0?"":te===null?T($,_):Array.isArray(te)?te.length===0&&_.arrayFormat==="bracket-separator"?T($,_)+"[]":te.reduce(I($),[]).join("&"):T($,_)+"="+T(te,_)}).filter($=>$.length>0).join("&")},n.parseUrl=(y,_)=>{_=Object.assign({decode:!0},_);const[S,I]=s(y,"#");return Object.assign({url:S.split("?")[0]||"",query:ye(Y(y),_)},_&&_.parseFragmentIdentifier&&I?{fragmentIdentifier:j(I,_)}:{})},n.stringifyUrl=(y,_)=>{_=Object.assign({encode:!0,strict:!0,[f]:!0},_);const S=J(y.url).split("?")[0]||"",I=n.extract(y.url),b=n.parse(I,{sort:!1}),F=Object.assign(b,y.query);let $=n.stringify(F,_);$&&($=`?${$}`);let te=B(y.url);return y.fragmentIdentifier&&(te=`#${_[f]?T(y.fragmentIdentifier,_):y.fragmentIdentifier}`),`${S}${$}${te}`},n.pick=(y,_,S)=>{S=Object.assign({parseFragmentIdentifier:!0,[f]:!1},S);const{url:I,query:b,fragmentIdentifier:F}=n.parseUrl(y,S);return n.stringifyUrl({url:I,query:a(b,_),fragmentIdentifier:F},S)},n.exclude=(y,_,S)=>{const I=Array.isArray(_)?b=>!_.includes(b):(b,F)=>!_(b,F);return n.pick(y,I,S)}})(rs);function cd(n,t){return n.includes(":")?[n]:t.chains||[]}const ud="base10",sr="base16",Tc="base64pad",Vc="utf8",hd=0,Ji=1,aw=0,Rl=1,Nc=12,Kc=32;function cw(){const n=qf.generateKeyPair();return{privateKey:or(n.secretKey,sr),publicKey:or(n.publicKey,sr)}}function $c(){const n=To.randomBytes(Kc);return or(n,sr)}function uw(n,t){const r=qf.sharedKey(yr(n,sr),yr(t,sr)),s=new U1(kc.SHA256,r).expand(Kc);return or(s,sr)}function hw(n){const t=kc.hash(yr(n,sr));return or(t,sr)}function _n(n){const t=kc.hash(yr(n,Vc));return or(t,sr)}function lw(n){return yr(`${n}`,ud)}function os(n){return Number(or(n,ud))}function fw(n){const t=lw(typeof n.type<"u"?n.type:hd);if(os(t)===Ji&&typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof n.senderPublicKey<"u"?yr(n.senderPublicKey,sr):void 0,s=typeof n.iv<"u"?yr(n.iv,sr):To.randomBytes(Nc),a=new zf.ChaCha20Poly1305(yr(n.symKey,sr)).seal(s,yr(n.message,Vc));return pw({type:t,sealed:a,iv:s,senderPublicKey:r})}function dw(n){const t=new zf.ChaCha20Poly1305(yr(n.symKey,sr)),{sealed:r,iv:s}=Po(n.encoded),a=t.open(s,r);if(a===null)throw new Error("Failed to decrypt");return or(a,Vc)}function pw(n){if(os(n.type)===Ji){if(typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return or(Cc([n.type,n.senderPublicKey,n.iv,n.sealed]),Tc)}return or(Cc([n.type,n.iv,n.sealed]),Tc)}function Po(n){const t=yr(n,Tc),r=t.slice(aw,Rl),s=Rl;if(os(r)===Ji){const g=s+Kc,E=g+Nc,N=t.slice(s,g),T=t.slice(g,E),j=t.slice(E);return{type:r,sealed:j,iv:T,senderPublicKey:N}}const a=s+Nc,u=t.slice(s,a),f=t.slice(a);return{type:r,sealed:f,iv:u}}function gw(n,t){const r=Po(n);return ld({type:os(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?or(r.senderPublicKey,sr):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function ld(n){const t=(n==null?void 0:n.type)||hd;if(t===Ji){if(typeof(n==null?void 0:n.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(n==null?void 0:n.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:n==null?void 0:n.senderPublicKey,receiverPublicKey:n==null?void 0:n.receiverPublicKey}}function Tl(n){return n.type===Ji&&typeof n.senderPublicKey=="string"&&typeof n.receiverPublicKey=="string"}var yw=Object.defineProperty,Nl=Object.getOwnPropertySymbols,vw=Object.prototype.hasOwnProperty,mw=Object.prototype.propertyIsEnumerable,$l=(n,t,r)=>t in n?yw(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Fl=(n,t)=>{for(var r in t||(t={}))vw.call(t,r)&&$l(n,r,t[r]);if(Nl)for(var r of Nl(t))mw.call(t,r)&&$l(n,r,t[r]);return n};const bw="ReactNative",Ir={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},ww="js";function Wc(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Fo(){return!j1()&&!!Mf()&&navigator.product===bw}function as(){return!Wc()&&!!Mf()}function cs(){return Fo()?Ir.reactNative:Wc()?Ir.node:as()?Ir.browser:Ir.unknown}function _w(n,t){let r=rs.parse(n);return r=Fl(Fl({},r),t),n=rs.stringify(r),n}function Ew(){return L1()||{name:"",description:"",url:"",icons:[""]}}function Iw(){if(cs()===Ir.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:s}=global.Platform;return[r,s].join("-")}const n=X1();if(n===null)return"unknown";const t=n.os?n.os.replace(" ","").toLowerCase():"unknown";return n.type==="browser"?[t,n.name,n.version].join("-"):[t,n.version].join("-")}function Sw(){var n;const t=cs();return t===Ir.browser?[t,((n=M1())==null?void 0:n.host)||"unknown"].join(":"):t}function xw(n,t,r){const s=Iw(),a=Sw();return[[n,t].join("-"),[ww,r].join("-"),s,a].join("/")}function Pw({protocol:n,version:t,relayUrl:r,sdkVersion:s,auth:a,projectId:u,useOnCloseEvent:f}){const g=r.split("?"),E=xw(n,t,s),N={auth:a,ua:E,projectId:u,useOnCloseEvent:f||void 0},T=_w(g[1]||"",N);return g[0]+"?"+T}function Wi(n,t){return n.filter(r=>t.includes(r)).length===n.length}function fd(n){return Object.fromEntries(n.entries())}function dd(n){return new Map(Object.entries(n))}function bn(n=ue.FIVE_MINUTES,t){const r=ue.toMiliseconds(n||ue.FIVE_MINUTES);let s,a,u;return{resolve:f=>{u&&s&&(clearTimeout(u),s(f))},reject:f=>{u&&a&&(clearTimeout(u),a(f))},done:()=>new Promise((f,g)=>{u=setTimeout(()=>{g(new Error(t))},r),s=f,a=g})}}function is(n,t,r){return new Promise(async(s,a)=>{const u=setTimeout(()=>a(new Error(r)),t);try{const f=await n;s(f)}catch(f){a(f)}clearTimeout(u)})}function pd(n,t){if(typeof t=="string"&&t.startsWith(`${n}:`))return t;if(n.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(n.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${n}`)}function Ow(n){return pd("topic",n)}function Cw(n){return pd("id",n)}function gd(n){const[t,r]=n.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function zr(n,t){return ue.fromMiliseconds((t||Date.now())+ue.toMiliseconds(n))}function Pi(n){return Date.now()>=ue.toMiliseconds(n)}function Ft(n,t){return`${n}${t?`:${t}`:""}`}async function Aw({id:n,topic:t,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let a=s==null?void 0:s.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const u=`${a}/wc?requestId=${n}&sessionTopic=${t}`,f=cs();f===Ir.browser?u.startsWith("https://")?window.open(u,"_blank","noreferrer noopener"):window.open(u,"_self","noreferrer noopener"):f===Ir.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(u)}catch(s){console.error(s)}}const Rw="irn";function Fc(n){return(n==null?void 0:n.relay)||{protocol:Rw}}function _o(n){const t=ib[n];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${n}`);return t}var Tw=Object.defineProperty,Dl=Object.getOwnPropertySymbols,Nw=Object.prototype.hasOwnProperty,$w=Object.prototype.propertyIsEnumerable,Ll=(n,t,r)=>t in n?Tw(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Fw=(n,t)=>{for(var r in t||(t={}))Nw.call(t,r)&&Ll(n,r,t[r]);if(Dl)for(var r of Dl(t))$w.call(t,r)&&Ll(n,r,t[r]);return n};function Dw(n,t="-"){const r={},s="relay"+t;return Object.keys(n).forEach(a=>{if(a.startsWith(s)){const u=a.replace(s,""),f=n[a];r[u]=f}}),r}function Lw(n){const t=n.indexOf(":"),r=n.indexOf("?")!==-1?n.indexOf("?"):void 0,s=n.substring(0,t),a=n.substring(t+1,r).split("@"),u=typeof r<"u"?n.substring(r):"",f=rs.parse(u);return{protocol:s,topic:Uw(a[0]),version:parseInt(a[1],10),symKey:f.symKey,relay:Dw(f)}}function Uw(n){return n.startsWith("//")?n.substring(2):n}function jw(n,t="-"){const r="relay",s={};return Object.keys(n).forEach(a=>{const u=r+t+a;n[a]&&(s[u]=n[a])}),s}function Mw(n){return`${n.protocol}:${n.topic}@${n.version}?`+rs.stringify(Fw({symKey:n.symKey},jw(n.relay)))}function In(n){const t=[];return n.forEach(r=>{const[s,a]=r.split(":");t.push(`${s}:${a}`)}),t}function qw(n){const t=[];return Object.values(n).forEach(r=>{t.push(...In(r.accounts))}),t}function zw(n,t){const r=[];return Object.values(n).forEach(s=>{In(s.accounts).includes(t)&&r.push(...s.methods)}),r}function kw(n,t){const r=[];return Object.values(n).forEach(s=>{In(s.accounts).includes(t)&&r.push(...s.events)}),r}function Bw(n,t){const r=Eo(n,t);if(r)throw new Error(r.message);const s={};for(const[a,u]of Object.entries(n))s[a]={methods:u.methods,events:u.events,chains:u.accounts.map(f=>`${f.split(":")[0]}:${f.split(":")[1]}`)};return s}const Hw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Vw={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ee(n,t){const{message:r,code:s}=Vw[n];return{message:t?`${r} ${t}`:r,code:s}}function zt(n,t){const{message:r,code:s}=Hw[n];return{message:t?`${r} ${t}`:r,code:s}}function us(n,t){return Array.isArray(n)?typeof t<"u"&&n.length?n.every(t):!0:!1}function es(n){return Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length}function nr(n){return typeof n>"u"}function kt(n,t){return t&&nr(n)?!0:typeof n=="string"&&!!n.trim().length}function Gc(n,t){return t&&nr(n)?!0:typeof n=="number"&&!isNaN(n)}function Kw(n,t){const{requiredNamespaces:r}=t,s=Object.keys(n.namespaces),a=Object.keys(r);let u=!0;return Wi(a,s)?(s.forEach(f=>{const{accounts:g,methods:E,events:N}=n.namespaces[f],T=In(g),j=r[f];(!Wi(cd(f,j),T)||!Wi(j.methods,E)||!Wi(j.events,N))&&(u=!1)}),u):!1}function Oo(n){return kt(n,!1)&&n.includes(":")?n.split(":").length===2:!1}function Ww(n){if(kt(n,!1)&&n.includes(":")){const t=n.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&Oo(r)}}return!1}function Gw(n){if(kt(n,!1))try{return typeof new URL(n)<"u"}catch{return!1}return!1}function Jw(n){var t;return(t=n==null?void 0:n.proposer)==null?void 0:t.publicKey}function Qw(n){return n==null?void 0:n.topic}function Yw(n,t){let r=null;return kt(n==null?void 0:n.publicKey,!1)||(r=ee("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function Ul(n){let t=!0;return us(n)?n.length&&(t=n.every(r=>kt(r,!1))):t=!1,t}function Xw(n,t,r){let s=null;return us(t)&&t.length?t.forEach(a=>{s||Oo(a)||(s=zt("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Oo(n)||(s=zt("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function Zw(n,t,r){let s=null;return Object.entries(n).forEach(([a,u])=>{if(s)return;const f=Xw(a,cd(a,u),`${t} ${r}`);f&&(s=f)}),s}function e_(n,t){let r=null;return us(n)?n.forEach(s=>{r||Ww(s)||(r=zt("UNSUPPORTED_ACCOUNTS",`${t}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=zt("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function t_(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const a=e_(s==null?void 0:s.accounts,`${t} namespace`);a&&(r=a)}),r}function r_(n,t){let r=null;return Ul(n==null?void 0:n.methods)?Ul(n==null?void 0:n.events)||(r=zt("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=zt("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function yd(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const a=r_(s,`${t}, namespace`);a&&(r=a)}),r}function i_(n,t,r){let s=null;if(n&&es(n)){const a=yd(n,t);a&&(s=a);const u=Zw(n,t,r);u&&(s=u)}else s=ee("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return s}function Eo(n,t){let r=null;if(n&&es(n)){const s=yd(n,t);s&&(r=s);const a=t_(n,t);a&&(r=a)}else r=ee("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function vd(n){return kt(n.protocol,!0)}function n_(n,t){let r=!1;return t&&!n?r=!0:n&&us(n)&&n.length&&n.forEach(s=>{r=vd(s)}),r}function s_(n){return typeof n=="number"}function pr(n){return typeof n<"u"&&typeof n!==null}function o_(n){return!(!n||typeof n!="object"||!n.code||!Gc(n.code,!1)||!n.message||!kt(n.message,!1))}function a_(n){return!(nr(n)||!kt(n.method,!1))}function c_(n){return!(nr(n)||nr(n.result)&&nr(n.error)||!Gc(n.id,!1)||!kt(n.jsonrpc,!1))}function u_(n){return!(nr(n)||!kt(n.name,!1))}function jl(n,t){return!(!Oo(t)||!qw(n).includes(t))}function h_(n,t,r){return kt(r,!1)?zw(n,t).includes(r):!1}function l_(n,t,r){return kt(r,!1)?kw(n,t).includes(r):!1}function Ml(n,t,r){let s=null;const a=f_(n),u=d_(t),f=Object.keys(a),g=Object.keys(u),E=ql(Object.keys(n)),N=ql(Object.keys(t)),T=E.filter(j=>!N.includes(j));return T.length&&(s=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${T.toString()}
      Received: ${Object.keys(t).toString()}`)),Wi(f,g)||(s=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${f.toString()}
      Approved: ${g.toString()}`)),Object.keys(t).forEach(j=>{if(!j.includes(":")||s)return;const G=In(t[j].accounts);G.includes(j)||(s=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${j}
        Required: ${j}
        Approved: ${G.toString()}`))}),f.forEach(j=>{s||(Wi(a[j].methods,u[j].methods)?Wi(a[j].events,u[j].events)||(s=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${j}`)):s=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${j}`))}),s}function f_(n){const t={};return Object.keys(n).forEach(r=>{var s;r.includes(":")?t[r]=n[r]:(s=n[r].chains)==null||s.forEach(a=>{t[a]={methods:n[r].methods,events:n[r].events}})}),t}function ql(n){return[...new Set(n.map(t=>t.includes(":")?t.split(":")[0]:t))]}function d_(n){const t={};return Object.keys(n).forEach(r=>{if(r.includes(":"))t[r]=n[r];else{const s=In(n[r].accounts);s==null||s.forEach(a=>{t[a]={accounts:n[r].accounts.filter(u=>u.includes(`${a}:`)),methods:n[r].methods,events:n[r].events}})}}),t}function p_(n,t){return Gc(n,!1)&&n<=t.max&&n>=t.min}function zl(){const n=cs();return new Promise(t=>{switch(n){case Ir.browser:t(g_());break;case Ir.reactNative:t(y_());break;case Ir.node:t(v_());break;default:t(!0)}})}function g_(){return as()&&(navigator==null?void 0:navigator.onLine)}async function y_(){if(Fo()&&typeof global<"u"&&global!=null&&global.NetInfo){const n=await(global==null?void 0:global.NetInfo.fetch());return n==null?void 0:n.isConnected}return!0}function v_(){return!0}function m_(n){switch(cs()){case Ir.browser:b_(n);break;case Ir.reactNative:w_(n);break}}function b_(n){as()&&(window.addEventListener("online",()=>n(!0)),window.addEventListener("offline",()=>n(!1)))}function w_(n){Fo()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(t=>n(t==null?void 0:t.isConnected)))}const yc={};let yo=class{static get(t){return yc[t]}static set(t,r){yc[t]=r}static delete(t){delete yc[t]}};const __="PARSE_ERROR",E_="INVALID_REQUEST",I_="METHOD_NOT_FOUND",S_="INVALID_PARAMS",md="INTERNAL_ERROR",Jc="SERVER_ERROR",x_=[-32700,-32600,-32601,-32602,-32603],ts={[__]:{code:-32700,message:"Parse error"},[E_]:{code:-32600,message:"Invalid Request"},[I_]:{code:-32601,message:"Method not found"},[S_]:{code:-32602,message:"Invalid params"},[md]:{code:-32603,message:"Internal error"},[Jc]:{code:-32e3,message:"Server error"}},bd=Jc;function P_(n){return x_.includes(n)}function kl(n){return Object.keys(ts).includes(n)?ts[n]:ts[bd]}function O_(n){const t=Object.values(ts).find(r=>r.code===n);return t||ts[bd]}function wd(n,t,r){return n.message.includes("getaddrinfo ENOTFOUND")||n.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):n}var _d={},hi={},Bl;function C_(){if(Bl)return hi;Bl=1,Object.defineProperty(hi,"__esModule",{value:!0}),hi.isBrowserCryptoAvailable=hi.getSubtleCrypto=hi.getBrowerCrypto=void 0;function n(){return(gr===null||gr===void 0?void 0:gr.crypto)||(gr===null||gr===void 0?void 0:gr.msCrypto)||{}}hi.getBrowerCrypto=n;function t(){const s=n();return s.subtle||s.webkitSubtle}hi.getSubtleCrypto=t;function r(){return!!n()&&!!t()}return hi.isBrowserCryptoAvailable=r,hi}var li={},Hl;function A_(){if(Hl)return li;Hl=1,Object.defineProperty(li,"__esModule",{value:!0}),li.isBrowser=li.isNode=li.isReactNative=void 0;function n(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}li.isReactNative=n;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}li.isNode=t;function r(){return!n()&&!t()}return li.isBrowser=r,li}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=Ci;t.__exportStar(C_(),n),t.__exportStar(A_(),n)})(_d);function Qc(n=3){const t=Date.now()*Math.pow(10,n),r=Math.floor(Math.random()*Math.pow(10,n));return t+r}function Ed(n=6){return BigInt(Qc(n))}function ns(n,t,r){return{id:r||Qc(),jsonrpc:"2.0",method:n,params:t}}function Yc(n,t){return{id:n,jsonrpc:"2.0",result:t}}function Do(n,t,r){return{id:n,jsonrpc:"2.0",error:R_(t,r)}}function R_(n,t){return typeof n>"u"?kl(md):(typeof n=="string"&&(n=Object.assign(Object.assign({},kl(Jc)),{message:n})),typeof t<"u"&&(n.data=t),P_(n.code)&&(n=O_(n.code)),n)}class T_{}class N_ extends T_{constructor(){super()}}class $_ extends N_{constructor(t){super()}}const F_="^https?:",D_="^wss?:";function L_(n){const t=n.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function Id(n,t){const r=L_(n);return typeof r>"u"?!1:new RegExp(t).test(r)}function Vl(n){return Id(n,F_)}function Kl(n){return Id(n,D_)}function U_(n){return new RegExp("wss?://localhost(:d{2,5})?").test(n)}function Sd(n){return typeof n=="object"&&"id"in n&&"jsonrpc"in n&&n.jsonrpc==="2.0"}function Xc(n){return Sd(n)&&"method"in n}function Lo(n){return Sd(n)&&(pi(n)||kr(n))}function pi(n){return"result"in n}function kr(n){return"error"in n}class Ai extends $_{constructor(t){super(t),this.events=new Bt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(ns(t.method,t.params||[],t.id||Ed().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{kr(u)?a(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Lo(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const j_=n=>JSON.stringify(n,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),M_=n=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=n.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function q_(n){if(typeof n!="string")throw new Error(`Cannot safe json parse value of type ${typeof n}`);try{return M_(n)}catch{return n}}function z_(n){return typeof n=="string"?n:j_(n)||""}const k_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),B_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Wl=n=>n.split("?")[0],Gl=10,H_=k_();class V_{constructor(t){if(this.url=t,this.events=new Bt.EventEmitter,this.registering=!1,!Kl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(z_(t))}catch(s){this.onError(t.id,s)}}register(t=this.url){if(!Kl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const a=_d.isReactNative()?void 0:{rejectUnauthorized:!U_(t)},u=new H_(t,[],a);B_()?u.onerror=f=>{const g=f;s(this.emitError(g.error))}:u.on("error",f=>{s(this.emitError(f))}),u.onopen=()=>{this.onOpen(u),r(u)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?q_(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),u=Do(t,a);this.events.emit("payload",u)}parseError(t,r=this.url){return wd(t,Wl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Gl&&this.events.setMaxListeners(Gl)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${Wl(this.url)}`));return this.events.emit("register_error",r),r}}var Co={},K_={get exports(){return Co},set exports(n){Co=n}};(function(n,t){var r=200,s="__lodash_hash_undefined__",a=1,u=2,f=9007199254740991,g="[object Arguments]",E="[object Array]",N="[object AsyncFunction]",T="[object Boolean]",j="[object Date]",G="[object Error]",J="[object Function]",B="[object GeneratorFunction]",Y="[object Map]",ce="[object Number]",ye="[object Null]",y="[object Object]",_="[object Promise]",S="[object Proxy]",I="[object RegExp]",b="[object Set]",F="[object String]",$="[object Symbol]",te="[object Undefined]",se="[object WeakMap]",pe="[object ArrayBuffer]",Te="[object DataView]",qe="[object Float32Array]",m="[object Float64Array]",O="[object Int8Array]",ie="[object Int16Array]",de="[object Int32Array]",Q="[object Uint8Array]",V="[object Uint8ClampedArray]",W="[object Uint16Array]",X="[object Uint32Array]",Qe=/[\\^$.*+?()[\]{}|]/g,He=/^\[object .+?Constructor\]$/,Br=/^(?:0|[1-9]\d*)$/,Ie={};Ie[qe]=Ie[m]=Ie[O]=Ie[ie]=Ie[de]=Ie[Q]=Ie[V]=Ie[W]=Ie[X]=!0,Ie[g]=Ie[E]=Ie[pe]=Ie[T]=Ie[Te]=Ie[j]=Ie[G]=Ie[J]=Ie[Y]=Ie[ce]=Ie[y]=Ie[I]=Ie[b]=Ie[F]=Ie[se]=!1;var St=typeof gr=="object"&&gr&&gr.Object===Object&&gr,M=typeof self=="object"&&self&&self.Object===Object&&self,U=St||M||Function("return this")(),D=t&&!t.nodeType&&t,h=D&&!0&&n&&!n.nodeType&&n,P=h&&h.exports===D,oe=P&&St.process,ge=function(){try{return oe&&oe.binding&&oe.binding("util")}catch{}}(),_e=ge&&ge.isTypedArray;function Ne(v,C){for(var H=-1,re=v==null?0:v.length,We=0,me=[];++H<re;){var tt=v[H];C(tt,H,v)&&(me[We++]=tt)}return me}function Fe(v,C){for(var H=-1,re=C.length,We=v.length;++H<re;)v[We+H]=C[H];return v}function Pe(v,C){for(var H=-1,re=v==null?0:v.length;++H<re;)if(C(v[H],H,v))return!0;return!1}function xt(v,C){for(var H=-1,re=Array(v);++H<v;)re[H]=C(H);return re}function mt(v){return function(C){return v(C)}}function ot(v,C){return v.has(C)}function Le(v,C){return v==null?void 0:v[C]}function Xe(v){var C=-1,H=Array(v.size);return v.forEach(function(re,We){H[++C]=[We,re]}),H}function Ze(v,C){return function(H){return v(C(H))}}function at(v){var C=-1,H=Array(v.size);return v.forEach(function(re){H[++C]=re}),H}var ze=Array.prototype,et=Function.prototype,$e=Object.prototype,Ve=U["__core-js_shared__"],ht=et.toString,je=$e.hasOwnProperty,Pt=function(){var v=/[^.]+$/.exec(Ve&&Ve.keys&&Ve.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Dt=$e.toString,Ht=RegExp("^"+ht.call(je).replace(Qe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vt=P?U.Buffer:void 0,jt=U.Symbol,Yt=U.Uint8Array,ar=$e.propertyIsEnumerable,Hr=ze.splice,Xt=jt?jt.toStringTag:void 0,Xr=Object.getOwnPropertySymbols,gi=Vt?Vt.isBuffer:void 0,Ti=Ze(Object.keys,Object),lt=vr(U,"DataView"),it=vr(U,"Map"),ft=vr(U,"Promise"),dt=vr(U,"Set"),ct=vr(U,"WeakMap"),nt=vr(Object,"create"),Ot=ei(lt),Ct=ei(it),pt=ei(ft),At=ei(dt),gt=ei(ct),bt=jt?jt.prototype:void 0,yt=bt?bt.valueOf:void 0;function Ye(v){var C=-1,H=v==null?0:v.length;for(this.clear();++C<H;){var re=v[C];this.set(re[0],re[1])}}function Rt(){this.__data__=nt?nt(null):{},this.size=0}function Tt(v){var C=this.has(v)&&delete this.__data__[v];return this.size-=C?1:0,C}function Mo(v){var C=this.__data__;if(nt){var H=C[v];return H===s?void 0:H}return je.call(C,v)?C[v]:void 0}function qo(v){var C=this.__data__;return nt?C[v]!==void 0:je.call(C,v)}function zo(v,C){var H=this.__data__;return this.size+=this.has(v)?0:1,H[v]=nt&&C===void 0?s:C,this}Ye.prototype.clear=Rt,Ye.prototype.delete=Tt,Ye.prototype.get=Mo,Ye.prototype.has=qo,Ye.prototype.set=zo;function Sr(v){var C=-1,H=v==null?0:v.length;for(this.clear();++C<H;){var re=v[C];this.set(re[0],re[1])}}function ko(){this.__data__=[],this.size=0}function Bo(v){var C=this.__data__,H=Ni(C,v);if(H<0)return!1;var re=C.length-1;return H==re?C.pop():Hr.call(C,H,1),--this.size,!0}function Ho(v){var C=this.__data__,H=Ni(C,v);return H<0?void 0:C[H][1]}function Vo(v){return Ni(this.__data__,v)>-1}function Ko(v,C){var H=this.__data__,re=Ni(H,v);return re<0?(++this.size,H.push([v,C])):H[re][1]=C,this}Sr.prototype.clear=ko,Sr.prototype.delete=Bo,Sr.prototype.get=Ho,Sr.prototype.has=Vo,Sr.prototype.set=Ko;function Zr(v){var C=-1,H=v==null?0:v.length;for(this.clear();++C<H;){var re=v[C];this.set(re[0],re[1])}}function Yi(){this.size=0,this.__data__={hash:new Ye,map:new(it||Sr),string:new Ye}}function Wo(v){var C=yi(this,v).delete(v);return this.size-=C?1:0,C}function Xi(v){return yi(this,v).get(v)}function Go(v){return yi(this,v).has(v)}function Jo(v,C){var H=yi(this,v),re=H.size;return H.set(v,C),this.size+=H.size==re?0:1,this}Zr.prototype.clear=Yi,Zr.prototype.delete=Wo,Zr.prototype.get=Xi,Zr.prototype.has=Go,Zr.prototype.set=Jo;function Zi(v){var C=-1,H=v==null?0:v.length;for(this.__data__=new Zr;++C<H;)this.add(v[C])}function ls(v){return this.__data__.set(v,s),this}function fs(v){return this.__data__.has(v)}Zi.prototype.add=Zi.prototype.push=ls,Zi.prototype.has=fs;function Dr(v){var C=this.__data__=new Sr(v);this.size=C.size}function Qo(){this.__data__=new Sr,this.size=0}function Yo(v){var C=this.__data__,H=C.delete(v);return this.size=C.size,H}function Xo(v){return this.__data__.get(v)}function Zo(v){return this.__data__.has(v)}function ds(v,C){var H=this.__data__;if(H instanceof Sr){var re=H.__data__;if(!it||re.length<r-1)return re.push([v,C]),this.size=++H.size,this;H=this.__data__=new Zr(re)}return H.set(v,C),this.size=H.size,this}Dr.prototype.clear=Qo,Dr.prototype.delete=Yo,Dr.prototype.get=Xo,Dr.prototype.has=Zo,Dr.prototype.set=ds;function ps(v,C){var H=rn(v),re=!H&&Ps(v),We=!H&&!re&&Pn(v),me=!H&&!re&&!We&&As(v),tt=H||re||We||me,Nt=tt?xt(v.length,String):[],Ce=Nt.length;for(var Ge in v)(C||je.call(v,Ge))&&!(tt&&(Ge=="length"||We&&(Ge=="offset"||Ge=="parent")||me&&(Ge=="buffer"||Ge=="byteLength"||Ge=="byteOffset")||_s(Ge,Ce)))&&Nt.push(Ge);return Nt}function Ni(v,C){for(var H=v.length;H--;)if(xs(v[H][0],C))return H;return-1}function Sn(v,C,H){var re=C(v);return rn(v)?re:Fe(re,H(v))}function $i(v){return v==null?v===void 0?te:ye:Xt&&Xt in Object(v)?bs(v):ra(v)}function xn(v){return Di(v)&&$i(v)==g}function Fi(v,C,H,re,We){return v===C?!0:v==null||C==null||!Di(v)&&!Di(C)?v!==v&&C!==C:gs(v,C,H,re,Fi,We)}function gs(v,C,H,re,We,me){var tt=rn(v),Nt=rn(C),Ce=tt?E:Vr(v),Ge=Nt?E:Vr(C);Ce=Ce==g?y:Ce,Ge=Ge==g?y:Ge;var wt=Ce==y,cr=Ge==y,$t=Ce==Ge;if($t&&Pn(v)){if(!Pn(C))return!1;tt=!0,wt=!1}if($t&&!wt)return me||(me=new Dr),tt||As(v)?en(v,C,H,re,We,me):ta(v,C,Ce,H,re,We,me);if(!(H&a)){var rt=wt&&je.call(v,"__wrapped__"),Zt=cr&&je.call(C,"__wrapped__");if(rt||Zt){var Lr=rt?v.value():v,xr=Zt?C.value():C;return me||(me=new Dr),We(Lr,xr,H,re,me)}}return $t?(me||(me=new Dr),ms(v,C,H,re,We,me)):!1}function ea(v){if(!Cs(v)||Is(v))return!1;var C=nn(v)?Ht:He;return C.test(ei(v))}function ys(v){return Di(v)&&Os(v.length)&&!!Ie[$i(v)]}function vs(v){if(!Ss(v))return Ti(v);var C=[];for(var H in Object(v))je.call(v,H)&&H!="constructor"&&C.push(H);return C}function en(v,C,H,re,We,me){var tt=H&a,Nt=v.length,Ce=C.length;if(Nt!=Ce&&!(tt&&Ce>Nt))return!1;var Ge=me.get(v);if(Ge&&me.get(C))return Ge==C;var wt=-1,cr=!0,$t=H&u?new Zi:void 0;for(me.set(v,C),me.set(C,v);++wt<Nt;){var rt=v[wt],Zt=C[wt];if(re)var Lr=tt?re(Zt,rt,wt,C,v,me):re(rt,Zt,wt,v,C,me);if(Lr!==void 0){if(Lr)continue;cr=!1;break}if($t){if(!Pe(C,function(xr,Kr){if(!ot($t,Kr)&&(rt===xr||We(rt,xr,H,re,me)))return $t.push(Kr)})){cr=!1;break}}else if(!(rt===Zt||We(rt,Zt,H,re,me))){cr=!1;break}}return me.delete(v),me.delete(C),cr}function ta(v,C,H,re,We,me,tt){switch(H){case Te:if(v.byteLength!=C.byteLength||v.byteOffset!=C.byteOffset)return!1;v=v.buffer,C=C.buffer;case pe:return!(v.byteLength!=C.byteLength||!me(new Yt(v),new Yt(C)));case T:case j:case ce:return xs(+v,+C);case G:return v.name==C.name&&v.message==C.message;case I:case F:return v==C+"";case Y:var Nt=Xe;case b:var Ce=re&a;if(Nt||(Nt=at),v.size!=C.size&&!Ce)return!1;var Ge=tt.get(v);if(Ge)return Ge==C;re|=u,tt.set(v,C);var wt=en(Nt(v),Nt(C),re,We,me,tt);return tt.delete(v),wt;case $:if(yt)return yt.call(v)==yt.call(C)}return!1}function ms(v,C,H,re,We,me){var tt=H&a,Nt=tn(v),Ce=Nt.length,Ge=tn(C),wt=Ge.length;if(Ce!=wt&&!tt)return!1;for(var cr=Ce;cr--;){var $t=Nt[cr];if(!(tt?$t in C:je.call(C,$t)))return!1}var rt=me.get(v);if(rt&&me.get(C))return rt==C;var Zt=!0;me.set(v,C),me.set(C,v);for(var Lr=tt;++cr<Ce;){$t=Nt[cr];var xr=v[$t],Kr=C[$t];if(re)var On=tt?re(Kr,xr,$t,C,v,me):re(xr,Kr,$t,v,C,me);if(!(On===void 0?xr===Kr||We(xr,Kr,H,re,me):On)){Zt=!1;break}Lr||(Lr=$t=="constructor")}if(Zt&&!Lr){var Li=v.constructor,Mt=C.constructor;Li!=Mt&&"constructor"in v&&"constructor"in C&&!(typeof Li=="function"&&Li instanceof Li&&typeof Mt=="function"&&Mt instanceof Mt)&&(Zt=!1)}return me.delete(v),me.delete(C),Zt}function tn(v){return Sn(v,sa,ws)}function yi(v,C){var H=v.__data__;return Es(C)?H[typeof C=="string"?"string":"hash"]:H.map}function vr(v,C){var H=Le(v,C);return ea(H)?H:void 0}function bs(v){var C=je.call(v,Xt),H=v[Xt];try{v[Xt]=void 0;var re=!0}catch{}var We=Dt.call(v);return re&&(C?v[Xt]=H:delete v[Xt]),We}var ws=Xr?function(v){return v==null?[]:(v=Object(v),Ne(Xr(v),function(C){return ar.call(v,C)}))}:Ke,Vr=$i;(lt&&Vr(new lt(new ArrayBuffer(1)))!=Te||it&&Vr(new it)!=Y||ft&&Vr(ft.resolve())!=_||dt&&Vr(new dt)!=b||ct&&Vr(new ct)!=se)&&(Vr=function(v){var C=$i(v),H=C==y?v.constructor:void 0,re=H?ei(H):"";if(re)switch(re){case Ot:return Te;case Ct:return Y;case pt:return _;case At:return b;case gt:return se}return C});function _s(v,C){return C=C??f,!!C&&(typeof v=="number"||Br.test(v))&&v>-1&&v%1==0&&v<C}function Es(v){var C=typeof v;return C=="string"||C=="number"||C=="symbol"||C=="boolean"?v!=="__proto__":v===null}function Is(v){return!!Pt&&Pt in v}function Ss(v){var C=v&&v.constructor,H=typeof C=="function"&&C.prototype||$e;return v===H}function ra(v){return Dt.call(v)}function ei(v){if(v!=null){try{return ht.call(v)}catch{}try{return v+""}catch{}}return""}function xs(v,C){return v===C||v!==v&&C!==C}var Ps=xn(function(){return arguments}())?xn:function(v){return Di(v)&&je.call(v,"callee")&&!ar.call(v,"callee")},rn=Array.isArray;function ia(v){return v!=null&&Os(v.length)&&!nn(v)}var Pn=gi||ke;function na(v,C){return Fi(v,C)}function nn(v){if(!Cs(v))return!1;var C=$i(v);return C==J||C==B||C==N||C==S}function Os(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=f}function Cs(v){var C=typeof v;return v!=null&&(C=="object"||C=="function")}function Di(v){return v!=null&&typeof v=="object"}var As=_e?mt(_e):ys;function sa(v){return ia(v)?ps(v):vs(v)}function Ke(){return[]}function ke(){return!1}n.exports=na})(K_,Co);function W_(n,t){if(n.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<n.length;a++){var u=n.charAt(a),f=u.charCodeAt(0);if(r[f]!==255)throw new TypeError(u+" is ambiguous");r[f]=a}var g=n.length,E=n.charAt(0),N=Math.log(g)/Math.log(256),T=Math.log(256)/Math.log(g);function j(B){if(B instanceof Uint8Array||(ArrayBuffer.isView(B)?B=new Uint8Array(B.buffer,B.byteOffset,B.byteLength):Array.isArray(B)&&(B=Uint8Array.from(B))),!(B instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(B.length===0)return"";for(var Y=0,ce=0,ye=0,y=B.length;ye!==y&&B[ye]===0;)ye++,Y++;for(var _=(y-ye)*T+1>>>0,S=new Uint8Array(_);ye!==y;){for(var I=B[ye],b=0,F=_-1;(I!==0||b<ce)&&F!==-1;F--,b++)I+=256*S[F]>>>0,S[F]=I%g>>>0,I=I/g>>>0;if(I!==0)throw new Error("Non-zero carry");ce=b,ye++}for(var $=_-ce;$!==_&&S[$]===0;)$++;for(var te=E.repeat(Y);$<_;++$)te+=n.charAt(S[$]);return te}function G(B){if(typeof B!="string")throw new TypeError("Expected String");if(B.length===0)return new Uint8Array;var Y=0;if(B[Y]!==" "){for(var ce=0,ye=0;B[Y]===E;)ce++,Y++;for(var y=(B.length-Y)*N+1>>>0,_=new Uint8Array(y);B[Y];){var S=r[B.charCodeAt(Y)];if(S===255)return;for(var I=0,b=y-1;(S!==0||I<ye)&&b!==-1;b--,I++)S+=g*_[b]>>>0,_[b]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");ye=I,Y++}if(B[Y]!==" "){for(var F=y-ye;F!==y&&_[F]===0;)F++;for(var $=new Uint8Array(ce+(y-F)),te=ce;F!==y;)$[te++]=_[F++];return $}}}function J(B){var Y=G(B);if(Y)return Y;throw new Error(`Non-${t} character`)}return{encode:j,decodeUnsafe:G,decode:J}}var G_=W_,J_=G_;const xd=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},Q_=n=>new TextEncoder().encode(n),Y_=n=>new TextDecoder().decode(n);class X_{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Z_{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Pd(this,t)}}class eE{constructor(t){this.decoders=t}or(t){return Pd(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Pd=(n,t)=>new eE({...n.decoders||{[n.prefix]:n},...t.decoders||{[t.prefix]:t}});class tE{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new X_(t,r,s),this.decoder=new Z_(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Uo=({name:n,prefix:t,encode:r,decode:s})=>new tE(n,t,r,s),hs=({prefix:n,name:t,alphabet:r})=>{const{encode:s,decode:a}=J_(r,t);return Uo({prefix:n,name:t,encode:s,decode:u=>xd(a(u))})},rE=(n,t,r,s)=>{const a={};for(let T=0;T<t.length;++T)a[t[T]]=T;let u=n.length;for(;n[u-1]==="=";)--u;const f=new Uint8Array(u*r/8|0);let g=0,E=0,N=0;for(let T=0;T<u;++T){const j=a[n[T]];if(j===void 0)throw new SyntaxError(`Non-${s} character`);E=E<<r|j,g+=r,g>=8&&(g-=8,f[N++]=255&E>>g)}if(g>=r||255&E<<8-g)throw new SyntaxError("Unexpected end of data");return f},iE=(n,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let u="",f=0,g=0;for(let E=0;E<n.length;++E)for(g=g<<8|n[E],f+=8;f>r;)f-=r,u+=t[a&g>>f];if(f&&(u+=t[a&g<<r-f]),s)for(;u.length*r&7;)u+="=";return u},Wt=({name:n,prefix:t,bitsPerChar:r,alphabet:s})=>Uo({prefix:t,name:n,encode(a){return iE(a,s,r)},decode(a){return rE(a,s,r,n)}}),nE=Uo({prefix:"\0",name:"identity",encode:n=>Y_(n),decode:n=>Q_(n)});var sE=Object.freeze({__proto__:null,identity:nE});const oE=Wt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var aE=Object.freeze({__proto__:null,base2:oE});const cE=Wt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var uE=Object.freeze({__proto__:null,base8:cE});const hE=hs({prefix:"9",name:"base10",alphabet:"0123456789"});var lE=Object.freeze({__proto__:null,base10:hE});const fE=Wt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),dE=Wt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var pE=Object.freeze({__proto__:null,base16:fE,base16upper:dE});const gE=Wt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),yE=Wt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),vE=Wt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),mE=Wt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),bE=Wt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),wE=Wt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),_E=Wt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),EE=Wt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),IE=Wt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var SE=Object.freeze({__proto__:null,base32:gE,base32upper:yE,base32pad:vE,base32padupper:mE,base32hex:bE,base32hexupper:wE,base32hexpad:_E,base32hexpadupper:EE,base32z:IE});const xE=hs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),PE=hs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var OE=Object.freeze({__proto__:null,base36:xE,base36upper:PE});const CE=hs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),AE=hs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var RE=Object.freeze({__proto__:null,base58btc:CE,base58flickr:AE});const TE=Wt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),NE=Wt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),$E=Wt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),FE=Wt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var DE=Object.freeze({__proto__:null,base64:TE,base64pad:NE,base64url:$E,base64urlpad:FE});const Od=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),LE=Od.reduce((n,t,r)=>(n[r]=t,n),[]),UE=Od.reduce((n,t,r)=>(n[t.codePointAt(0)]=r,n),[]);function jE(n){return n.reduce((t,r)=>(t+=LE[r],t),"")}function ME(n){const t=[];for(const r of n){const s=UE[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const qE=Uo({prefix:"🚀",name:"base256emoji",encode:jE,decode:ME});var zE=Object.freeze({__proto__:null,base256emoji:qE}),kE=Cd,Jl=128,BE=127,HE=~BE,VE=Math.pow(2,31);function Cd(n,t,r){t=t||[],r=r||0;for(var s=r;n>=VE;)t[r++]=n&255|Jl,n/=128;for(;n&HE;)t[r++]=n&255|Jl,n>>>=7;return t[r]=n|0,Cd.bytes=r-s+1,t}var KE=Dc,WE=128,Ql=127;function Dc(n,s){var r=0,s=s||0,a=0,u=s,f,g=n.length;do{if(u>=g)throw Dc.bytes=0,new RangeError("Could not decode varint");f=n[u++],r+=a<28?(f&Ql)<<a:(f&Ql)*Math.pow(2,a),a+=7}while(f>=WE);return Dc.bytes=u-s,r}var GE=Math.pow(2,7),JE=Math.pow(2,14),QE=Math.pow(2,21),YE=Math.pow(2,28),XE=Math.pow(2,35),ZE=Math.pow(2,42),eI=Math.pow(2,49),tI=Math.pow(2,56),rI=Math.pow(2,63),iI=function(n){return n<GE?1:n<JE?2:n<QE?3:n<YE?4:n<XE?5:n<ZE?6:n<eI?7:n<tI?8:n<rI?9:10},nI={encode:kE,decode:KE,encodingLength:iI},Ad=nI;const Yl=(n,t,r=0)=>(Ad.encode(n,t,r),t),Xl=n=>Ad.encodingLength(n),Lc=(n,t)=>{const r=t.byteLength,s=Xl(n),a=s+Xl(r),u=new Uint8Array(a+r);return Yl(n,u,0),Yl(r,u,s),u.set(t,a),new sI(n,r,t,u)};class sI{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}}const Rd=({name:n,code:t,encode:r})=>new oI(n,t,r);class oI{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Lc(this.code,r):r.then(s=>Lc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const Td=n=>async t=>new Uint8Array(await crypto.subtle.digest(n,t)),aI=Rd({name:"sha2-256",code:18,encode:Td("SHA-256")}),cI=Rd({name:"sha2-512",code:19,encode:Td("SHA-512")});var uI=Object.freeze({__proto__:null,sha256:aI,sha512:cI});const Nd=0,hI="identity",$d=xd,lI=n=>Lc(Nd,$d(n)),fI={code:Nd,name:hI,encode:$d,digest:lI};var dI=Object.freeze({__proto__:null,identity:fI});new TextEncoder,new TextDecoder;const Zl={...sE,...aE,...uE,...lE,...pE,...SE,...OE,...RE,...DE,...zE};({...uI,...dI});function Fd(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function pI(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Fd(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function Dd(n,t,r,s){return{name:n,prefix:t,encoder:{name:n,prefix:t,encode:r},decoder:{decode:s}}}const ef=Dd("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),vc=Dd("ascii","a",n=>{let t="a";for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return t},n=>{n=n.substring(1);const t=pI(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}),gI={utf8:ef,"utf-8":ef,hex:Zl.base16,latin1:vc,ascii:vc,binary:vc,...Zl};function yI(n,t="utf8"){const r=gI[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Fd(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}const Ld="wc",vI=2,Zc="core",Oi=`${Ld}@2:${Zc}:`,mI={name:Zc,logger:"error"},bI={database:":memory:"},wI="crypto",tf="client_ed25519_seed",_I=ue.ONE_DAY,EI="keychain",II="0.3",SI="messages",xI="0.3",PI=ue.SIX_HOURS,OI="publisher",Ud="irn",CI="error",jd="wss://relay.walletconnect.com",rf="wss://relay.walletconnect.org",AI="relayer",Qt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},RI="_subscription",fi={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},TI=ue.ONE_SECOND,NI="2.10.0",$I=1e4,FI="0.3",DI="WALLETCONNECT_CLIENT_ID",Yr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},LI="subscription",UI="0.3",jI=ue.FIVE_SECONDS*1e3,MI="pairing",qI="0.3",Wn={wc_pairingDelete:{req:{ttl:ue.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ue.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ue.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ue.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ue.ONE_DAY,prompt:!1,tag:0},res:{ttl:ue.ONE_DAY,prompt:!1,tag:0}}},Qr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},zI="history",kI="0.3",BI="expirer",$r={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},HI="0.3",mc="verify-api",Io="https://verify.walletconnect.com",nf="https://verify.walletconnect.org";class VI{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=EI,this.version=II,this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:u}=ee("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=Re.generateChildLogger(r,this.name)}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,fd(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?dd(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=ee("NOT_INITIALIZED",this.name);throw new Error(t)}}}class KI{constructor(t,r,s){this.core=t,this.logger=r,this.name=wI,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=Ol(a);return od(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=cw();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),f=Ol(u),g=$c();return await iw(g,a,_I,f)},this.generateSharedKey=(a,u,f)=>{this.isInitialized();const g=this.getPrivateKey(a),E=uw(g,u);return this.setSymKey(E,f)},this.setSymKey=async(a,u)=>{this.isInitialized();const f=u||hw(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,f)=>{this.isInitialized();const g=ld(f),E=kb(u);if(Tl(g)){const G=g.senderPublicKey,J=g.receiverPublicKey;a=await this.generateSharedKey(G,J)}const N=this.getSymKey(a),{type:T,senderPublicKey:j}=g;return fw({type:T,symKey:N,message:E,senderPublicKey:j})},this.decode=async(a,u,f)=>{this.isInitialized();const g=gw(u,f);if(Tl(g)){const E=g.receiverPublicKey,N=g.senderPublicKey;a=await this.generateSharedKey(E,N)}try{const E=this.getSymKey(a),N=dw({symKey:E,encoded:u});return zb(N)}catch(E){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(E)}},this.getPayloadType=a=>{const u=Po(a);return os(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Po(a);return u.senderPublicKey?or(u.senderPublicKey,sr):void 0},this.core=t,this.logger=Re.generateChildLogger(r,this.name),this.keychain=s||new VI(this.core,this.logger)}get context(){return Re.getLoggerContext(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(tf)}catch{t=$c(),await this.keychain.set(tf,t)}return yI(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=ee("NOT_INITIALIZED",this.name);throw new Error(t)}}}let WI=class extends Rb{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=SI,this.version=xI,this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const u=_n(a);let f=this.messages.get(s);return typeof f>"u"&&(f={}),typeof f[u]<"u"||(f[u]=a,this.messages.set(s,f),await this.persist()),u},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const u=this.get(s),f=_n(a);return typeof u[f]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Re.generateChildLogger(t,this.name),this.core=r}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,fd(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?dd(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=ee("NOT_INITIALIZED",this.name);throw new Error(t)}}};class GI extends Tb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Bt.EventEmitter,this.name=OI,this.queue=new Map,this.publishTimeout=ue.toMiliseconds(ue.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,u)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}});try{const g=(u==null?void 0:u.ttl)||PI,E=Fc(u),N=(u==null?void 0:u.prompt)||!1,T=(u==null?void 0:u.tag)||0,j=(u==null?void 0:u.id)||Ed().toString(),G={topic:s,message:a,opts:{ttl:g,relay:E,prompt:N,tag:T,id:j}},J=setTimeout(()=>this.queue.set(j,G),this.publishTimeout);try{await await is(this.rpcPublish(s,a,g,E,N,T,j),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(j),this.relayer.events.emit(Qt.publish,G)}catch(B){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=u==null?void 0:u.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(j),B;return}finally{clearTimeout(J)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=Re.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Re.getLoggerContext(this.logger)}rpcPublish(t,r,s,a,u,f,g){var E,N,T,j;const G={method:_o(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:u,tag:f},id:g};return nr((E=G.params)==null?void 0:E.prompt)&&((N=G.params)==null||delete N.prompt),nr((T=G.params)==null?void 0:T.tag)&&((j=G.params)==null||delete j.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:G}),this.relayer.request(G)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(En.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Qt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Qt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class JI{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(u=>u!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var QI=Object.defineProperty,YI=Object.defineProperties,XI=Object.getOwnPropertyDescriptors,sf=Object.getOwnPropertySymbols,ZI=Object.prototype.hasOwnProperty,eS=Object.prototype.propertyIsEnumerable,of=(n,t,r)=>t in n?QI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Gn=(n,t)=>{for(var r in t||(t={}))ZI.call(t,r)&&of(n,r,t[r]);if(sf)for(var r of sf(t))eS.call(t,r)&&of(n,r,t[r]);return n},bc=(n,t)=>YI(n,XI(t));class tS extends Fb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new JI,this.events=new Bt.EventEmitter,this.name=LI,this.version=UI,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Oi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const u=Fc(a),f={topic:s,relay:u};this.pending.set(s,f);const g=await this.rpcSubscribe(s,u);return this.onSubscribe(g,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),g}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,u)=>{const f=new ue.Watch;f.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(g),f.stop(this.pendingSubscriptionWatchLabel),a(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=jI&&(clearInterval(g),f.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Re.generateChildLogger(r,this.name),this.clientId=""}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=Fc(s);await this.rpcUnsubscribe(t,r,a);const u=zt("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:_o(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await is(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Qt.connection_stalled)}return _n(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:_o(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await is(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Qt.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:_o(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,bc(Gn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Gn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Gn({},r)),this.topicMap.set(r.topic,t),this.events.emit(Yr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=ee("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(Yr.deleted,bc(Gn({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Yr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Yr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=ee("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);us(r)&&this.onBatchSubscribe(r.map((s,a)=>bc(Gn({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(En.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Qt.connect,async()=>{await this.onConnect()}),this.relayer.on(Qt.disconnect,()=>{this.onDisconnect()}),this.events.on(Yr.created,async t=>{const r=Yr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Yr.deleted,async t=>{const r=Yr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=ee("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var rS=Object.defineProperty,af=Object.getOwnPropertySymbols,iS=Object.prototype.hasOwnProperty,nS=Object.prototype.propertyIsEnumerable,cf=(n,t,r)=>t in n?rS(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,sS=(n,t)=>{for(var r in t||(t={}))iS.call(t,r)&&cf(n,r,t[r]);if(af)for(var r of af(t))nS.call(t,r)&&cf(n,r,t[r]);return n};class oS extends Nb{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Bt.EventEmitter,this.name=AI,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Qt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Qt.error,r)},this.registerProviderListeners=()=>{this.provider.on(fi.payload,this.onPayloadHandler),this.provider.on(fi.connect,this.onConnectHandler),this.provider.on(fi.disconnect,this.onDisconnectHandler),this.provider.on(fi.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Re.generateChildLogger(t.logger,this.name):Re.pino(Re.getDefaultLoggerOptions({level:t.logger||CI})),this.messages=new WI(this.logger,t.core),this.subscriber=new tS(this,this.logger),this.publisher=new GI(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||jd,this.projectId=t.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${rf}...`),await this.restartTransport(rf)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},$I)}get context(){return Re.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";return a||(await Promise.all([new Promise(u=>{this.subscriber.once(Yr.created,f=>{f.topic===t&&u()})}),new Promise(async u=>{a=await this.subscriber.subscribe(t,r),u()})]),a)}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await is(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Yr.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await is(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(fi.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await zl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ai(new V_(Pw({sdkVersion:NI,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Xc(t)){if(!t.method.endsWith(RI))return;const r=t.params,{topic:s,message:a,publishedAt:u}=r.data,f={topic:s,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(sS({type:"event",event:r.id},f)),this.events.emit(r.id,f),await this.acknowledgePayload(t),await this.onMessageEvent(f)}else Lo(t)&&this.events.emit(Qt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Qt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=Yc(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(fi.payload,this.onPayloadHandler),this.provider.off(fi.connect,this.onConnectHandler),this.provider.off(fi.disconnect,this.onDisconnectHandler),this.provider.off(fi.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Qt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await zl();m_(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Qt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},ue.toMiliseconds(TI)))}isInitialized(){if(!this.initialized){const{message:t}=ee("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var aS=Object.defineProperty,uf=Object.getOwnPropertySymbols,cS=Object.prototype.hasOwnProperty,uS=Object.prototype.propertyIsEnumerable,hf=(n,t,r)=>t in n?aS(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,lf=(n,t)=>{for(var r in t||(t={}))cS.call(t,r)&&hf(n,r,t[r]);if(uf)for(var r of uf(t))uS.call(t,r)&&hf(n,r,t[r]);return n};class jo extends $b{constructor(t,r,s,a=Oi,u=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=FI,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!nr(f)?this.map.set(this.getKey(f),f):Jw(f)?this.map.set(f.id,f):Qw(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,g)=>{this.isInitialized(),this.map.has(f)?await this.update(f,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:g}),this.map.set(f,g),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(g=>Object.keys(f).every(E=>Co(g[E],f[E]))):this.values),this.update=async(f,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:g});const E=lf(lf({},this.getData(f)),g);this.map.set(f,E),await this.persist()},this.delete=async(f,g)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:g}),this.map.delete(f),await this.persist())},this.logger=Re.generateChildLogger(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=ee("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=ee("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=ee("NOT_INITIALIZED",this.name);throw new Error(t)}}}class hS{constructor(t,r){this.core=t,this.logger=r,this.name=MI,this.version=qI,this.events=new Bt,this.initialized=!1,this.storagePrefix=Oi,this.ignoredPayloadTypes=[Ji],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=$c(),a=await this.core.crypto.setSymKey(s),u=zr(ue.FIVE_MINUTES),f={protocol:Ud},g={topic:a,expiry:u,relay:f,active:!1},E=Mw({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:f});return await this.pairings.set(a,g),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:E}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:u,relay:f}=Lw(s.uri);if(this.pairings.keys.includes(a))throw new Error(`Pairing already exists: ${a}`);if(this.core.crypto.hasKeys(a))throw new Error(`Keychain already exists: ${a}`);const g=zr(ue.FIVE_MINUTES),E={topic:a,relay:f,expiry:g,active:!1};return await this.pairings.set(a,E),await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:f}),this.core.expirer.set(a,g),s.activatePairing&&await this.activate({topic:a}),E},this.activate=async({topic:s})=>{this.isInitialized();const a=zr(ue.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:g,reject:E}=bn();this.events.once(Ft("pairing_ping",u),({error:N})=>{N?E(N):g()}),await f()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",zt("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,u)=>{const f=ns(a,u),g=await this.core.crypto.encode(s,f),E=Wn[a].req;return this.core.history.set(s,f),this.core.relayer.publish(s,g,E),f.id},this.sendResult=async(s,a,u)=>{const f=Yc(s,u),g=await this.core.crypto.encode(a,f),E=await this.core.history.get(a,s),N=Wn[E.request.method].res;await this.core.relayer.publish(a,g,N),await this.core.history.resolve(f)},this.sendError=async(s,a,u)=>{const f=Do(s,u),g=await this.core.crypto.encode(a,f),E=await this.core.history.get(a,s),N=Wn[E.request.method]?Wn[E.request.method].res:Wn.unregistered_method.res;await this.core.relayer.publish(a,g,N),await this.core.history.resolve(f)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,zt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>Pi(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:u}=s,f=(await this.core.history.get(a,u.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(s,a)=>{const{id:u}=a;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit("pairing_ping",{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onPairingPingResponse=(s,a)=>{const{id:u}=a;setTimeout(()=>{pi(a)?this.events.emit(Ft("pairing_ping",u),{}):kr(a)&&this.events.emit(Ft("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit("pairing_delete",{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:u,method:f}=a;try{if(this.registeredMethods.includes(f))return;const g=zt("WC_METHOD_UNSUPPORTED",f);await this.sendError(u,s,g),this.logger.error(g)}catch(g){await this.sendError(u,s,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(zt("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{if(!pr(s)){const{message:a}=ee("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(a)}if(!Gw(s.uri)){const{message:a}=ee("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(a)}},this.isValidPing=async s=>{if(!pr(s)){const{message:u}=ee("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!pr(s)){const{message:u}=ee("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!kt(s,!1)){const{message:a}=ee("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=ee("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(Pi(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=ee("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=Re.generateChildLogger(r,this.name),this.pairings=new jo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Re.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=ee("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Qt.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{Xc(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Lo(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on($r.expired,async t=>{const{topic:r}=gd(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class lS extends Ab{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Bt.EventEmitter,this.name=zI,this.version=kI,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:u}),this.records.has(a.id))return;const f={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:u,expiry:zr(ue.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(Qr.created,f)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=kr(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(Qr.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===s){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(Qr.deleted,u)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Re.generateChildLogger(r,this.name)}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:ns(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=ee("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Qr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=ee("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Qr.created,t=>{const r=Qr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Qr.updated,t=>{const r=Qr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Qr.deleted,t=>{const r=Qr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(En.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{ue.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=ee("NOT_INITIALIZED",this.name);throw new Error(t)}}}class fS extends Db{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Bt.EventEmitter,this.name=BI,this.version=HI,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const u=this.formatTarget(s),f={target:u,expiry:a};this.expirations.set(u,f),this.checkExpiry(u,f),this.events.emit($r.created,{target:u,expiration:f})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit($r.deleted,{target:a,expiration:u})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Re.generateChildLogger(r,this.name)}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return Ow(t);if(typeof t=="number")return Cw(t);const{message:r}=ee("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit($r.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=ee("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=ee("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;ue.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit($r.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(En.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on($r.created,t=>{const r=$r.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on($r.expired,t=>{const r=$r.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on($r.deleted,t=>{const r=$r.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=ee("NOT_INITIALIZED",this.name);throw new Error(t)}}}class dS extends Lb{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=mc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||Fo()||!as())return;const a=(s==null?void 0:s.verifyUrl)||Io;this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.warn(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.warn(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=nf;try{await this.createIframe()}catch(u){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=(s==null?void 0:s.verifyUrl)||Io;let u="";try{u=await this.fetchAttestation(s.attestationId,a)}catch(f){this.logger.warn(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.warn(f),u=await this.fetchAttestation(s.attestationId,nf)}return u},this.fetchAttestation=async(s,a)=>{var u;this.logger.info(`resolving attestation: ${s} from url: ${a}`);const f=this.startAbortTimer(ue.ONE_SECOND*2),g=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(f),g.status===200?(u=await g.json())==null?void 0:u.origin:""},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(u=>{if(document.getElementById(mc))return u();window.addEventListener("message",a);const f=document.createElement("iframe");f.id=mc,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,s=u}),new Promise((u,f)=>setTimeout(()=>{window.removeEventListener("message",a),f("verify iframe load timeout")},ue.toMiliseconds(ue.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Re.generateChildLogger(r,this.name),this.verifyUrl=Io,this.abortController=new AbortController,this.isDevEnv=Wc()&&{}.IS_VITEST}get context(){return Re.getLoggerContext(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ue.toMiliseconds(t))}}var pS=Object.defineProperty,ff=Object.getOwnPropertySymbols,gS=Object.prototype.hasOwnProperty,yS=Object.prototype.propertyIsEnumerable,df=(n,t,r)=>t in n?pS(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,pf=(n,t)=>{for(var r in t||(t={}))gS.call(t,r)&&df(n,r,t[r]);if(ff)for(var r of ff(t))yS.call(t,r)&&df(n,r,t[r]);return n};class eu extends Cb{constructor(t){super(t),this.protocol=Ld,this.version=vI,this.name=Zc,this.events=new Bt.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||jd;const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Re.pino(Re.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||mI.logger}));this.logger=Re.generateChildLogger(r,this.name),this.heartbeat=new En.HeartBeat,this.crypto=new KI(this,this.logger,t==null?void 0:t.keychain),this.history=new lS(this,this.logger),this.expirer=new fS(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new bb(pf(pf({},bI),t==null?void 0:t.storageOptions)),this.relayer=new oS({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new hS(this,this.logger),this.verify=new dS(this.projectId||"",this.logger)}static async init(t){const r=new eu(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(DI,s),r}get context(){return Re.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const vS=eu,Md="wc",qd=2,zd="client",tu=`${Md}@${qd}:${zd}:`,wc={name:zd,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},gf="WALLETCONNECT_DEEPLINK_CHOICE",mS="proposal",kd="Proposal expired",bS="session",vo=ue.SEVEN_DAYS,wS="engine",Jn={wc_sessionPropose:{req:{ttl:ue.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ue.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ue.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ue.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ue.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ue.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ue.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ue.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ue.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ue.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ue.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ue.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ue.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ue.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ue.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ue.THIRTY_SECONDS,prompt:!1,tag:1115}}},_c={min:ue.FIVE_MINUTES,max:ue.SEVEN_DAYS},di={idle:"IDLE",active:"ACTIVE"},_S="request",ES=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var IS=Object.defineProperty,SS=Object.defineProperties,xS=Object.getOwnPropertyDescriptors,yf=Object.getOwnPropertySymbols,PS=Object.prototype.hasOwnProperty,OS=Object.prototype.propertyIsEnumerable,vf=(n,t,r)=>t in n?IS(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,dr=(n,t)=>{for(var r in t||(t={}))PS.call(t,r)&&vf(n,r,t[r]);if(yf)for(var r of yf(t))OS.call(t,r)&&vf(n,r,t[r]);return n},Qn=(n,t)=>SS(n,xS(t));class CS extends jb{constructor(t){super(t),this.name=wS,this.events=new Bt,this.initialized=!1,this.ignoredPayloadTypes=[Ji],this.requestQueue={state:di.idle,queue:[]},this.sessionRequestQueue={state:di.idle,queue:[]},this.requestQueueDelay=ue.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(Jn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ue.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=Qn(dr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:f,sessionProperties:g,relays:E}=s;let N=a,T,j=!1;if(N&&(j=this.client.core.pairing.pairings.get(N).active),!N||!j){const{topic:_,uri:S}=await this.client.core.pairing.create();N=_,T=S}const G=await this.client.core.crypto.generateKeyPair(),J=dr({requiredNamespaces:u,optionalNamespaces:f,relays:E??[{protocol:Ud}],proposer:{publicKey:G,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:B,resolve:Y,done:ce}=bn(ue.FIVE_MINUTES,kd);if(this.events.once(Ft("session_connect"),async({error:_,session:S})=>{if(_)B(_);else if(S){S.self.publicKey=G;const I=Qn(dr({},S),{requiredNamespaces:S.requiredNamespaces,optionalNamespaces:S.optionalNamespaces});await this.client.session.set(S.topic,I),await this.setExpiry(S.topic,S.expiry),N&&await this.client.core.pairing.updateMetadata({topic:N,metadata:S.peer.metadata}),Y(I)}}),!N){const{message:_}=ee("NO_MATCHING_KEY",`connect() pairing topic: ${N}`);throw new Error(_)}const ye=await this.sendRequest({topic:N,method:"wc_sessionPropose",params:J}),y=zr(ue.FIVE_MINUTES);return await this.setProposal(ye,dr({id:ye,expiry:y},J)),{uri:T,approval:ce}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:u,sessionProperties:f}=r,g=this.client.proposal.get(s);let{pairingTopic:E,proposer:N,requiredNamespaces:T,optionalNamespaces:j}=g;E=E||"",es(T)||(T=Bw(u,"approve()"));const G=await this.client.core.crypto.generateKeyPair(),J=N.publicKey,B=await this.client.core.crypto.generateSharedKey(G,J);E&&s&&(await this.client.core.pairing.updateMetadata({topic:E,metadata:N.metadata}),await this.sendResult({id:s,topic:E,result:{relay:{protocol:a??"irn"},responderPublicKey:G}}),await this.client.proposal.delete(s,zt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:E}));const Y=dr({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:T,optionalNamespaces:j,pairingTopic:E,controller:{publicKey:G,metadata:this.client.metadata},expiry:zr(vo)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(B),await this.sendRequest({topic:B,method:"wc_sessionSettle",params:Y,throwOnFailedPublish:!0});const ce=Qn(dr({},Y),{topic:B,pairingTopic:E,acknowledged:!1,self:Y.controller,peer:{publicKey:N.publicKey,metadata:N.metadata},controller:G});return await this.client.session.set(B,ce),await this.setExpiry(B,zr(vo)),{topic:B,acknowledged:()=>new Promise(ye=>setTimeout(()=>ye(this.client.session.get(B)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,a),await this.client.proposal.delete(s,zt("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:f,resolve:g,reject:E}=bn();return this.events.once(Ft("session_update",u),({error:N})=>{N?E(N):g()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:f}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:f,reject:g}=bn();return this.events.once(Ft("session_extend",a),({error:E})=>{E?g(E):f()}),await this.setExpiry(s,zr(vo)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:u,expiry:f}=r,g=Qc(),{done:E,resolve:N,reject:T}=bn(f);return this.events.once(Ft("session_request",g),({error:j,result:G})=>{j?T(j):N(G)}),await Promise.all([new Promise(async j=>{await this.sendRequest({clientRpcId:g,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:f,throwOnFailedPublish:!0}).catch(G=>T(G)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:s,id:g}),j()}),new Promise(async j=>{const G=await this.client.core.storage.getItem(gf);Aw({id:g,topic:u,wcDeepLink:G}),j()}),E()]).then(j=>j[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:u}=a;pi(a)?await this.sendResult({id:u,topic:s,result:a.result,throwOnFailedPublish:!0}):kr(a)&&await this.sendError(u,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:f,reject:g}=bn();this.events.once(Ft("session_ping",a),({error:E})=>{E?g(E):f()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:u}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:zt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>Kw(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var f,g;return((f=u.peerMetadata)==null?void 0:f.url)&&((g=u.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,zt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(gf).catch(u=>this.client.logger.warn(u))},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,zt("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=di.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=Jn.wc_sessionRequest.req.ttl,{id:a,topic:u,params:f}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:f}),s&&this.client.core.expirer.set(a,zr(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:u,expiry:f,relayRpcId:g,clientRpcId:E,throwOnFailedPublish:N}=r,T=ns(a,u,E);if(as()&&ES.includes(a)){const J=_n(JSON.stringify(T));this.client.core.verify.register({attestationId:J})}const j=await this.client.core.crypto.encode(s,T),G=Jn[a].req;return f&&(G.ttl=f),g&&(G.id=g),this.client.core.history.set(s,T),N?(G.internal=Qn(dr({},G.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,j,G)):this.client.core.relayer.publish(s,j,G).catch(J=>this.client.logger.error(J)),T.id},this.sendResult=async r=>{const{id:s,topic:a,result:u,throwOnFailedPublish:f}=r,g=Yc(s,u),E=await this.client.core.crypto.encode(a,g),N=await this.client.core.history.get(a,s),T=Jn[N.request.method].res;f?(T.internal=Qn(dr({},T.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,E,T)):this.client.core.relayer.publish(a,E,T).catch(j=>this.client.logger.error(j)),await this.client.core.history.resolve(g)},this.sendError=async(r,s,a)=>{const u=Do(r,a),f=await this.client.core.crypto.encode(s,u),g=await this.client.core.history.get(s,r),E=Jn[g.request.method].res;this.client.core.relayer.publish(s,f,E),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{Pi(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Pi(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===di.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=di.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=di.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,u=(await this.client.core.history.get(s,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=ee("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:u}=s;try{this.isValidConnect(dr({},s.params));const f=zr(ue.FIVE_MINUTES),g=dr({id:u,pairingTopic:r,expiry:f},a);await this.setProposal(u,g);const E=_n(JSON.stringify(s)),N=await this.getVerifyContext(E,g.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:g,verifyContext:N})}catch(f){await this.sendError(u,r,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(pi(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const E=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:E});const N=await this.client.core.crypto.generateSharedKey(g,E);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:N});const T=await this.client.core.relayer.subscribe(N);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:T}),await this.client.core.pairing.activate({topic:r})}else kr(s)&&(await this.client.proposal.delete(a,zt("USER_DISCONNECTED")),this.events.emit(Ft("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:f,controller:g,expiry:E,namespaces:N,requiredNamespaces:T,optionalNamespaces:j,sessionProperties:G,pairingTopic:J}=s.params,B=dr({topic:r,relay:f,expiry:E,namespaces:N,acknowledged:!0,pairingTopic:J,requiredNamespaces:T,optionalNamespaces:j,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},G&&{sessionProperties:G});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(Ft("session_connect"),{session:B}),this.cleanupDuplicatePairings(B)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;pi(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ft("session_approve",a),{})):kr(s)&&(await this.client.session.delete(r,zt("USER_DISCONNECTED")),this.events.emit(Ft("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:u}=s;try{const f=`${r}_session_update`,g=yo.get(f);if(g&&this.isRequestOutOfSync(g,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(dr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),yo.set(f,u)}catch(f){await this.sendError(u,r,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;pi(s)?this.events.emit(Ft("session_update",a),{}):kr(s)&&this.events.emit(Ft("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,zr(vo)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;pi(s)?this.events.emit(Ft("session_extend",a),{}):kr(s)&&this.events.emit(Ft("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{pi(s)?this.events.emit(Ft("session_ping",a),{}):kr(s)&&this.events.emit(Ft("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Qt.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidRequest(dr({topic:r},u)),await this.setPendingSessionRequest({id:a,topic:r,params:u}),this.addSessionRequestToSessionRequestQueue({id:a,topic:r,params:u}),await this.processSessionRequestQueue()}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;pi(s)?this.events.emit(Ft("session_request",a),{result:s.result}):kr(s)&&this.events.emit(Ft("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:u}=s;try{const f=`${r}_session_event_${u.event.name}`,g=yo.get(f);if(g&&this.isRequestOutOfSync(g,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(dr({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),yo.set(f,a)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=di.idle,this.processSessionRequestQueue()},ue.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=async()=>{if(this.sessionRequestQueue.state===di.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{const{id:s,topic:a,params:u}=r,f=_n(JSON.stringify(ns("wc_sessionRequest",u,s))),g=this.client.session.get(a),E=await this.getVerifyContext(f,g.peer.metadata);this.sessionRequestQueue.state=di.active,this.client.events.emit("session_request",{id:s,topic:a,params:u,verifyContext:E})}catch(s){this.client.logger.error(s)}},this.isValidConnect=async r=>{if(!pr(r)){const{message:E}=ee("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(E)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:f,relays:g}=r;if(nr(s)||await this.isValidPairingTopic(s),!n_(g,!0)){const{message:E}=ee("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(E)}!nr(a)&&es(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!nr(u)&&es(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),nr(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=i_(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!pr(r))throw new Error(ee("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:u,sessionProperties:f}=r;await this.isValidProposalId(s);const g=this.client.proposal.get(s),E=Eo(a,"approve()");if(E)throw new Error(E.message);const N=Ml(g.requiredNamespaces,a,"approve()");if(N)throw new Error(N.message);if(!kt(u,!0)){const{message:T}=ee("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(T)}nr(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async r=>{if(!pr(r)){const{message:u}=ee("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!o_(a)){const{message:u}=ee("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!pr(r)){const{message:N}=ee("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(N)}const{relay:s,controller:a,namespaces:u,expiry:f}=r;if(!vd(s)){const{message:N}=ee("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(N)}const g=Yw(a,"onSessionSettleRequest()");if(g)throw new Error(g.message);const E=Eo(u,"onSessionSettleRequest()");if(E)throw new Error(E.message);if(Pi(f)){const{message:N}=ee("EXPIRED","onSessionSettleRequest()");throw new Error(N)}},this.isValidUpdate=async r=>{if(!pr(r)){const{message:E}=ee("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(E)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const u=this.client.session.get(s),f=Eo(a,"update()");if(f)throw new Error(f.message);const g=Ml(u.requiredNamespaces,a,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!pr(r)){const{message:a}=ee("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!pr(r)){const{message:E}=ee("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(E)}const{topic:s,request:a,chainId:u,expiry:f}=r;await this.isValidSessionTopic(s);const{namespaces:g}=this.client.session.get(s);if(!jl(g,u)){const{message:E}=ee("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(E)}if(!a_(a)){const{message:E}=ee("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(E)}if(!h_(g,u,a.method)){const{message:E}=ee("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(E)}if(f&&!p_(f,_c)){const{message:E}=ee("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${_c.min} and ${_c.max}`);throw new Error(E)}},this.isValidRespond=async r=>{if(!pr(r)){const{message:u}=ee("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(u)}const{topic:s,response:a}=r;if(await this.isValidSessionTopic(s),!c_(a)){const{message:u}=ee("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidPing=async r=>{if(!pr(r)){const{message:a}=ee("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!pr(r)){const{message:g}=ee("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:s,event:a,chainId:u}=r;await this.isValidSessionTopic(s);const{namespaces:f}=this.client.session.get(s);if(!jl(f,u)){const{message:g}=ee("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(g)}if(!u_(a)){const{message:g}=ee("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}if(!l_(f,u,a.name)){const{message:g}=ee("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!pr(r)){const{message:a}=ee("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||Io,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});u&&(a.verified.origin=u,a.verified.validation=u===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.error(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!kt(a,!1)){const{message:u}=ee("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:t}=ee("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Qt.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{Xc(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Lo(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on($r.expired,async t=>{const{topic:r,id:s}=gd(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,ee("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}isValidPairingTopic(t){if(!kt(t,!1)){const{message:r}=ee("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=ee("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Pi(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=ee("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!kt(t,!1)){const{message:r}=ee("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=ee("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Pi(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=ee("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(kt(t,!1)){const{message:r}=ee("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=ee("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!s_(t)){const{message:r}=ee("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=ee("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Pi(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=ee("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class AS extends jo{constructor(t,r){super(t,r,mS,tu),this.core=t,this.logger=r}}class RS extends jo{constructor(t,r){super(t,r,bS,tu),this.core=t,this.logger=r}}class TS extends jo{constructor(t,r){super(t,r,_S,tu,s=>s.id),this.core=t,this.logger=r}}let NS=class Bd extends Ub{constructor(t){super(t),this.protocol=Md,this.version=qd,this.name=wc.name,this.events=new Bt.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||wc.name,this.metadata=(t==null?void 0:t.metadata)||Ew();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Re.pino(Re.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||wc.logger}));this.core=(t==null?void 0:t.core)||new vS(t),this.logger=Re.generateChildLogger(r,this.name),this.session=new RS(this.core,this.logger),this.proposal=new AS(this.core,this.logger),this.pendingRequest=new TS(this.core,this.logger),this.engine=new CS(this)}static async init(t){const r=new Bd(t);return await r.initialize(),r}get context(){return Re.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var $S={},Hd="%[a-f0-9]{2}",mf=new RegExp("("+Hd+")|([^%]+?)","gi"),bf=new RegExp("("+Hd+")+","gi");function Uc(n,t){try{return[decodeURIComponent(n.join(""))]}catch{}if(n.length===1)return n;t=t||1;var r=n.slice(0,t),s=n.slice(t);return Array.prototype.concat.call([],Uc(r),Uc(s))}function FS(n){try{return decodeURIComponent(n)}catch{for(var t=n.match(mf)||[],r=1;r<t.length;r++)n=Uc(t,r).join(""),t=n.match(mf)||[];return n}}function DS(n){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=bf.exec(n);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch{var s=FS(r[0]);s!==r[0]&&(t[r[0]]=s)}r=bf.exec(n)}t["%C2"]="�";for(var a=Object.keys(t),u=0;u<a.length;u++){var f=a[u];n=n.replace(new RegExp(f,"g"),t[f])}return n}var LS=function(n){if(typeof n!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof n+"`");try{return n=n.replace(/\+/g," "),decodeURIComponent(n)}catch{return DS(n)}};(function(n){const t=jf,r=LS,s=Lf,a=Uf,u=y=>y==null,f=Symbol("encodeFragmentIdentifier");function g(y){switch(y.arrayFormat){case"index":return _=>(S,I)=>{const b=S.length;return I===void 0||y.skipNull&&I===null||y.skipEmptyString&&I===""?S:I===null?[...S,[T(_,y),"[",b,"]"].join("")]:[...S,[T(_,y),"[",T(b,y),"]=",T(I,y)].join("")]};case"bracket":return _=>(S,I)=>I===void 0||y.skipNull&&I===null||y.skipEmptyString&&I===""?S:I===null?[...S,[T(_,y),"[]"].join("")]:[...S,[T(_,y),"[]=",T(I,y)].join("")];case"colon-list-separator":return _=>(S,I)=>I===void 0||y.skipNull&&I===null||y.skipEmptyString&&I===""?S:I===null?[...S,[T(_,y),":list="].join("")]:[...S,[T(_,y),":list=",T(I,y)].join("")];case"comma":case"separator":case"bracket-separator":{const _=y.arrayFormat==="bracket-separator"?"[]=":"=";return S=>(I,b)=>b===void 0||y.skipNull&&b===null||y.skipEmptyString&&b===""?I:(b=b===null?"":b,I.length===0?[[T(S,y),_,T(b,y)].join("")]:[[I,T(b,y)].join(y.arrayFormatSeparator)])}default:return _=>(S,I)=>I===void 0||y.skipNull&&I===null||y.skipEmptyString&&I===""?S:I===null?[...S,T(_,y)]:[...S,[T(_,y),"=",T(I,y)].join("")]}}function E(y){let _;switch(y.arrayFormat){case"index":return(S,I,b)=>{if(_=/\[(\d*)\]$/.exec(S),S=S.replace(/\[\d*\]$/,""),!_){b[S]=I;return}b[S]===void 0&&(b[S]={}),b[S][_[1]]=I};case"bracket":return(S,I,b)=>{if(_=/(\[\])$/.exec(S),S=S.replace(/\[\]$/,""),!_){b[S]=I;return}if(b[S]===void 0){b[S]=[I];return}b[S]=[].concat(b[S],I)};case"colon-list-separator":return(S,I,b)=>{if(_=/(:list)$/.exec(S),S=S.replace(/:list$/,""),!_){b[S]=I;return}if(b[S]===void 0){b[S]=[I];return}b[S]=[].concat(b[S],I)};case"comma":case"separator":return(S,I,b)=>{const F=typeof I=="string"&&I.includes(y.arrayFormatSeparator),$=typeof I=="string"&&!F&&j(I,y).includes(y.arrayFormatSeparator);I=$?j(I,y):I;const te=F||$?I.split(y.arrayFormatSeparator).map(se=>j(se,y)):I===null?I:j(I,y);b[S]=te};case"bracket-separator":return(S,I,b)=>{const F=/(\[\])$/.test(S);if(S=S.replace(/\[\]$/,""),!F){b[S]=I&&j(I,y);return}const $=I===null?[]:I.split(y.arrayFormatSeparator).map(te=>j(te,y));if(b[S]===void 0){b[S]=$;return}b[S]=[].concat(b[S],$)};default:return(S,I,b)=>{if(b[S]===void 0){b[S]=I;return}b[S]=[].concat(b[S],I)}}}function N(y){if(typeof y!="string"||y.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function T(y,_){return _.encode?_.strict?t(y):encodeURIComponent(y):y}function j(y,_){return _.decode?r(y):y}function G(y){return Array.isArray(y)?y.sort():typeof y=="object"?G(Object.keys(y)).sort((_,S)=>Number(_)-Number(S)).map(_=>y[_]):y}function J(y){const _=y.indexOf("#");return _!==-1&&(y=y.slice(0,_)),y}function B(y){let _="";const S=y.indexOf("#");return S!==-1&&(_=y.slice(S)),_}function Y(y){y=J(y);const _=y.indexOf("?");return _===-1?"":y.slice(_+1)}function ce(y,_){return _.parseNumbers&&!Number.isNaN(Number(y))&&typeof y=="string"&&y.trim()!==""?y=Number(y):_.parseBooleans&&y!==null&&(y.toLowerCase()==="true"||y.toLowerCase()==="false")&&(y=y.toLowerCase()==="true"),y}function ye(y,_){_=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},_),N(_.arrayFormatSeparator);const S=E(_),I=Object.create(null);if(typeof y!="string"||(y=y.trim().replace(/^[?#&]/,""),!y))return I;for(const b of y.split("&")){if(b==="")continue;let[F,$]=s(_.decode?b.replace(/\+/g," "):b,"=");$=$===void 0?null:["comma","separator","bracket-separator"].includes(_.arrayFormat)?$:j($,_),S(j(F,_),$,I)}for(const b of Object.keys(I)){const F=I[b];if(typeof F=="object"&&F!==null)for(const $ of Object.keys(F))F[$]=ce(F[$],_);else I[b]=ce(F,_)}return _.sort===!1?I:(_.sort===!0?Object.keys(I).sort():Object.keys(I).sort(_.sort)).reduce((b,F)=>{const $=I[F];return $&&typeof $=="object"&&!Array.isArray($)?b[F]=G($):b[F]=$,b},Object.create(null))}n.extract=Y,n.parse=ye,n.stringify=(y,_)=>{if(!y)return"";_=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},_),N(_.arrayFormatSeparator);const S=$=>_.skipNull&&u(y[$])||_.skipEmptyString&&y[$]==="",I=g(_),b={};for(const $ of Object.keys(y))S($)||(b[$]=y[$]);const F=Object.keys(b);return _.sort!==!1&&F.sort(_.sort),F.map($=>{const te=y[$];return te===void 0?"":te===null?T($,_):Array.isArray(te)?te.length===0&&_.arrayFormat==="bracket-separator"?T($,_)+"[]":te.reduce(I($),[]).join("&"):T($,_)+"="+T(te,_)}).filter($=>$.length>0).join("&")},n.parseUrl=(y,_)=>{_=Object.assign({decode:!0},_);const[S,I]=s(y,"#");return Object.assign({url:S.split("?")[0]||"",query:ye(Y(y),_)},_&&_.parseFragmentIdentifier&&I?{fragmentIdentifier:j(I,_)}:{})},n.stringifyUrl=(y,_)=>{_=Object.assign({encode:!0,strict:!0,[f]:!0},_);const S=J(y.url).split("?")[0]||"",I=n.extract(y.url),b=n.parse(I,{sort:!1}),F=Object.assign(b,y.query);let $=n.stringify(F,_);$&&($=`?${$}`);let te=B(y.url);return y.fragmentIdentifier&&(te=`#${_[f]?T(y.fragmentIdentifier,_):y.fragmentIdentifier}`),`${S}${$}${te}`},n.pick=(y,_,S)=>{S=Object.assign({parseFragmentIdentifier:!0,[f]:!1},S);const{url:I,query:b,fragmentIdentifier:F}=n.parseUrl(y,S);return n.stringifyUrl({url:I,query:a(b,_),fragmentIdentifier:F},S)},n.exclude=(y,_,S)=>{const I=Array.isArray(_)?b=>!_.includes(b):(b,F)=>!_(b,F);return n.pick(y,I,S)}})($S);function Ec(n=[],t=[]){return[...new Set([...n,...t])]}function ru(n){return n.includes(":")}function Xn(n){return ru(n)?n.split(":")[0]:n}const US={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function wf(n,t){const{message:r,code:s}=US[n];return{message:t?`${r} ${t}`:r,code:s}}function _f(n,t){return Array.isArray(n)?typeof t<"u"&&n.length?n.every(t):!0:!1}function jS(n){return Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length}var Ao={},MS={get exports(){return Ao},set exports(n){Ao=n}};(function(n,t){var r=typeof self<"u"?self:gr,s=function(){function u(){this.fetch=!1,this.DOMException=r.DOMException}return u.prototype=r,new u}();(function(u){(function(f){var g={searchParams:"URLSearchParams"in u,iterable:"Symbol"in u&&"iterator"in Symbol,blob:"FileReader"in u&&"Blob"in u&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in u,arrayBuffer:"ArrayBuffer"in u};function E(m){return m&&DataView.prototype.isPrototypeOf(m)}if(g.arrayBuffer)var N=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],T=ArrayBuffer.isView||function(m){return m&&N.indexOf(Object.prototype.toString.call(m))>-1};function j(m){if(typeof m!="string"&&(m=String(m)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(m))throw new TypeError("Invalid character in header field name");return m.toLowerCase()}function G(m){return typeof m!="string"&&(m=String(m)),m}function J(m){var O={next:function(){var ie=m.shift();return{done:ie===void 0,value:ie}}};return g.iterable&&(O[Symbol.iterator]=function(){return O}),O}function B(m){this.map={},m instanceof B?m.forEach(function(O,ie){this.append(ie,O)},this):Array.isArray(m)?m.forEach(function(O){this.append(O[0],O[1])},this):m&&Object.getOwnPropertyNames(m).forEach(function(O){this.append(O,m[O])},this)}B.prototype.append=function(m,O){m=j(m),O=G(O);var ie=this.map[m];this.map[m]=ie?ie+", "+O:O},B.prototype.delete=function(m){delete this.map[j(m)]},B.prototype.get=function(m){return m=j(m),this.has(m)?this.map[m]:null},B.prototype.has=function(m){return this.map.hasOwnProperty(j(m))},B.prototype.set=function(m,O){this.map[j(m)]=G(O)},B.prototype.forEach=function(m,O){for(var ie in this.map)this.map.hasOwnProperty(ie)&&m.call(O,this.map[ie],ie,this)},B.prototype.keys=function(){var m=[];return this.forEach(function(O,ie){m.push(ie)}),J(m)},B.prototype.values=function(){var m=[];return this.forEach(function(O){m.push(O)}),J(m)},B.prototype.entries=function(){var m=[];return this.forEach(function(O,ie){m.push([ie,O])}),J(m)},g.iterable&&(B.prototype[Symbol.iterator]=B.prototype.entries);function Y(m){if(m.bodyUsed)return Promise.reject(new TypeError("Already read"));m.bodyUsed=!0}function ce(m){return new Promise(function(O,ie){m.onload=function(){O(m.result)},m.onerror=function(){ie(m.error)}})}function ye(m){var O=new FileReader,ie=ce(O);return O.readAsArrayBuffer(m),ie}function y(m){var O=new FileReader,ie=ce(O);return O.readAsText(m),ie}function _(m){for(var O=new Uint8Array(m),ie=new Array(O.length),de=0;de<O.length;de++)ie[de]=String.fromCharCode(O[de]);return ie.join("")}function S(m){if(m.slice)return m.slice(0);var O=new Uint8Array(m.byteLength);return O.set(new Uint8Array(m)),O.buffer}function I(){return this.bodyUsed=!1,this._initBody=function(m){this._bodyInit=m,m?typeof m=="string"?this._bodyText=m:g.blob&&Blob.prototype.isPrototypeOf(m)?this._bodyBlob=m:g.formData&&FormData.prototype.isPrototypeOf(m)?this._bodyFormData=m:g.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)?this._bodyText=m.toString():g.arrayBuffer&&g.blob&&E(m)?(this._bodyArrayBuffer=S(m.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):g.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(m)||T(m))?this._bodyArrayBuffer=S(m):this._bodyText=m=Object.prototype.toString.call(m):this._bodyText="",this.headers.get("content-type")||(typeof m=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var m=Y(this);if(m)return m;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?Y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(ye)}),this.text=function(){var m=Y(this);if(m)return m;if(this._bodyBlob)return y(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(_(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(te)}),this.json=function(){return this.text().then(JSON.parse)},this}var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function F(m){var O=m.toUpperCase();return b.indexOf(O)>-1?O:m}function $(m,O){O=O||{};var ie=O.body;if(m instanceof $){if(m.bodyUsed)throw new TypeError("Already read");this.url=m.url,this.credentials=m.credentials,O.headers||(this.headers=new B(m.headers)),this.method=m.method,this.mode=m.mode,this.signal=m.signal,!ie&&m._bodyInit!=null&&(ie=m._bodyInit,m.bodyUsed=!0)}else this.url=String(m);if(this.credentials=O.credentials||this.credentials||"same-origin",(O.headers||!this.headers)&&(this.headers=new B(O.headers)),this.method=F(O.method||this.method||"GET"),this.mode=O.mode||this.mode||null,this.signal=O.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&ie)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(ie)}$.prototype.clone=function(){return new $(this,{body:this._bodyInit})};function te(m){var O=new FormData;return m.trim().split("&").forEach(function(ie){if(ie){var de=ie.split("="),Q=de.shift().replace(/\+/g," "),V=de.join("=").replace(/\+/g," ");O.append(decodeURIComponent(Q),decodeURIComponent(V))}}),O}function se(m){var O=new B,ie=m.replace(/\r?\n[\t ]+/g," ");return ie.split(/\r?\n/).forEach(function(de){var Q=de.split(":"),V=Q.shift().trim();if(V){var W=Q.join(":").trim();O.append(V,W)}}),O}I.call($.prototype);function pe(m,O){O||(O={}),this.type="default",this.status=O.status===void 0?200:O.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in O?O.statusText:"OK",this.headers=new B(O.headers),this.url=O.url||"",this._initBody(m)}I.call(pe.prototype),pe.prototype.clone=function(){return new pe(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new B(this.headers),url:this.url})},pe.error=function(){var m=new pe(null,{status:0,statusText:""});return m.type="error",m};var Te=[301,302,303,307,308];pe.redirect=function(m,O){if(Te.indexOf(O)===-1)throw new RangeError("Invalid status code");return new pe(null,{status:O,headers:{location:m}})},f.DOMException=u.DOMException;try{new f.DOMException}catch{f.DOMException=function(O,ie){this.message=O,this.name=ie;var de=Error(O);this.stack=de.stack},f.DOMException.prototype=Object.create(Error.prototype),f.DOMException.prototype.constructor=f.DOMException}function qe(m,O){return new Promise(function(ie,de){var Q=new $(m,O);if(Q.signal&&Q.signal.aborted)return de(new f.DOMException("Aborted","AbortError"));var V=new XMLHttpRequest;function W(){V.abort()}V.onload=function(){var X={status:V.status,statusText:V.statusText,headers:se(V.getAllResponseHeaders()||"")};X.url="responseURL"in V?V.responseURL:X.headers.get("X-Request-URL");var Qe="response"in V?V.response:V.responseText;ie(new pe(Qe,X))},V.onerror=function(){de(new TypeError("Network request failed"))},V.ontimeout=function(){de(new TypeError("Network request failed"))},V.onabort=function(){de(new f.DOMException("Aborted","AbortError"))},V.open(Q.method,Q.url,!0),Q.credentials==="include"?V.withCredentials=!0:Q.credentials==="omit"&&(V.withCredentials=!1),"responseType"in V&&g.blob&&(V.responseType="blob"),Q.headers.forEach(function(X,Qe){V.setRequestHeader(Qe,X)}),Q.signal&&(Q.signal.addEventListener("abort",W),V.onreadystatechange=function(){V.readyState===4&&Q.signal.removeEventListener("abort",W)}),V.send(typeof Q._bodyInit>"u"?null:Q._bodyInit)})}return qe.polyfill=!0,u.fetch||(u.fetch=qe,u.Headers=B,u.Request=$,u.Response=pe),f.Headers=B,f.Request=$,f.Response=pe,f.fetch=qe,Object.defineProperty(f,"__esModule",{value:!0}),f})({})})(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var a=s;t=a.fetch,t.default=a.fetch,t.fetch=a.fetch,t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response,n.exports=t})(MS,Ao);const Ef=q1(Ao),qS={Accept:"application/json","Content-Type":"application/json"},zS="POST",If={headers:qS,method:zS},Sf=10;class Qi{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new Bt.EventEmitter,this.isAvailable=!1,this.registering=!1,!Vl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t,r){this.isAvailable||await this.register();try{const s=Ac(t),u=await(await Ef(this.url,Object.assign(Object.assign({},If),{body:s}))).json();this.onPayload({data:u})}catch(s){this.onError(t.id,s)}}async register(t=this.url){if(!Vl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return a(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=Ac({id:1,jsonrpc:"2.0",method:"test",params:[]});await Ef(t,Object.assign(Object.assign({},If),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?Zb(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),u=Do(t,a);this.events.emit("payload",u)}parseError(t,r=this.url){return wd(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Sf&&this.events.setMaxListeners(Sf)}}const xf="error",kS="wss://relay.walletconnect.com",BS="wc",HS="universal_provider",Pf=`${BS}@2:${HS}:`,VS="https://rpc.walletconnect.com/v1",Ri={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Yn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(n,t){(function(){var r,s="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",g="Invalid `variable` option passed into `_.template`",E="__lodash_hash_undefined__",N=500,T="__lodash_placeholder__",j=1,G=2,J=4,B=1,Y=2,ce=1,ye=2,y=4,_=8,S=16,I=32,b=64,F=128,$=256,te=512,se=30,pe="...",Te=800,qe=16,m=1,O=2,ie=3,de=1/0,Q=9007199254740991,V=17976931348623157e292,W=0/0,X=4294967295,Qe=X-1,He=X>>>1,Br=[["ary",F],["bind",ce],["bindKey",ye],["curry",_],["curryRight",S],["flip",te],["partial",I],["partialRight",b],["rearg",$]],Ie="[object Arguments]",St="[object Array]",M="[object AsyncFunction]",U="[object Boolean]",D="[object Date]",h="[object DOMException]",P="[object Error]",oe="[object Function]",ge="[object GeneratorFunction]",_e="[object Map]",Ne="[object Number]",Fe="[object Null]",Pe="[object Object]",xt="[object Promise]",mt="[object Proxy]",ot="[object RegExp]",Le="[object Set]",Xe="[object String]",Ze="[object Symbol]",at="[object Undefined]",ze="[object WeakMap]",et="[object WeakSet]",$e="[object ArrayBuffer]",Ve="[object DataView]",ht="[object Float32Array]",je="[object Float64Array]",Pt="[object Int8Array]",Dt="[object Int16Array]",Ht="[object Int32Array]",Vt="[object Uint8Array]",jt="[object Uint8ClampedArray]",Yt="[object Uint16Array]",ar="[object Uint32Array]",Hr=/\b__p \+= '';/g,Xt=/\b(__p \+=) '' \+/g,Xr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,gi=/&(?:amp|lt|gt|quot|#39);/g,Ti=/[&<>"']/g,lt=RegExp(gi.source),it=RegExp(Ti.source),ft=/<%-([\s\S]+?)%>/g,dt=/<%([\s\S]+?)%>/g,ct=/<%=([\s\S]+?)%>/g,nt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(pt.source),gt=/^\s+/,bt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ye=/\{\n\/\* \[wrapped with (.+)\] \*/,Rt=/,? & /,Tt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Mo=/[()=,{}\[\]\/\s]/,qo=/\\(\\)?/g,zo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Sr=/\w*$/,ko=/^[-+]0x[0-9a-f]+$/i,Bo=/^0b[01]+$/i,Ho=/^\[object .+?Constructor\]$/,Vo=/^0o[0-7]+$/i,Ko=/^(?:0|[1-9]\d*)$/,Zr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Yi=/($^)/,Wo=/['\n\r\u2028\u2029\\]/g,Xi="\\ud800-\\udfff",Go="\\u0300-\\u036f",Jo="\\ufe20-\\ufe2f",Zi="\\u20d0-\\u20ff",ls=Go+Jo+Zi,fs="\\u2700-\\u27bf",Dr="a-z\\xdf-\\xf6\\xf8-\\xff",Qo="\\xac\\xb1\\xd7\\xf7",Yo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Xo="\\u2000-\\u206f",Zo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ds="A-Z\\xc0-\\xd6\\xd8-\\xde",ps="\\ufe0e\\ufe0f",Ni=Qo+Yo+Xo+Zo,Sn="['’]",$i="["+Xi+"]",xn="["+Ni+"]",Fi="["+ls+"]",gs="\\d+",ea="["+fs+"]",ys="["+Dr+"]",vs="[^"+Xi+Ni+gs+fs+Dr+ds+"]",en="\\ud83c[\\udffb-\\udfff]",ta="(?:"+Fi+"|"+en+")",ms="[^"+Xi+"]",tn="(?:\\ud83c[\\udde6-\\uddff]){2}",yi="[\\ud800-\\udbff][\\udc00-\\udfff]",vr="["+ds+"]",bs="\\u200d",ws="(?:"+ys+"|"+vs+")",Vr="(?:"+vr+"|"+vs+")",_s="(?:"+Sn+"(?:d|ll|m|re|s|t|ve))?",Es="(?:"+Sn+"(?:D|LL|M|RE|S|T|VE))?",Is=ta+"?",Ss="["+ps+"]?",ra="(?:"+bs+"(?:"+[ms,tn,yi].join("|")+")"+Ss+Is+")*",ei="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",xs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ps=Ss+Is+ra,rn="(?:"+[ea,tn,yi].join("|")+")"+Ps,ia="(?:"+[ms+Fi+"?",Fi,tn,yi,$i].join("|")+")",Pn=RegExp(Sn,"g"),na=RegExp(Fi,"g"),nn=RegExp(en+"(?="+en+")|"+ia+Ps,"g"),Os=RegExp([vr+"?"+ys+"+"+_s+"(?="+[xn,vr,"$"].join("|")+")",Vr+"+"+Es+"(?="+[xn,vr+ws,"$"].join("|")+")",vr+"?"+ws+"+"+_s,vr+"+"+Es,xs,ei,gs,rn].join("|"),"g"),Cs=RegExp("["+bs+Xi+ls+ps+"]"),Di=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,As=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],sa=-1,Ke={};Ke[ht]=Ke[je]=Ke[Pt]=Ke[Dt]=Ke[Ht]=Ke[Vt]=Ke[jt]=Ke[Yt]=Ke[ar]=!0,Ke[Ie]=Ke[St]=Ke[$e]=Ke[U]=Ke[Ve]=Ke[D]=Ke[P]=Ke[oe]=Ke[_e]=Ke[Ne]=Ke[Pe]=Ke[ot]=Ke[Le]=Ke[Xe]=Ke[ze]=!1;var ke={};ke[Ie]=ke[St]=ke[$e]=ke[Ve]=ke[U]=ke[D]=ke[ht]=ke[je]=ke[Pt]=ke[Dt]=ke[Ht]=ke[_e]=ke[Ne]=ke[Pe]=ke[ot]=ke[Le]=ke[Xe]=ke[Ze]=ke[Vt]=ke[jt]=ke[Yt]=ke[ar]=!0,ke[P]=ke[oe]=ke[ze]=!1;var v={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},C={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},H={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},re={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},We=parseFloat,me=parseInt,tt=typeof Yn=="object"&&Yn&&Yn.Object===Object&&Yn,Nt=typeof self=="object"&&self&&self.Object===Object&&self,Ce=tt||Nt||Function("return this")(),Ge=t&&!t.nodeType&&t,wt=Ge&&!0&&n&&!n.nodeType&&n,cr=wt&&wt.exports===Ge,$t=cr&&tt.process,rt=function(){try{var A=wt&&wt.require&&wt.require("util").types;return A||$t&&$t.binding&&$t.binding("util")}catch{}}(),Zt=rt&&rt.isArrayBuffer,Lr=rt&&rt.isDate,xr=rt&&rt.isMap,Kr=rt&&rt.isRegExp,On=rt&&rt.isSet,Li=rt&&rt.isTypedArray;function Mt(A,q,L){switch(L.length){case 0:return A.call(q);case 1:return A.call(q,L[0]);case 2:return A.call(q,L[0],L[1]);case 3:return A.call(q,L[0],L[1],L[2])}return A.apply(q,L)}function Wd(A,q,L,ne){for(var ve=-1,De=A==null?0:A.length;++ve<De;){var Lt=A[ve];q(ne,Lt,L(Lt),A)}return ne}function Pr(A,q){for(var L=-1,ne=A==null?0:A.length;++L<ne&&q(A[L],L,A)!==!1;);return A}function Gd(A,q){for(var L=A==null?0:A.length;L--&&q(A[L],L,A)!==!1;);return A}function su(A,q){for(var L=-1,ne=A==null?0:A.length;++L<ne;)if(!q(A[L],L,A))return!1;return!0}function vi(A,q){for(var L=-1,ne=A==null?0:A.length,ve=0,De=[];++L<ne;){var Lt=A[L];q(Lt,L,A)&&(De[ve++]=Lt)}return De}function Rs(A,q){var L=A==null?0:A.length;return!!L&&sn(A,q,0)>-1}function oa(A,q,L){for(var ne=-1,ve=A==null?0:A.length;++ne<ve;)if(L(q,A[ne]))return!0;return!1}function st(A,q){for(var L=-1,ne=A==null?0:A.length,ve=Array(ne);++L<ne;)ve[L]=q(A[L],L,A);return ve}function mi(A,q){for(var L=-1,ne=q.length,ve=A.length;++L<ne;)A[ve+L]=q[L];return A}function aa(A,q,L,ne){var ve=-1,De=A==null?0:A.length;for(ne&&De&&(L=A[++ve]);++ve<De;)L=q(L,A[ve],ve,A);return L}function Jd(A,q,L,ne){var ve=A==null?0:A.length;for(ne&&ve&&(L=A[--ve]);ve--;)L=q(L,A[ve],ve,A);return L}function ca(A,q){for(var L=-1,ne=A==null?0:A.length;++L<ne;)if(q(A[L],L,A))return!0;return!1}var Qd=ua("length");function Yd(A){return A.split("")}function Xd(A){return A.match(Tt)||[]}function ou(A,q,L){var ne;return L(A,function(ve,De,Lt){if(q(ve,De,Lt))return ne=De,!1}),ne}function Ts(A,q,L,ne){for(var ve=A.length,De=L+(ne?1:-1);ne?De--:++De<ve;)if(q(A[De],De,A))return De;return-1}function sn(A,q,L){return q===q?hp(A,q,L):Ts(A,au,L)}function Zd(A,q,L,ne){for(var ve=L-1,De=A.length;++ve<De;)if(ne(A[ve],q))return ve;return-1}function au(A){return A!==A}function cu(A,q){var L=A==null?0:A.length;return L?la(A,q)/L:W}function ua(A){return function(q){return q==null?r:q[A]}}function ha(A){return function(q){return A==null?r:A[q]}}function uu(A,q,L,ne,ve){return ve(A,function(De,Lt,Je){L=ne?(ne=!1,De):q(L,De,Lt,Je)}),L}function ep(A,q){var L=A.length;for(A.sort(q);L--;)A[L]=A[L].value;return A}function la(A,q){for(var L,ne=-1,ve=A.length;++ne<ve;){var De=q(A[ne]);De!==r&&(L=L===r?De:L+De)}return L}function fa(A,q){for(var L=-1,ne=Array(A);++L<A;)ne[L]=q(L);return ne}function tp(A,q){return st(q,function(L){return[L,A[L]]})}function hu(A){return A&&A.slice(0,pu(A)+1).replace(gt,"")}function mr(A){return function(q){return A(q)}}function da(A,q){return st(q,function(L){return A[L]})}function Cn(A,q){return A.has(q)}function lu(A,q){for(var L=-1,ne=A.length;++L<ne&&sn(q,A[L],0)>-1;);return L}function fu(A,q){for(var L=A.length;L--&&sn(q,A[L],0)>-1;);return L}function rp(A,q){for(var L=A.length,ne=0;L--;)A[L]===q&&++ne;return ne}var ip=ha(v),np=ha(C);function sp(A){return"\\"+re[A]}function op(A,q){return A==null?r:A[q]}function on(A){return Cs.test(A)}function ap(A){return Di.test(A)}function cp(A){for(var q,L=[];!(q=A.next()).done;)L.push(q.value);return L}function pa(A){var q=-1,L=Array(A.size);return A.forEach(function(ne,ve){L[++q]=[ve,ne]}),L}function du(A,q){return function(L){return A(q(L))}}function bi(A,q){for(var L=-1,ne=A.length,ve=0,De=[];++L<ne;){var Lt=A[L];(Lt===q||Lt===T)&&(A[L]=T,De[ve++]=L)}return De}function Ns(A){var q=-1,L=Array(A.size);return A.forEach(function(ne){L[++q]=ne}),L}function up(A){var q=-1,L=Array(A.size);return A.forEach(function(ne){L[++q]=[ne,ne]}),L}function hp(A,q,L){for(var ne=L-1,ve=A.length;++ne<ve;)if(A[ne]===q)return ne;return-1}function lp(A,q,L){for(var ne=L+1;ne--;)if(A[ne]===q)return ne;return ne}function an(A){return on(A)?dp(A):Qd(A)}function Ur(A){return on(A)?pp(A):Yd(A)}function pu(A){for(var q=A.length;q--&&bt.test(A.charAt(q)););return q}var fp=ha(H);function dp(A){for(var q=nn.lastIndex=0;nn.test(A);)++q;return q}function pp(A){return A.match(nn)||[]}function gp(A){return A.match(Os)||[]}var yp=function A(q){q=q==null?Ce:cn.defaults(Ce.Object(),q,cn.pick(Ce,As));var L=q.Array,ne=q.Date,ve=q.Error,De=q.Function,Lt=q.Math,Je=q.Object,ga=q.RegExp,vp=q.String,Or=q.TypeError,$s=L.prototype,mp=De.prototype,un=Je.prototype,Fs=q["__core-js_shared__"],Ds=mp.toString,Me=un.hasOwnProperty,bp=0,gu=function(){var e=/[^.]+$/.exec(Fs&&Fs.keys&&Fs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ls=un.toString,wp=Ds.call(Je),_p=Ce._,Ep=ga("^"+Ds.call(Me).replace(pt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Us=cr?q.Buffer:r,wi=q.Symbol,js=q.Uint8Array,yu=Us?Us.allocUnsafe:r,Ms=du(Je.getPrototypeOf,Je),vu=Je.create,mu=un.propertyIsEnumerable,qs=$s.splice,bu=wi?wi.isConcatSpreadable:r,An=wi?wi.iterator:r,Ui=wi?wi.toStringTag:r,zs=function(){try{var e=ki(Je,"defineProperty");return e({},"",{}),e}catch{}}(),Ip=q.clearTimeout!==Ce.clearTimeout&&q.clearTimeout,Sp=ne&&ne.now!==Ce.Date.now&&ne.now,xp=q.setTimeout!==Ce.setTimeout&&q.setTimeout,ks=Lt.ceil,Bs=Lt.floor,ya=Je.getOwnPropertySymbols,Pp=Us?Us.isBuffer:r,wu=q.isFinite,Op=$s.join,Cp=du(Je.keys,Je),Ut=Lt.max,Gt=Lt.min,Ap=ne.now,Rp=q.parseInt,_u=Lt.random,Tp=$s.reverse,va=ki(q,"DataView"),Rn=ki(q,"Map"),ma=ki(q,"Promise"),hn=ki(q,"Set"),Tn=ki(q,"WeakMap"),Nn=ki(Je,"create"),Hs=Tn&&new Tn,ln={},Np=Bi(va),$p=Bi(Rn),Fp=Bi(ma),Dp=Bi(hn),Lp=Bi(Tn),Vs=wi?wi.prototype:r,$n=Vs?Vs.valueOf:r,Eu=Vs?Vs.toString:r;function d(e){if(vt(e)&&!be(e)&&!(e instanceof Oe)){if(e instanceof Cr)return e;if(Me.call(e,"__wrapped__"))return Ih(e)}return new Cr(e)}var fn=function(){function e(){}return function(i){if(!ut(i))return{};if(vu)return vu(i);e.prototype=i;var o=new e;return e.prototype=r,o}}();function Ks(){}function Cr(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}d.templateSettings={escape:ft,evaluate:dt,interpolate:ct,variable:"",imports:{_:d}},d.prototype=Ks.prototype,d.prototype.constructor=d,Cr.prototype=fn(Ks.prototype),Cr.prototype.constructor=Cr;function Oe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=X,this.__views__=[]}function Up(){var e=new Oe(this.__wrapped__);return e.__actions__=ur(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ur(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ur(this.__views__),e}function jp(){if(this.__filtered__){var e=new Oe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Mp(){var e=this.__wrapped__.value(),i=this.__dir__,o=be(e),c=i<0,l=o?e.length:0,p=Yg(0,l,this.__views__),w=p.start,x=p.end,R=x-w,z=c?x:w-1,k=this.__iteratees__,K=k.length,Z=0,ae=Gt(R,this.__takeCount__);if(!o||!c&&l==R&&ae==R)return Ku(e,this.__actions__);var le=[];e:for(;R--&&Z<ae;){z+=i;for(var Ee=-1,fe=e[z];++Ee<K;){var xe=k[Ee],Ae=xe.iteratee,_r=xe.type,rr=Ae(fe);if(_r==O)fe=rr;else if(!rr){if(_r==m)continue e;break e}}le[Z++]=fe}return le}Oe.prototype=fn(Ks.prototype),Oe.prototype.constructor=Oe;function ji(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function qp(){this.__data__=Nn?Nn(null):{},this.size=0}function zp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function kp(e){var i=this.__data__;if(Nn){var o=i[e];return o===E?r:o}return Me.call(i,e)?i[e]:r}function Bp(e){var i=this.__data__;return Nn?i[e]!==r:Me.call(i,e)}function Hp(e,i){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=Nn&&i===r?E:i,this}ji.prototype.clear=qp,ji.prototype.delete=zp,ji.prototype.get=kp,ji.prototype.has=Bp,ji.prototype.set=Hp;function ti(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function Vp(){this.__data__=[],this.size=0}function Kp(e){var i=this.__data__,o=Ws(i,e);if(o<0)return!1;var c=i.length-1;return o==c?i.pop():qs.call(i,o,1),--this.size,!0}function Wp(e){var i=this.__data__,o=Ws(i,e);return o<0?r:i[o][1]}function Gp(e){return Ws(this.__data__,e)>-1}function Jp(e,i){var o=this.__data__,c=Ws(o,e);return c<0?(++this.size,o.push([e,i])):o[c][1]=i,this}ti.prototype.clear=Vp,ti.prototype.delete=Kp,ti.prototype.get=Wp,ti.prototype.has=Gp,ti.prototype.set=Jp;function ri(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function Qp(){this.size=0,this.__data__={hash:new ji,map:new(Rn||ti),string:new ji}}function Yp(e){var i=so(this,e).delete(e);return this.size-=i?1:0,i}function Xp(e){return so(this,e).get(e)}function Zp(e){return so(this,e).has(e)}function eg(e,i){var o=so(this,e),c=o.size;return o.set(e,i),this.size+=o.size==c?0:1,this}ri.prototype.clear=Qp,ri.prototype.delete=Yp,ri.prototype.get=Xp,ri.prototype.has=Zp,ri.prototype.set=eg;function Mi(e){var i=-1,o=e==null?0:e.length;for(this.__data__=new ri;++i<o;)this.add(e[i])}function tg(e){return this.__data__.set(e,E),this}function rg(e){return this.__data__.has(e)}Mi.prototype.add=Mi.prototype.push=tg,Mi.prototype.has=rg;function jr(e){var i=this.__data__=new ti(e);this.size=i.size}function ig(){this.__data__=new ti,this.size=0}function ng(e){var i=this.__data__,o=i.delete(e);return this.size=i.size,o}function sg(e){return this.__data__.get(e)}function og(e){return this.__data__.has(e)}function ag(e,i){var o=this.__data__;if(o instanceof ti){var c=o.__data__;if(!Rn||c.length<a-1)return c.push([e,i]),this.size=++o.size,this;o=this.__data__=new ri(c)}return o.set(e,i),this.size=o.size,this}jr.prototype.clear=ig,jr.prototype.delete=ng,jr.prototype.get=sg,jr.prototype.has=og,jr.prototype.set=ag;function Iu(e,i){var o=be(e),c=!o&&Hi(e),l=!o&&!c&&xi(e),p=!o&&!c&&!l&&yn(e),w=o||c||l||p,x=w?fa(e.length,vp):[],R=x.length;for(var z in e)(i||Me.call(e,z))&&!(w&&(z=="length"||l&&(z=="offset"||z=="parent")||p&&(z=="buffer"||z=="byteLength"||z=="byteOffset")||oi(z,R)))&&x.push(z);return x}function Su(e){var i=e.length;return i?e[Aa(0,i-1)]:r}function cg(e,i){return oo(ur(e),qi(i,0,e.length))}function ug(e){return oo(ur(e))}function ba(e,i,o){(o!==r&&!Mr(e[i],o)||o===r&&!(i in e))&&ii(e,i,o)}function Fn(e,i,o){var c=e[i];(!(Me.call(e,i)&&Mr(c,o))||o===r&&!(i in e))&&ii(e,i,o)}function Ws(e,i){for(var o=e.length;o--;)if(Mr(e[o][0],i))return o;return-1}function hg(e,i,o,c){return _i(e,function(l,p,w){i(c,l,o(l),w)}),c}function xu(e,i){return e&&Gr(i,qt(i),e)}function lg(e,i){return e&&Gr(i,lr(i),e)}function ii(e,i,o){i=="__proto__"&&zs?zs(e,i,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[i]=o}function wa(e,i){for(var o=-1,c=i.length,l=L(c),p=e==null;++o<c;)l[o]=p?r:ec(e,i[o]);return l}function qi(e,i,o){return e===e&&(o!==r&&(e=e<=o?e:o),i!==r&&(e=e>=i?e:i)),e}function Ar(e,i,o,c,l,p){var w,x=i&j,R=i&G,z=i&J;if(o&&(w=l?o(e,c,l,p):o(e)),w!==r)return w;if(!ut(e))return e;var k=be(e);if(k){if(w=Zg(e),!x)return ur(e,w)}else{var K=Jt(e),Z=K==oe||K==ge;if(xi(e))return Ju(e,x);if(K==Pe||K==Ie||Z&&!l){if(w=R||Z?{}:ph(e),!x)return R?kg(e,lg(w,e)):zg(e,xu(w,e))}else{if(!ke[K])return l?e:{};w=ey(e,K,x)}}p||(p=new jr);var ae=p.get(e);if(ae)return ae;p.set(e,w),Bh(e)?e.forEach(function(fe){w.add(Ar(fe,i,o,fe,e,p))}):zh(e)&&e.forEach(function(fe,xe){w.set(xe,Ar(fe,i,o,xe,e,p))});var le=z?R?qa:Ma:R?lr:qt,Ee=k?r:le(e);return Pr(Ee||e,function(fe,xe){Ee&&(xe=fe,fe=e[xe]),Fn(w,xe,Ar(fe,i,o,xe,e,p))}),w}function fg(e){var i=qt(e);return function(o){return Pu(o,e,i)}}function Pu(e,i,o){var c=o.length;if(e==null)return!c;for(e=Je(e);c--;){var l=o[c],p=i[l],w=e[l];if(w===r&&!(l in e)||!p(w))return!1}return!0}function Ou(e,i,o){if(typeof e!="function")throw new Or(f);return zn(function(){e.apply(r,o)},i)}function Dn(e,i,o,c){var l=-1,p=Rs,w=!0,x=e.length,R=[],z=i.length;if(!x)return R;o&&(i=st(i,mr(o))),c?(p=oa,w=!1):i.length>=a&&(p=Cn,w=!1,i=new Mi(i));e:for(;++l<x;){var k=e[l],K=o==null?k:o(k);if(k=c||k!==0?k:0,w&&K===K){for(var Z=z;Z--;)if(i[Z]===K)continue e;R.push(k)}else p(i,K,c)||R.push(k)}return R}var _i=eh(Wr),Cu=eh(Ea,!0);function dg(e,i){var o=!0;return _i(e,function(c,l,p){return o=!!i(c,l,p),o}),o}function Gs(e,i,o){for(var c=-1,l=e.length;++c<l;){var p=e[c],w=i(p);if(w!=null&&(x===r?w===w&&!wr(w):o(w,x)))var x=w,R=p}return R}function pg(e,i,o,c){var l=e.length;for(o=we(o),o<0&&(o=-o>l?0:l+o),c=c===r||c>l?l:we(c),c<0&&(c+=l),c=o>c?0:Vh(c);o<c;)e[o++]=i;return e}function Au(e,i){var o=[];return _i(e,function(c,l,p){i(c,l,p)&&o.push(c)}),o}function Kt(e,i,o,c,l){var p=-1,w=e.length;for(o||(o=ry),l||(l=[]);++p<w;){var x=e[p];i>0&&o(x)?i>1?Kt(x,i-1,o,c,l):mi(l,x):c||(l[l.length]=x)}return l}var _a=th(),Ru=th(!0);function Wr(e,i){return e&&_a(e,i,qt)}function Ea(e,i){return e&&Ru(e,i,qt)}function Js(e,i){return vi(i,function(o){return ai(e[o])})}function zi(e,i){i=Ii(i,e);for(var o=0,c=i.length;e!=null&&o<c;)e=e[Jr(i[o++])];return o&&o==c?e:r}function Tu(e,i,o){var c=i(e);return be(e)?c:mi(c,o(e))}function er(e){return e==null?e===r?at:Fe:Ui&&Ui in Je(e)?Qg(e):uy(e)}function Ia(e,i){return e>i}function gg(e,i){return e!=null&&Me.call(e,i)}function yg(e,i){return e!=null&&i in Je(e)}function vg(e,i,o){return e>=Gt(i,o)&&e<Ut(i,o)}function Sa(e,i,o){for(var c=o?oa:Rs,l=e[0].length,p=e.length,w=p,x=L(p),R=1/0,z=[];w--;){var k=e[w];w&&i&&(k=st(k,mr(i))),R=Gt(k.length,R),x[w]=!o&&(i||l>=120&&k.length>=120)?new Mi(w&&k):r}k=e[0];var K=-1,Z=x[0];e:for(;++K<l&&z.length<R;){var ae=k[K],le=i?i(ae):ae;if(ae=o||ae!==0?ae:0,!(Z?Cn(Z,le):c(z,le,o))){for(w=p;--w;){var Ee=x[w];if(!(Ee?Cn(Ee,le):c(e[w],le,o)))continue e}Z&&Z.push(le),z.push(ae)}}return z}function mg(e,i,o,c){return Wr(e,function(l,p,w){i(c,o(l),p,w)}),c}function Ln(e,i,o){i=Ii(i,e),e=mh(e,i);var c=e==null?e:e[Jr(Tr(i))];return c==null?r:Mt(c,e,o)}function Nu(e){return vt(e)&&er(e)==Ie}function bg(e){return vt(e)&&er(e)==$e}function wg(e){return vt(e)&&er(e)==D}function Un(e,i,o,c,l){return e===i?!0:e==null||i==null||!vt(e)&&!vt(i)?e!==e&&i!==i:_g(e,i,o,c,Un,l)}function _g(e,i,o,c,l,p){var w=be(e),x=be(i),R=w?St:Jt(e),z=x?St:Jt(i);R=R==Ie?Pe:R,z=z==Ie?Pe:z;var k=R==Pe,K=z==Pe,Z=R==z;if(Z&&xi(e)){if(!xi(i))return!1;w=!0,k=!1}if(Z&&!k)return p||(p=new jr),w||yn(e)?lh(e,i,o,c,l,p):Gg(e,i,R,o,c,l,p);if(!(o&B)){var ae=k&&Me.call(e,"__wrapped__"),le=K&&Me.call(i,"__wrapped__");if(ae||le){var Ee=ae?e.value():e,fe=le?i.value():i;return p||(p=new jr),l(Ee,fe,o,c,p)}}return Z?(p||(p=new jr),Jg(e,i,o,c,l,p)):!1}function Eg(e){return vt(e)&&Jt(e)==_e}function xa(e,i,o,c){var l=o.length,p=l,w=!c;if(e==null)return!p;for(e=Je(e);l--;){var x=o[l];if(w&&x[2]?x[1]!==e[x[0]]:!(x[0]in e))return!1}for(;++l<p;){x=o[l];var R=x[0],z=e[R],k=x[1];if(w&&x[2]){if(z===r&&!(R in e))return!1}else{var K=new jr;if(c)var Z=c(z,k,R,e,i,K);if(!(Z===r?Un(k,z,B|Y,c,K):Z))return!1}}return!0}function $u(e){if(!ut(e)||ny(e))return!1;var i=ai(e)?Ep:Ho;return i.test(Bi(e))}function Ig(e){return vt(e)&&er(e)==ot}function Sg(e){return vt(e)&&Jt(e)==Le}function xg(e){return vt(e)&&fo(e.length)&&!!Ke[er(e)]}function Fu(e){return typeof e=="function"?e:e==null?fr:typeof e=="object"?be(e)?Uu(e[0],e[1]):Lu(e):rl(e)}function Pa(e){if(!qn(e))return Cp(e);var i=[];for(var o in Je(e))Me.call(e,o)&&o!="constructor"&&i.push(o);return i}function Pg(e){if(!ut(e))return cy(e);var i=qn(e),o=[];for(var c in e)c=="constructor"&&(i||!Me.call(e,c))||o.push(c);return o}function Oa(e,i){return e<i}function Du(e,i){var o=-1,c=hr(e)?L(e.length):[];return _i(e,function(l,p,w){c[++o]=i(l,p,w)}),c}function Lu(e){var i=ka(e);return i.length==1&&i[0][2]?yh(i[0][0],i[0][1]):function(o){return o===e||xa(o,e,i)}}function Uu(e,i){return Ha(e)&&gh(i)?yh(Jr(e),i):function(o){var c=ec(o,e);return c===r&&c===i?tc(o,e):Un(i,c,B|Y)}}function Qs(e,i,o,c,l){e!==i&&_a(i,function(p,w){if(l||(l=new jr),ut(p))Og(e,i,w,o,Qs,c,l);else{var x=c?c(Ka(e,w),p,w+"",e,i,l):r;x===r&&(x=p),ba(e,w,x)}},lr)}function Og(e,i,o,c,l,p,w){var x=Ka(e,o),R=Ka(i,o),z=w.get(R);if(z){ba(e,o,z);return}var k=p?p(x,R,o+"",e,i,w):r,K=k===r;if(K){var Z=be(R),ae=!Z&&xi(R),le=!Z&&!ae&&yn(R);k=R,Z||ae||le?be(x)?k=x:_t(x)?k=ur(x):ae?(K=!1,k=Ju(R,!0)):le?(K=!1,k=Qu(R,!0)):k=[]:kn(R)||Hi(R)?(k=x,Hi(x)?k=Kh(x):(!ut(x)||ai(x))&&(k=ph(R))):K=!1}K&&(w.set(R,k),l(k,R,c,p,w),w.delete(R)),ba(e,o,k)}function ju(e,i){var o=e.length;if(o)return i+=i<0?o:0,oi(i,o)?e[i]:r}function Mu(e,i,o){i.length?i=st(i,function(p){return be(p)?function(w){return zi(w,p.length===1?p[0]:p)}:p}):i=[fr];var c=-1;i=st(i,mr(he()));var l=Du(e,function(p,w,x){var R=st(i,function(z){return z(p)});return{criteria:R,index:++c,value:p}});return ep(l,function(p,w){return qg(p,w,o)})}function Cg(e,i){return qu(e,i,function(o,c){return tc(e,c)})}function qu(e,i,o){for(var c=-1,l=i.length,p={};++c<l;){var w=i[c],x=zi(e,w);o(x,w)&&jn(p,Ii(w,e),x)}return p}function Ag(e){return function(i){return zi(i,e)}}function Ca(e,i,o,c){var l=c?Zd:sn,p=-1,w=i.length,x=e;for(e===i&&(i=ur(i)),o&&(x=st(e,mr(o)));++p<w;)for(var R=0,z=i[p],k=o?o(z):z;(R=l(x,k,R,c))>-1;)x!==e&&qs.call(x,R,1),qs.call(e,R,1);return e}function zu(e,i){for(var o=e?i.length:0,c=o-1;o--;){var l=i[o];if(o==c||l!==p){var p=l;oi(l)?qs.call(e,l,1):Na(e,l)}}return e}function Aa(e,i){return e+Bs(_u()*(i-e+1))}function Rg(e,i,o,c){for(var l=-1,p=Ut(ks((i-e)/(o||1)),0),w=L(p);p--;)w[c?p:++l]=e,e+=o;return w}function Ra(e,i){var o="";if(!e||i<1||i>Q)return o;do i%2&&(o+=e),i=Bs(i/2),i&&(e+=e);while(i);return o}function Se(e,i){return Wa(vh(e,i,fr),e+"")}function Tg(e){return Su(vn(e))}function Ng(e,i){var o=vn(e);return oo(o,qi(i,0,o.length))}function jn(e,i,o,c){if(!ut(e))return e;i=Ii(i,e);for(var l=-1,p=i.length,w=p-1,x=e;x!=null&&++l<p;){var R=Jr(i[l]),z=o;if(R==="__proto__"||R==="constructor"||R==="prototype")return e;if(l!=w){var k=x[R];z=c?c(k,R,x):r,z===r&&(z=ut(k)?k:oi(i[l+1])?[]:{})}Fn(x,R,z),x=x[R]}return e}var ku=Hs?function(e,i){return Hs.set(e,i),e}:fr,$g=zs?function(e,i){return zs(e,"toString",{configurable:!0,enumerable:!1,value:ic(i),writable:!0})}:fr;function Fg(e){return oo(vn(e))}function Rr(e,i,o){var c=-1,l=e.length;i<0&&(i=-i>l?0:l+i),o=o>l?l:o,o<0&&(o+=l),l=i>o?0:o-i>>>0,i>>>=0;for(var p=L(l);++c<l;)p[c]=e[c+i];return p}function Dg(e,i){var o;return _i(e,function(c,l,p){return o=i(c,l,p),!o}),!!o}function Ys(e,i,o){var c=0,l=e==null?c:e.length;if(typeof i=="number"&&i===i&&l<=He){for(;c<l;){var p=c+l>>>1,w=e[p];w!==null&&!wr(w)&&(o?w<=i:w<i)?c=p+1:l=p}return l}return Ta(e,i,fr,o)}function Ta(e,i,o,c){var l=0,p=e==null?0:e.length;if(p===0)return 0;i=o(i);for(var w=i!==i,x=i===null,R=wr(i),z=i===r;l<p;){var k=Bs((l+p)/2),K=o(e[k]),Z=K!==r,ae=K===null,le=K===K,Ee=wr(K);if(w)var fe=c||le;else z?fe=le&&(c||Z):x?fe=le&&Z&&(c||!ae):R?fe=le&&Z&&!ae&&(c||!Ee):ae||Ee?fe=!1:fe=c?K<=i:K<i;fe?l=k+1:p=k}return Gt(p,Qe)}function Bu(e,i){for(var o=-1,c=e.length,l=0,p=[];++o<c;){var w=e[o],x=i?i(w):w;if(!o||!Mr(x,R)){var R=x;p[l++]=w===0?0:w}}return p}function Hu(e){return typeof e=="number"?e:wr(e)?W:+e}function br(e){if(typeof e=="string")return e;if(be(e))return st(e,br)+"";if(wr(e))return Eu?Eu.call(e):"";var i=e+"";return i=="0"&&1/e==-de?"-0":i}function Ei(e,i,o){var c=-1,l=Rs,p=e.length,w=!0,x=[],R=x;if(o)w=!1,l=oa;else if(p>=a){var z=i?null:Kg(e);if(z)return Ns(z);w=!1,l=Cn,R=new Mi}else R=i?[]:x;e:for(;++c<p;){var k=e[c],K=i?i(k):k;if(k=o||k!==0?k:0,w&&K===K){for(var Z=R.length;Z--;)if(R[Z]===K)continue e;i&&R.push(K),x.push(k)}else l(R,K,o)||(R!==x&&R.push(K),x.push(k))}return x}function Na(e,i){return i=Ii(i,e),e=mh(e,i),e==null||delete e[Jr(Tr(i))]}function Vu(e,i,o,c){return jn(e,i,o(zi(e,i)),c)}function Xs(e,i,o,c){for(var l=e.length,p=c?l:-1;(c?p--:++p<l)&&i(e[p],p,e););return o?Rr(e,c?0:p,c?p+1:l):Rr(e,c?p+1:0,c?l:p)}function Ku(e,i){var o=e;return o instanceof Oe&&(o=o.value()),aa(i,function(c,l){return l.func.apply(l.thisArg,mi([c],l.args))},o)}function $a(e,i,o){var c=e.length;if(c<2)return c?Ei(e[0]):[];for(var l=-1,p=L(c);++l<c;)for(var w=e[l],x=-1;++x<c;)x!=l&&(p[l]=Dn(p[l]||w,e[x],i,o));return Ei(Kt(p,1),i,o)}function Wu(e,i,o){for(var c=-1,l=e.length,p=i.length,w={};++c<l;){var x=c<p?i[c]:r;o(w,e[c],x)}return w}function Fa(e){return _t(e)?e:[]}function Da(e){return typeof e=="function"?e:fr}function Ii(e,i){return be(e)?e:Ha(e,i)?[e]:Eh(Ue(e))}var Lg=Se;function Si(e,i,o){var c=e.length;return o=o===r?c:o,!i&&o>=c?e:Rr(e,i,o)}var Gu=Ip||function(e){return Ce.clearTimeout(e)};function Ju(e,i){if(i)return e.slice();var o=e.length,c=yu?yu(o):new e.constructor(o);return e.copy(c),c}function La(e){var i=new e.constructor(e.byteLength);return new js(i).set(new js(e)),i}function Ug(e,i){var o=i?La(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}function jg(e){var i=new e.constructor(e.source,Sr.exec(e));return i.lastIndex=e.lastIndex,i}function Mg(e){return $n?Je($n.call(e)):{}}function Qu(e,i){var o=i?La(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}function Yu(e,i){if(e!==i){var o=e!==r,c=e===null,l=e===e,p=wr(e),w=i!==r,x=i===null,R=i===i,z=wr(i);if(!x&&!z&&!p&&e>i||p&&w&&R&&!x&&!z||c&&w&&R||!o&&R||!l)return 1;if(!c&&!p&&!z&&e<i||z&&o&&l&&!c&&!p||x&&o&&l||!w&&l||!R)return-1}return 0}function qg(e,i,o){for(var c=-1,l=e.criteria,p=i.criteria,w=l.length,x=o.length;++c<w;){var R=Yu(l[c],p[c]);if(R){if(c>=x)return R;var z=o[c];return R*(z=="desc"?-1:1)}}return e.index-i.index}function Xu(e,i,o,c){for(var l=-1,p=e.length,w=o.length,x=-1,R=i.length,z=Ut(p-w,0),k=L(R+z),K=!c;++x<R;)k[x]=i[x];for(;++l<w;)(K||l<p)&&(k[o[l]]=e[l]);for(;z--;)k[x++]=e[l++];return k}function Zu(e,i,o,c){for(var l=-1,p=e.length,w=-1,x=o.length,R=-1,z=i.length,k=Ut(p-x,0),K=L(k+z),Z=!c;++l<k;)K[l]=e[l];for(var ae=l;++R<z;)K[ae+R]=i[R];for(;++w<x;)(Z||l<p)&&(K[ae+o[w]]=e[l++]);return K}function ur(e,i){var o=-1,c=e.length;for(i||(i=L(c));++o<c;)i[o]=e[o];return i}function Gr(e,i,o,c){var l=!o;o||(o={});for(var p=-1,w=i.length;++p<w;){var x=i[p],R=c?c(o[x],e[x],x,o,e):r;R===r&&(R=e[x]),l?ii(o,x,R):Fn(o,x,R)}return o}function zg(e,i){return Gr(e,Ba(e),i)}function kg(e,i){return Gr(e,fh(e),i)}function Zs(e,i){return function(o,c){var l=be(o)?Wd:hg,p=i?i():{};return l(o,e,he(c,2),p)}}function dn(e){return Se(function(i,o){var c=-1,l=o.length,p=l>1?o[l-1]:r,w=l>2?o[2]:r;for(p=e.length>3&&typeof p=="function"?(l--,p):r,w&&tr(o[0],o[1],w)&&(p=l<3?r:p,l=1),i=Je(i);++c<l;){var x=o[c];x&&e(i,x,c,p)}return i})}function eh(e,i){return function(o,c){if(o==null)return o;if(!hr(o))return e(o,c);for(var l=o.length,p=i?l:-1,w=Je(o);(i?p--:++p<l)&&c(w[p],p,w)!==!1;);return o}}function th(e){return function(i,o,c){for(var l=-1,p=Je(i),w=c(i),x=w.length;x--;){var R=w[e?x:++l];if(o(p[R],R,p)===!1)break}return i}}function Bg(e,i,o){var c=i&ce,l=Mn(e);function p(){var w=this&&this!==Ce&&this instanceof p?l:e;return w.apply(c?o:this,arguments)}return p}function rh(e){return function(i){i=Ue(i);var o=on(i)?Ur(i):r,c=o?o[0]:i.charAt(0),l=o?Si(o,1).join(""):i.slice(1);return c[e]()+l}}function pn(e){return function(i){return aa(el(Zh(i).replace(Pn,"")),e,"")}}function Mn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var o=fn(e.prototype),c=e.apply(o,i);return ut(c)?c:o}}function Hg(e,i,o){var c=Mn(e);function l(){for(var p=arguments.length,w=L(p),x=p,R=gn(l);x--;)w[x]=arguments[x];var z=p<3&&w[0]!==R&&w[p-1]!==R?[]:bi(w,R);if(p-=z.length,p<o)return ah(e,i,eo,l.placeholder,r,w,z,r,r,o-p);var k=this&&this!==Ce&&this instanceof l?c:e;return Mt(k,this,w)}return l}function ih(e){return function(i,o,c){var l=Je(i);if(!hr(i)){var p=he(o,3);i=qt(i),o=function(x){return p(l[x],x,l)}}var w=e(i,o,c);return w>-1?l[p?i[w]:w]:r}}function nh(e){return si(function(i){var o=i.length,c=o,l=Cr.prototype.thru;for(e&&i.reverse();c--;){var p=i[c];if(typeof p!="function")throw new Or(f);if(l&&!w&&no(p)=="wrapper")var w=new Cr([],!0)}for(c=w?c:o;++c<o;){p=i[c];var x=no(p),R=x=="wrapper"?za(p):r;R&&Va(R[0])&&R[1]==(F|_|I|$)&&!R[4].length&&R[9]==1?w=w[no(R[0])].apply(w,R[3]):w=p.length==1&&Va(p)?w[x]():w.thru(p)}return function(){var z=arguments,k=z[0];if(w&&z.length==1&&be(k))return w.plant(k).value();for(var K=0,Z=o?i[K].apply(this,z):k;++K<o;)Z=i[K].call(this,Z);return Z}})}function eo(e,i,o,c,l,p,w,x,R,z){var k=i&F,K=i&ce,Z=i&ye,ae=i&(_|S),le=i&te,Ee=Z?r:Mn(e);function fe(){for(var xe=arguments.length,Ae=L(xe),_r=xe;_r--;)Ae[_r]=arguments[_r];if(ae)var rr=gn(fe),Er=rp(Ae,rr);if(c&&(Ae=Xu(Ae,c,l,ae)),p&&(Ae=Zu(Ae,p,w,ae)),xe-=Er,ae&&xe<z){var Et=bi(Ae,rr);return ah(e,i,eo,fe.placeholder,o,Ae,Et,x,R,z-xe)}var qr=K?o:this,ui=Z?qr[e]:e;return xe=Ae.length,x?Ae=hy(Ae,x):le&&xe>1&&Ae.reverse(),k&&R<xe&&(Ae.length=R),this&&this!==Ce&&this instanceof fe&&(ui=Ee||Mn(ui)),ui.apply(qr,Ae)}return fe}function sh(e,i){return function(o,c){return mg(o,e,i(c),{})}}function to(e,i){return function(o,c){var l;if(o===r&&c===r)return i;if(o!==r&&(l=o),c!==r){if(l===r)return c;typeof o=="string"||typeof c=="string"?(o=br(o),c=br(c)):(o=Hu(o),c=Hu(c)),l=e(o,c)}return l}}function Ua(e){return si(function(i){return i=st(i,mr(he())),Se(function(o){var c=this;return e(i,function(l){return Mt(l,c,o)})})})}function ro(e,i){i=i===r?" ":br(i);var o=i.length;if(o<2)return o?Ra(i,e):i;var c=Ra(i,ks(e/an(i)));return on(i)?Si(Ur(c),0,e).join(""):c.slice(0,e)}function Vg(e,i,o,c){var l=i&ce,p=Mn(e);function w(){for(var x=-1,R=arguments.length,z=-1,k=c.length,K=L(k+R),Z=this&&this!==Ce&&this instanceof w?p:e;++z<k;)K[z]=c[z];for(;R--;)K[z++]=arguments[++x];return Mt(Z,l?o:this,K)}return w}function oh(e){return function(i,o,c){return c&&typeof c!="number"&&tr(i,o,c)&&(o=c=r),i=ci(i),o===r?(o=i,i=0):o=ci(o),c=c===r?i<o?1:-1:ci(c),Rg(i,o,c,e)}}function io(e){return function(i,o){return typeof i=="string"&&typeof o=="string"||(i=Nr(i),o=Nr(o)),e(i,o)}}function ah(e,i,o,c,l,p,w,x,R,z){var k=i&_,K=k?w:r,Z=k?r:w,ae=k?p:r,le=k?r:p;i|=k?I:b,i&=~(k?b:I),i&y||(i&=~(ce|ye));var Ee=[e,i,l,ae,K,le,Z,x,R,z],fe=o.apply(r,Ee);return Va(e)&&bh(fe,Ee),fe.placeholder=c,wh(fe,e,i)}function ja(e){var i=Lt[e];return function(o,c){if(o=Nr(o),c=c==null?0:Gt(we(c),292),c&&wu(o)){var l=(Ue(o)+"e").split("e"),p=i(l[0]+"e"+(+l[1]+c));return l=(Ue(p)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return i(o)}}var Kg=hn&&1/Ns(new hn([,-0]))[1]==de?function(e){return new hn(e)}:oc;function ch(e){return function(i){var o=Jt(i);return o==_e?pa(i):o==Le?up(i):tp(i,e(i))}}function ni(e,i,o,c,l,p,w,x){var R=i&ye;if(!R&&typeof e!="function")throw new Or(f);var z=c?c.length:0;if(z||(i&=~(I|b),c=l=r),w=w===r?w:Ut(we(w),0),x=x===r?x:we(x),z-=l?l.length:0,i&b){var k=c,K=l;c=l=r}var Z=R?r:za(e),ae=[e,i,o,c,l,k,K,p,w,x];if(Z&&ay(ae,Z),e=ae[0],i=ae[1],o=ae[2],c=ae[3],l=ae[4],x=ae[9]=ae[9]===r?R?0:e.length:Ut(ae[9]-z,0),!x&&i&(_|S)&&(i&=~(_|S)),!i||i==ce)var le=Bg(e,i,o);else i==_||i==S?le=Hg(e,i,x):(i==I||i==(ce|I))&&!l.length?le=Vg(e,i,o,c):le=eo.apply(r,ae);var Ee=Z?ku:bh;return wh(Ee(le,ae),e,i)}function uh(e,i,o,c){return e===r||Mr(e,un[o])&&!Me.call(c,o)?i:e}function hh(e,i,o,c,l,p){return ut(e)&&ut(i)&&(p.set(i,e),Qs(e,i,r,hh,p),p.delete(i)),e}function Wg(e){return kn(e)?r:e}function lh(e,i,o,c,l,p){var w=o&B,x=e.length,R=i.length;if(x!=R&&!(w&&R>x))return!1;var z=p.get(e),k=p.get(i);if(z&&k)return z==i&&k==e;var K=-1,Z=!0,ae=o&Y?new Mi:r;for(p.set(e,i),p.set(i,e);++K<x;){var le=e[K],Ee=i[K];if(c)var fe=w?c(Ee,le,K,i,e,p):c(le,Ee,K,e,i,p);if(fe!==r){if(fe)continue;Z=!1;break}if(ae){if(!ca(i,function(xe,Ae){if(!Cn(ae,Ae)&&(le===xe||l(le,xe,o,c,p)))return ae.push(Ae)})){Z=!1;break}}else if(!(le===Ee||l(le,Ee,o,c,p))){Z=!1;break}}return p.delete(e),p.delete(i),Z}function Gg(e,i,o,c,l,p,w){switch(o){case Ve:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case $e:return!(e.byteLength!=i.byteLength||!p(new js(e),new js(i)));case U:case D:case Ne:return Mr(+e,+i);case P:return e.name==i.name&&e.message==i.message;case ot:case Xe:return e==i+"";case _e:var x=pa;case Le:var R=c&B;if(x||(x=Ns),e.size!=i.size&&!R)return!1;var z=w.get(e);if(z)return z==i;c|=Y,w.set(e,i);var k=lh(x(e),x(i),c,l,p,w);return w.delete(e),k;case Ze:if($n)return $n.call(e)==$n.call(i)}return!1}function Jg(e,i,o,c,l,p){var w=o&B,x=Ma(e),R=x.length,z=Ma(i),k=z.length;if(R!=k&&!w)return!1;for(var K=R;K--;){var Z=x[K];if(!(w?Z in i:Me.call(i,Z)))return!1}var ae=p.get(e),le=p.get(i);if(ae&&le)return ae==i&&le==e;var Ee=!0;p.set(e,i),p.set(i,e);for(var fe=w;++K<R;){Z=x[K];var xe=e[Z],Ae=i[Z];if(c)var _r=w?c(Ae,xe,Z,i,e,p):c(xe,Ae,Z,e,i,p);if(!(_r===r?xe===Ae||l(xe,Ae,o,c,p):_r)){Ee=!1;break}fe||(fe=Z=="constructor")}if(Ee&&!fe){var rr=e.constructor,Er=i.constructor;rr!=Er&&"constructor"in e&&"constructor"in i&&!(typeof rr=="function"&&rr instanceof rr&&typeof Er=="function"&&Er instanceof Er)&&(Ee=!1)}return p.delete(e),p.delete(i),Ee}function si(e){return Wa(vh(e,r,Ph),e+"")}function Ma(e){return Tu(e,qt,Ba)}function qa(e){return Tu(e,lr,fh)}var za=Hs?function(e){return Hs.get(e)}:oc;function no(e){for(var i=e.name+"",o=ln[i],c=Me.call(ln,i)?o.length:0;c--;){var l=o[c],p=l.func;if(p==null||p==e)return l.name}return i}function gn(e){var i=Me.call(d,"placeholder")?d:e;return i.placeholder}function he(){var e=d.iteratee||nc;return e=e===nc?Fu:e,arguments.length?e(arguments[0],arguments[1]):e}function so(e,i){var o=e.__data__;return iy(i)?o[typeof i=="string"?"string":"hash"]:o.map}function ka(e){for(var i=qt(e),o=i.length;o--;){var c=i[o],l=e[c];i[o]=[c,l,gh(l)]}return i}function ki(e,i){var o=op(e,i);return $u(o)?o:r}function Qg(e){var i=Me.call(e,Ui),o=e[Ui];try{e[Ui]=r;var c=!0}catch{}var l=Ls.call(e);return c&&(i?e[Ui]=o:delete e[Ui]),l}var Ba=ya?function(e){return e==null?[]:(e=Je(e),vi(ya(e),function(i){return mu.call(e,i)}))}:ac,fh=ya?function(e){for(var i=[];e;)mi(i,Ba(e)),e=Ms(e);return i}:ac,Jt=er;(va&&Jt(new va(new ArrayBuffer(1)))!=Ve||Rn&&Jt(new Rn)!=_e||ma&&Jt(ma.resolve())!=xt||hn&&Jt(new hn)!=Le||Tn&&Jt(new Tn)!=ze)&&(Jt=function(e){var i=er(e),o=i==Pe?e.constructor:r,c=o?Bi(o):"";if(c)switch(c){case Np:return Ve;case $p:return _e;case Fp:return xt;case Dp:return Le;case Lp:return ze}return i});function Yg(e,i,o){for(var c=-1,l=o.length;++c<l;){var p=o[c],w=p.size;switch(p.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=Gt(i,e+w);break;case"takeRight":e=Ut(e,i-w);break}}return{start:e,end:i}}function Xg(e){var i=e.match(Ye);return i?i[1].split(Rt):[]}function dh(e,i,o){i=Ii(i,e);for(var c=-1,l=i.length,p=!1;++c<l;){var w=Jr(i[c]);if(!(p=e!=null&&o(e,w)))break;e=e[w]}return p||++c!=l?p:(l=e==null?0:e.length,!!l&&fo(l)&&oi(w,l)&&(be(e)||Hi(e)))}function Zg(e){var i=e.length,o=new e.constructor(i);return i&&typeof e[0]=="string"&&Me.call(e,"index")&&(o.index=e.index,o.input=e.input),o}function ph(e){return typeof e.constructor=="function"&&!qn(e)?fn(Ms(e)):{}}function ey(e,i,o){var c=e.constructor;switch(i){case $e:return La(e);case U:case D:return new c(+e);case Ve:return Ug(e,o);case ht:case je:case Pt:case Dt:case Ht:case Vt:case jt:case Yt:case ar:return Qu(e,o);case _e:return new c;case Ne:case Xe:return new c(e);case ot:return jg(e);case Le:return new c;case Ze:return Mg(e)}}function ty(e,i){var o=i.length;if(!o)return e;var c=o-1;return i[c]=(o>1?"& ":"")+i[c],i=i.join(o>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+i+`] */
`)}function ry(e){return be(e)||Hi(e)||!!(bu&&e&&e[bu])}function oi(e,i){var o=typeof e;return i=i??Q,!!i&&(o=="number"||o!="symbol"&&Ko.test(e))&&e>-1&&e%1==0&&e<i}function tr(e,i,o){if(!ut(o))return!1;var c=typeof i;return(c=="number"?hr(o)&&oi(i,o.length):c=="string"&&i in o)?Mr(o[i],e):!1}function Ha(e,i){if(be(e))return!1;var o=typeof e;return o=="number"||o=="symbol"||o=="boolean"||e==null||wr(e)?!0:Ot.test(e)||!nt.test(e)||i!=null&&e in Je(i)}function iy(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Va(e){var i=no(e),o=d[i];if(typeof o!="function"||!(i in Oe.prototype))return!1;if(e===o)return!0;var c=za(o);return!!c&&e===c[0]}function ny(e){return!!gu&&gu in e}var sy=Fs?ai:cc;function qn(e){var i=e&&e.constructor,o=typeof i=="function"&&i.prototype||un;return e===o}function gh(e){return e===e&&!ut(e)}function yh(e,i){return function(o){return o==null?!1:o[e]===i&&(i!==r||e in Je(o))}}function oy(e){var i=ho(e,function(c){return o.size===N&&o.clear(),c}),o=i.cache;return i}function ay(e,i){var o=e[1],c=i[1],l=o|c,p=l<(ce|ye|F),w=c==F&&o==_||c==F&&o==$&&e[7].length<=i[8]||c==(F|$)&&i[7].length<=i[8]&&o==_;if(!(p||w))return e;c&ce&&(e[2]=i[2],l|=o&ce?0:y);var x=i[3];if(x){var R=e[3];e[3]=R?Xu(R,x,i[4]):x,e[4]=R?bi(e[3],T):i[4]}return x=i[5],x&&(R=e[5],e[5]=R?Zu(R,x,i[6]):x,e[6]=R?bi(e[5],T):i[6]),x=i[7],x&&(e[7]=x),c&F&&(e[8]=e[8]==null?i[8]:Gt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function cy(e){var i=[];if(e!=null)for(var o in Je(e))i.push(o);return i}function uy(e){return Ls.call(e)}function vh(e,i,o){return i=Ut(i===r?e.length-1:i,0),function(){for(var c=arguments,l=-1,p=Ut(c.length-i,0),w=L(p);++l<p;)w[l]=c[i+l];l=-1;for(var x=L(i+1);++l<i;)x[l]=c[l];return x[i]=o(w),Mt(e,this,x)}}function mh(e,i){return i.length<2?e:zi(e,Rr(i,0,-1))}function hy(e,i){for(var o=e.length,c=Gt(i.length,o),l=ur(e);c--;){var p=i[c];e[c]=oi(p,o)?l[p]:r}return e}function Ka(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var bh=_h(ku),zn=xp||function(e,i){return Ce.setTimeout(e,i)},Wa=_h($g);function wh(e,i,o){var c=i+"";return Wa(e,ty(c,ly(Xg(c),o)))}function _h(e){var i=0,o=0;return function(){var c=Ap(),l=qe-(c-o);if(o=c,l>0){if(++i>=Te)return arguments[0]}else i=0;return e.apply(r,arguments)}}function oo(e,i){var o=-1,c=e.length,l=c-1;for(i=i===r?c:i;++o<i;){var p=Aa(o,l),w=e[p];e[p]=e[o],e[o]=w}return e.length=i,e}var Eh=oy(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Ct,function(o,c,l,p){i.push(l?p.replace(qo,"$1"):c||o)}),i});function Jr(e){if(typeof e=="string"||wr(e))return e;var i=e+"";return i=="0"&&1/e==-de?"-0":i}function Bi(e){if(e!=null){try{return Ds.call(e)}catch{}try{return e+""}catch{}}return""}function ly(e,i){return Pr(Br,function(o){var c="_."+o[0];i&o[1]&&!Rs(e,c)&&e.push(c)}),e.sort()}function Ih(e){if(e instanceof Oe)return e.clone();var i=new Cr(e.__wrapped__,e.__chain__);return i.__actions__=ur(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function fy(e,i,o){(o?tr(e,i,o):i===r)?i=1:i=Ut(we(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var l=0,p=0,w=L(ks(c/i));l<c;)w[p++]=Rr(e,l,l+=i);return w}function dy(e){for(var i=-1,o=e==null?0:e.length,c=0,l=[];++i<o;){var p=e[i];p&&(l[c++]=p)}return l}function py(){var e=arguments.length;if(!e)return[];for(var i=L(e-1),o=arguments[0],c=e;c--;)i[c-1]=arguments[c];return mi(be(o)?ur(o):[o],Kt(i,1))}var gy=Se(function(e,i){return _t(e)?Dn(e,Kt(i,1,_t,!0)):[]}),yy=Se(function(e,i){var o=Tr(i);return _t(o)&&(o=r),_t(e)?Dn(e,Kt(i,1,_t,!0),he(o,2)):[]}),vy=Se(function(e,i){var o=Tr(i);return _t(o)&&(o=r),_t(e)?Dn(e,Kt(i,1,_t,!0),r,o):[]});function my(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:we(i),Rr(e,i<0?0:i,c)):[]}function by(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:we(i),i=c-i,Rr(e,0,i<0?0:i)):[]}function wy(e,i){return e&&e.length?Xs(e,he(i,3),!0,!0):[]}function _y(e,i){return e&&e.length?Xs(e,he(i,3),!0):[]}function Ey(e,i,o,c){var l=e==null?0:e.length;return l?(o&&typeof o!="number"&&tr(e,i,o)&&(o=0,c=l),pg(e,i,o,c)):[]}function Sh(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=o==null?0:we(o);return l<0&&(l=Ut(c+l,0)),Ts(e,he(i,3),l)}function xh(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return o!==r&&(l=we(o),l=o<0?Ut(c+l,0):Gt(l,c-1)),Ts(e,he(i,3),l,!0)}function Ph(e){var i=e==null?0:e.length;return i?Kt(e,1):[]}function Iy(e){var i=e==null?0:e.length;return i?Kt(e,de):[]}function Sy(e,i){var o=e==null?0:e.length;return o?(i=i===r?1:we(i),Kt(e,i)):[]}function xy(e){for(var i=-1,o=e==null?0:e.length,c={};++i<o;){var l=e[i];c[l[0]]=l[1]}return c}function Oh(e){return e&&e.length?e[0]:r}function Py(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=o==null?0:we(o);return l<0&&(l=Ut(c+l,0)),sn(e,i,l)}function Oy(e){var i=e==null?0:e.length;return i?Rr(e,0,-1):[]}var Cy=Se(function(e){var i=st(e,Fa);return i.length&&i[0]===e[0]?Sa(i):[]}),Ay=Se(function(e){var i=Tr(e),o=st(e,Fa);return i===Tr(o)?i=r:o.pop(),o.length&&o[0]===e[0]?Sa(o,he(i,2)):[]}),Ry=Se(function(e){var i=Tr(e),o=st(e,Fa);return i=typeof i=="function"?i:r,i&&o.pop(),o.length&&o[0]===e[0]?Sa(o,r,i):[]});function Ty(e,i){return e==null?"":Op.call(e,i)}function Tr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function Ny(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=c;return o!==r&&(l=we(o),l=l<0?Ut(c+l,0):Gt(l,c-1)),i===i?lp(e,i,l):Ts(e,au,l,!0)}function $y(e,i){return e&&e.length?ju(e,we(i)):r}var Fy=Se(Ch);function Ch(e,i){return e&&e.length&&i&&i.length?Ca(e,i):e}function Dy(e,i,o){return e&&e.length&&i&&i.length?Ca(e,i,he(o,2)):e}function Ly(e,i,o){return e&&e.length&&i&&i.length?Ca(e,i,r,o):e}var Uy=si(function(e,i){var o=e==null?0:e.length,c=wa(e,i);return zu(e,st(i,function(l){return oi(l,o)?+l:l}).sort(Yu)),c});function jy(e,i){var o=[];if(!(e&&e.length))return o;var c=-1,l=[],p=e.length;for(i=he(i,3);++c<p;){var w=e[c];i(w,c,e)&&(o.push(w),l.push(c))}return zu(e,l),o}function Ga(e){return e==null?e:Tp.call(e)}function My(e,i,o){var c=e==null?0:e.length;return c?(o&&typeof o!="number"&&tr(e,i,o)?(i=0,o=c):(i=i==null?0:we(i),o=o===r?c:we(o)),Rr(e,i,o)):[]}function qy(e,i){return Ys(e,i)}function zy(e,i,o){return Ta(e,i,he(o,2))}function ky(e,i){var o=e==null?0:e.length;if(o){var c=Ys(e,i);if(c<o&&Mr(e[c],i))return c}return-1}function By(e,i){return Ys(e,i,!0)}function Hy(e,i,o){return Ta(e,i,he(o,2),!0)}function Vy(e,i){var o=e==null?0:e.length;if(o){var c=Ys(e,i,!0)-1;if(Mr(e[c],i))return c}return-1}function Ky(e){return e&&e.length?Bu(e):[]}function Wy(e,i){return e&&e.length?Bu(e,he(i,2)):[]}function Gy(e){var i=e==null?0:e.length;return i?Rr(e,1,i):[]}function Jy(e,i,o){return e&&e.length?(i=o||i===r?1:we(i),Rr(e,0,i<0?0:i)):[]}function Qy(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:we(i),i=c-i,Rr(e,i<0?0:i,c)):[]}function Yy(e,i){return e&&e.length?Xs(e,he(i,3),!1,!0):[]}function Xy(e,i){return e&&e.length?Xs(e,he(i,3)):[]}var Zy=Se(function(e){return Ei(Kt(e,1,_t,!0))}),e0=Se(function(e){var i=Tr(e);return _t(i)&&(i=r),Ei(Kt(e,1,_t,!0),he(i,2))}),t0=Se(function(e){var i=Tr(e);return i=typeof i=="function"?i:r,Ei(Kt(e,1,_t,!0),r,i)});function r0(e){return e&&e.length?Ei(e):[]}function i0(e,i){return e&&e.length?Ei(e,he(i,2)):[]}function n0(e,i){return i=typeof i=="function"?i:r,e&&e.length?Ei(e,r,i):[]}function Ja(e){if(!(e&&e.length))return[];var i=0;return e=vi(e,function(o){if(_t(o))return i=Ut(o.length,i),!0}),fa(i,function(o){return st(e,ua(o))})}function Ah(e,i){if(!(e&&e.length))return[];var o=Ja(e);return i==null?o:st(o,function(c){return Mt(i,r,c)})}var s0=Se(function(e,i){return _t(e)?Dn(e,i):[]}),o0=Se(function(e){return $a(vi(e,_t))}),a0=Se(function(e){var i=Tr(e);return _t(i)&&(i=r),$a(vi(e,_t),he(i,2))}),c0=Se(function(e){var i=Tr(e);return i=typeof i=="function"?i:r,$a(vi(e,_t),r,i)}),u0=Se(Ja);function h0(e,i){return Wu(e||[],i||[],Fn)}function l0(e,i){return Wu(e||[],i||[],jn)}var f0=Se(function(e){var i=e.length,o=i>1?e[i-1]:r;return o=typeof o=="function"?(e.pop(),o):r,Ah(e,o)});function Rh(e){var i=d(e);return i.__chain__=!0,i}function d0(e,i){return i(e),e}function ao(e,i){return i(e)}var p0=si(function(e){var i=e.length,o=i?e[0]:0,c=this.__wrapped__,l=function(p){return wa(p,e)};return i>1||this.__actions__.length||!(c instanceof Oe)||!oi(o)?this.thru(l):(c=c.slice(o,+o+(i?1:0)),c.__actions__.push({func:ao,args:[l],thisArg:r}),new Cr(c,this.__chain__).thru(function(p){return i&&!p.length&&p.push(r),p}))});function g0(){return Rh(this)}function y0(){return new Cr(this.value(),this.__chain__)}function v0(){this.__values__===r&&(this.__values__=Hh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function m0(){return this}function b0(e){for(var i,o=this;o instanceof Ks;){var c=Ih(o);c.__index__=0,c.__values__=r,i?l.__wrapped__=c:i=c;var l=c;o=o.__wrapped__}return l.__wrapped__=e,i}function w0(){var e=this.__wrapped__;if(e instanceof Oe){var i=e;return this.__actions__.length&&(i=new Oe(this)),i=i.reverse(),i.__actions__.push({func:ao,args:[Ga],thisArg:r}),new Cr(i,this.__chain__)}return this.thru(Ga)}function _0(){return Ku(this.__wrapped__,this.__actions__)}var E0=Zs(function(e,i,o){Me.call(e,o)?++e[o]:ii(e,o,1)});function I0(e,i,o){var c=be(e)?su:dg;return o&&tr(e,i,o)&&(i=r),c(e,he(i,3))}function S0(e,i){var o=be(e)?vi:Au;return o(e,he(i,3))}var x0=ih(Sh),P0=ih(xh);function O0(e,i){return Kt(co(e,i),1)}function C0(e,i){return Kt(co(e,i),de)}function A0(e,i,o){return o=o===r?1:we(o),Kt(co(e,i),o)}function Th(e,i){var o=be(e)?Pr:_i;return o(e,he(i,3))}function Nh(e,i){var o=be(e)?Gd:Cu;return o(e,he(i,3))}var R0=Zs(function(e,i,o){Me.call(e,o)?e[o].push(i):ii(e,o,[i])});function T0(e,i,o,c){e=hr(e)?e:vn(e),o=o&&!c?we(o):0;var l=e.length;return o<0&&(o=Ut(l+o,0)),po(e)?o<=l&&e.indexOf(i,o)>-1:!!l&&sn(e,i,o)>-1}var N0=Se(function(e,i,o){var c=-1,l=typeof i=="function",p=hr(e)?L(e.length):[];return _i(e,function(w){p[++c]=l?Mt(i,w,o):Ln(w,i,o)}),p}),$0=Zs(function(e,i,o){ii(e,o,i)});function co(e,i){var o=be(e)?st:Du;return o(e,he(i,3))}function F0(e,i,o,c){return e==null?[]:(be(i)||(i=i==null?[]:[i]),o=c?r:o,be(o)||(o=o==null?[]:[o]),Mu(e,i,o))}var D0=Zs(function(e,i,o){e[o?0:1].push(i)},function(){return[[],[]]});function L0(e,i,o){var c=be(e)?aa:uu,l=arguments.length<3;return c(e,he(i,4),o,l,_i)}function U0(e,i,o){var c=be(e)?Jd:uu,l=arguments.length<3;return c(e,he(i,4),o,l,Cu)}function j0(e,i){var o=be(e)?vi:Au;return o(e,lo(he(i,3)))}function M0(e){var i=be(e)?Su:Tg;return i(e)}function q0(e,i,o){(o?tr(e,i,o):i===r)?i=1:i=we(i);var c=be(e)?cg:Ng;return c(e,i)}function z0(e){var i=be(e)?ug:Fg;return i(e)}function k0(e){if(e==null)return 0;if(hr(e))return po(e)?an(e):e.length;var i=Jt(e);return i==_e||i==Le?e.size:Pa(e).length}function B0(e,i,o){var c=be(e)?ca:Dg;return o&&tr(e,i,o)&&(i=r),c(e,he(i,3))}var H0=Se(function(e,i){if(e==null)return[];var o=i.length;return o>1&&tr(e,i[0],i[1])?i=[]:o>2&&tr(i[0],i[1],i[2])&&(i=[i[0]]),Mu(e,Kt(i,1),[])}),uo=Sp||function(){return Ce.Date.now()};function V0(e,i){if(typeof i!="function")throw new Or(f);return e=we(e),function(){if(--e<1)return i.apply(this,arguments)}}function $h(e,i,o){return i=o?r:i,i=e&&i==null?e.length:i,ni(e,F,r,r,r,r,i)}function Fh(e,i){var o;if(typeof i!="function")throw new Or(f);return e=we(e),function(){return--e>0&&(o=i.apply(this,arguments)),e<=1&&(i=r),o}}var Qa=Se(function(e,i,o){var c=ce;if(o.length){var l=bi(o,gn(Qa));c|=I}return ni(e,c,i,o,l)}),Dh=Se(function(e,i,o){var c=ce|ye;if(o.length){var l=bi(o,gn(Dh));c|=I}return ni(i,c,e,o,l)});function Lh(e,i,o){i=o?r:i;var c=ni(e,_,r,r,r,r,r,i);return c.placeholder=Lh.placeholder,c}function Uh(e,i,o){i=o?r:i;var c=ni(e,S,r,r,r,r,r,i);return c.placeholder=Uh.placeholder,c}function jh(e,i,o){var c,l,p,w,x,R,z=0,k=!1,K=!1,Z=!0;if(typeof e!="function")throw new Or(f);i=Nr(i)||0,ut(o)&&(k=!!o.leading,K="maxWait"in o,p=K?Ut(Nr(o.maxWait)||0,i):p,Z="trailing"in o?!!o.trailing:Z);function ae(Et){var qr=c,ui=l;return c=l=r,z=Et,w=e.apply(ui,qr),w}function le(Et){return z=Et,x=zn(xe,i),k?ae(Et):w}function Ee(Et){var qr=Et-R,ui=Et-z,il=i-qr;return K?Gt(il,p-ui):il}function fe(Et){var qr=Et-R,ui=Et-z;return R===r||qr>=i||qr<0||K&&ui>=p}function xe(){var Et=uo();if(fe(Et))return Ae(Et);x=zn(xe,Ee(Et))}function Ae(Et){return x=r,Z&&c?ae(Et):(c=l=r,w)}function _r(){x!==r&&Gu(x),z=0,c=R=l=x=r}function rr(){return x===r?w:Ae(uo())}function Er(){var Et=uo(),qr=fe(Et);if(c=arguments,l=this,R=Et,qr){if(x===r)return le(R);if(K)return Gu(x),x=zn(xe,i),ae(R)}return x===r&&(x=zn(xe,i)),w}return Er.cancel=_r,Er.flush=rr,Er}var K0=Se(function(e,i){return Ou(e,1,i)}),W0=Se(function(e,i,o){return Ou(e,Nr(i)||0,o)});function G0(e){return ni(e,te)}function ho(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Or(f);var o=function(){var c=arguments,l=i?i.apply(this,c):c[0],p=o.cache;if(p.has(l))return p.get(l);var w=e.apply(this,c);return o.cache=p.set(l,w)||p,w};return o.cache=new(ho.Cache||ri),o}ho.Cache=ri;function lo(e){if(typeof e!="function")throw new Or(f);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function J0(e){return Fh(2,e)}var Q0=Lg(function(e,i){i=i.length==1&&be(i[0])?st(i[0],mr(he())):st(Kt(i,1),mr(he()));var o=i.length;return Se(function(c){for(var l=-1,p=Gt(c.length,o);++l<p;)c[l]=i[l].call(this,c[l]);return Mt(e,this,c)})}),Ya=Se(function(e,i){var o=bi(i,gn(Ya));return ni(e,I,r,i,o)}),Mh=Se(function(e,i){var o=bi(i,gn(Mh));return ni(e,b,r,i,o)}),Y0=si(function(e,i){return ni(e,$,r,r,r,i)});function X0(e,i){if(typeof e!="function")throw new Or(f);return i=i===r?i:we(i),Se(e,i)}function Z0(e,i){if(typeof e!="function")throw new Or(f);return i=i==null?0:Ut(we(i),0),Se(function(o){var c=o[i],l=Si(o,0,i);return c&&mi(l,c),Mt(e,this,l)})}function ev(e,i,o){var c=!0,l=!0;if(typeof e!="function")throw new Or(f);return ut(o)&&(c="leading"in o?!!o.leading:c,l="trailing"in o?!!o.trailing:l),jh(e,i,{leading:c,maxWait:i,trailing:l})}function tv(e){return $h(e,1)}function rv(e,i){return Ya(Da(i),e)}function iv(){if(!arguments.length)return[];var e=arguments[0];return be(e)?e:[e]}function nv(e){return Ar(e,J)}function sv(e,i){return i=typeof i=="function"?i:r,Ar(e,J,i)}function ov(e){return Ar(e,j|J)}function av(e,i){return i=typeof i=="function"?i:r,Ar(e,j|J,i)}function cv(e,i){return i==null||Pu(e,i,qt(i))}function Mr(e,i){return e===i||e!==e&&i!==i}var uv=io(Ia),hv=io(function(e,i){return e>=i}),Hi=Nu(function(){return arguments}())?Nu:function(e){return vt(e)&&Me.call(e,"callee")&&!mu.call(e,"callee")},be=L.isArray,lv=Zt?mr(Zt):bg;function hr(e){return e!=null&&fo(e.length)&&!ai(e)}function _t(e){return vt(e)&&hr(e)}function fv(e){return e===!0||e===!1||vt(e)&&er(e)==U}var xi=Pp||cc,dv=Lr?mr(Lr):wg;function pv(e){return vt(e)&&e.nodeType===1&&!kn(e)}function gv(e){if(e==null)return!0;if(hr(e)&&(be(e)||typeof e=="string"||typeof e.splice=="function"||xi(e)||yn(e)||Hi(e)))return!e.length;var i=Jt(e);if(i==_e||i==Le)return!e.size;if(qn(e))return!Pa(e).length;for(var o in e)if(Me.call(e,o))return!1;return!0}function yv(e,i){return Un(e,i)}function vv(e,i,o){o=typeof o=="function"?o:r;var c=o?o(e,i):r;return c===r?Un(e,i,r,o):!!c}function Xa(e){if(!vt(e))return!1;var i=er(e);return i==P||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!kn(e)}function mv(e){return typeof e=="number"&&wu(e)}function ai(e){if(!ut(e))return!1;var i=er(e);return i==oe||i==ge||i==M||i==mt}function qh(e){return typeof e=="number"&&e==we(e)}function fo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Q}function ut(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function vt(e){return e!=null&&typeof e=="object"}var zh=xr?mr(xr):Eg;function bv(e,i){return e===i||xa(e,i,ka(i))}function wv(e,i,o){return o=typeof o=="function"?o:r,xa(e,i,ka(i),o)}function _v(e){return kh(e)&&e!=+e}function Ev(e){if(sy(e))throw new ve(u);return $u(e)}function Iv(e){return e===null}function Sv(e){return e==null}function kh(e){return typeof e=="number"||vt(e)&&er(e)==Ne}function kn(e){if(!vt(e)||er(e)!=Pe)return!1;var i=Ms(e);if(i===null)return!0;var o=Me.call(i,"constructor")&&i.constructor;return typeof o=="function"&&o instanceof o&&Ds.call(o)==wp}var Za=Kr?mr(Kr):Ig;function xv(e){return qh(e)&&e>=-Q&&e<=Q}var Bh=On?mr(On):Sg;function po(e){return typeof e=="string"||!be(e)&&vt(e)&&er(e)==Xe}function wr(e){return typeof e=="symbol"||vt(e)&&er(e)==Ze}var yn=Li?mr(Li):xg;function Pv(e){return e===r}function Ov(e){return vt(e)&&Jt(e)==ze}function Cv(e){return vt(e)&&er(e)==et}var Av=io(Oa),Rv=io(function(e,i){return e<=i});function Hh(e){if(!e)return[];if(hr(e))return po(e)?Ur(e):ur(e);if(An&&e[An])return cp(e[An]());var i=Jt(e),o=i==_e?pa:i==Le?Ns:vn;return o(e)}function ci(e){if(!e)return e===0?e:0;if(e=Nr(e),e===de||e===-de){var i=e<0?-1:1;return i*V}return e===e?e:0}function we(e){var i=ci(e),o=i%1;return i===i?o?i-o:i:0}function Vh(e){return e?qi(we(e),0,X):0}function Nr(e){if(typeof e=="number")return e;if(wr(e))return W;if(ut(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ut(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=hu(e);var o=Bo.test(e);return o||Vo.test(e)?me(e.slice(2),o?2:8):ko.test(e)?W:+e}function Kh(e){return Gr(e,lr(e))}function Tv(e){return e?qi(we(e),-Q,Q):e===0?e:0}function Ue(e){return e==null?"":br(e)}var Nv=dn(function(e,i){if(qn(i)||hr(i)){Gr(i,qt(i),e);return}for(var o in i)Me.call(i,o)&&Fn(e,o,i[o])}),Wh=dn(function(e,i){Gr(i,lr(i),e)}),go=dn(function(e,i,o,c){Gr(i,lr(i),e,c)}),$v=dn(function(e,i,o,c){Gr(i,qt(i),e,c)}),Fv=si(wa);function Dv(e,i){var o=fn(e);return i==null?o:xu(o,i)}var Lv=Se(function(e,i){e=Je(e);var o=-1,c=i.length,l=c>2?i[2]:r;for(l&&tr(i[0],i[1],l)&&(c=1);++o<c;)for(var p=i[o],w=lr(p),x=-1,R=w.length;++x<R;){var z=w[x],k=e[z];(k===r||Mr(k,un[z])&&!Me.call(e,z))&&(e[z]=p[z])}return e}),Uv=Se(function(e){return e.push(r,hh),Mt(Gh,r,e)});function jv(e,i){return ou(e,he(i,3),Wr)}function Mv(e,i){return ou(e,he(i,3),Ea)}function qv(e,i){return e==null?e:_a(e,he(i,3),lr)}function zv(e,i){return e==null?e:Ru(e,he(i,3),lr)}function kv(e,i){return e&&Wr(e,he(i,3))}function Bv(e,i){return e&&Ea(e,he(i,3))}function Hv(e){return e==null?[]:Js(e,qt(e))}function Vv(e){return e==null?[]:Js(e,lr(e))}function ec(e,i,o){var c=e==null?r:zi(e,i);return c===r?o:c}function Kv(e,i){return e!=null&&dh(e,i,gg)}function tc(e,i){return e!=null&&dh(e,i,yg)}var Wv=sh(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=Ls.call(i)),e[i]=o},ic(fr)),Gv=sh(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=Ls.call(i)),Me.call(e,i)?e[i].push(o):e[i]=[o]},he),Jv=Se(Ln);function qt(e){return hr(e)?Iu(e):Pa(e)}function lr(e){return hr(e)?Iu(e,!0):Pg(e)}function Qv(e,i){var o={};return i=he(i,3),Wr(e,function(c,l,p){ii(o,i(c,l,p),c)}),o}function Yv(e,i){var o={};return i=he(i,3),Wr(e,function(c,l,p){ii(o,l,i(c,l,p))}),o}var Xv=dn(function(e,i,o){Qs(e,i,o)}),Gh=dn(function(e,i,o,c){Qs(e,i,o,c)}),Zv=si(function(e,i){var o={};if(e==null)return o;var c=!1;i=st(i,function(p){return p=Ii(p,e),c||(c=p.length>1),p}),Gr(e,qa(e),o),c&&(o=Ar(o,j|G|J,Wg));for(var l=i.length;l--;)Na(o,i[l]);return o});function em(e,i){return Jh(e,lo(he(i)))}var tm=si(function(e,i){return e==null?{}:Cg(e,i)});function Jh(e,i){if(e==null)return{};var o=st(qa(e),function(c){return[c]});return i=he(i),qu(e,o,function(c,l){return i(c,l[0])})}function rm(e,i,o){i=Ii(i,e);var c=-1,l=i.length;for(l||(l=1,e=r);++c<l;){var p=e==null?r:e[Jr(i[c])];p===r&&(c=l,p=o),e=ai(p)?p.call(e):p}return e}function im(e,i,o){return e==null?e:jn(e,i,o)}function nm(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:jn(e,i,o,c)}var Qh=ch(qt),Yh=ch(lr);function sm(e,i,o){var c=be(e),l=c||xi(e)||yn(e);if(i=he(i,4),o==null){var p=e&&e.constructor;l?o=c?new p:[]:ut(e)?o=ai(p)?fn(Ms(e)):{}:o={}}return(l?Pr:Wr)(e,function(w,x,R){return i(o,w,x,R)}),o}function om(e,i){return e==null?!0:Na(e,i)}function am(e,i,o){return e==null?e:Vu(e,i,Da(o))}function cm(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:Vu(e,i,Da(o),c)}function vn(e){return e==null?[]:da(e,qt(e))}function um(e){return e==null?[]:da(e,lr(e))}function hm(e,i,o){return o===r&&(o=i,i=r),o!==r&&(o=Nr(o),o=o===o?o:0),i!==r&&(i=Nr(i),i=i===i?i:0),qi(Nr(e),i,o)}function lm(e,i,o){return i=ci(i),o===r?(o=i,i=0):o=ci(o),e=Nr(e),vg(e,i,o)}function fm(e,i,o){if(o&&typeof o!="boolean"&&tr(e,i,o)&&(i=o=r),o===r&&(typeof i=="boolean"?(o=i,i=r):typeof e=="boolean"&&(o=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ci(e),i===r?(i=e,e=0):i=ci(i)),e>i){var c=e;e=i,i=c}if(o||e%1||i%1){var l=_u();return Gt(e+l*(i-e+We("1e-"+((l+"").length-1))),i)}return Aa(e,i)}var dm=pn(function(e,i,o){return i=i.toLowerCase(),e+(o?Xh(i):i)});function Xh(e){return rc(Ue(e).toLowerCase())}function Zh(e){return e=Ue(e),e&&e.replace(Zr,ip).replace(na,"")}function pm(e,i,o){e=Ue(e),i=br(i);var c=e.length;o=o===r?c:qi(we(o),0,c);var l=o;return o-=i.length,o>=0&&e.slice(o,l)==i}function gm(e){return e=Ue(e),e&&it.test(e)?e.replace(Ti,np):e}function ym(e){return e=Ue(e),e&&At.test(e)?e.replace(pt,"\\$&"):e}var vm=pn(function(e,i,o){return e+(o?"-":"")+i.toLowerCase()}),mm=pn(function(e,i,o){return e+(o?" ":"")+i.toLowerCase()}),bm=rh("toLowerCase");function wm(e,i,o){e=Ue(e),i=we(i);var c=i?an(e):0;if(!i||c>=i)return e;var l=(i-c)/2;return ro(Bs(l),o)+e+ro(ks(l),o)}function _m(e,i,o){e=Ue(e),i=we(i);var c=i?an(e):0;return i&&c<i?e+ro(i-c,o):e}function Em(e,i,o){e=Ue(e),i=we(i);var c=i?an(e):0;return i&&c<i?ro(i-c,o)+e:e}function Im(e,i,o){return o||i==null?i=0:i&&(i=+i),Rp(Ue(e).replace(gt,""),i||0)}function Sm(e,i,o){return(o?tr(e,i,o):i===r)?i=1:i=we(i),Ra(Ue(e),i)}function xm(){var e=arguments,i=Ue(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var Pm=pn(function(e,i,o){return e+(o?"_":"")+i.toLowerCase()});function Om(e,i,o){return o&&typeof o!="number"&&tr(e,i,o)&&(i=o=r),o=o===r?X:o>>>0,o?(e=Ue(e),e&&(typeof i=="string"||i!=null&&!Za(i))&&(i=br(i),!i&&on(e))?Si(Ur(e),0,o):e.split(i,o)):[]}var Cm=pn(function(e,i,o){return e+(o?" ":"")+rc(i)});function Am(e,i,o){return e=Ue(e),o=o==null?0:qi(we(o),0,e.length),i=br(i),e.slice(o,o+i.length)==i}function Rm(e,i,o){var c=d.templateSettings;o&&tr(e,i,o)&&(i=r),e=Ue(e),i=go({},i,c,uh);var l=go({},i.imports,c.imports,uh),p=qt(l),w=da(l,p),x,R,z=0,k=i.interpolate||Yi,K="__p += '",Z=ga((i.escape||Yi).source+"|"+k.source+"|"+(k===ct?zo:Yi).source+"|"+(i.evaluate||Yi).source+"|$","g"),ae="//# sourceURL="+(Me.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++sa+"]")+`
`;e.replace(Z,function(fe,xe,Ae,_r,rr,Er){return Ae||(Ae=_r),K+=e.slice(z,Er).replace(Wo,sp),xe&&(x=!0,K+=`' +
__e(`+xe+`) +
'`),rr&&(R=!0,K+=`';
`+rr+`;
__p += '`),Ae&&(K+=`' +
((__t = (`+Ae+`)) == null ? '' : __t) +
'`),z=Er+fe.length,fe}),K+=`';
`;var le=Me.call(i,"variable")&&i.variable;if(!le)K=`with (obj) {
`+K+`
}
`;else if(Mo.test(le))throw new ve(g);K=(R?K.replace(Hr,""):K).replace(Xt,"$1").replace(Xr,"$1;"),K="function("+(le||"obj")+`) {
`+(le?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(x?", __e = _.escape":"")+(R?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+K+`return __p
}`;var Ee=tl(function(){return De(p,ae+"return "+K).apply(r,w)});if(Ee.source=K,Xa(Ee))throw Ee;return Ee}function Tm(e){return Ue(e).toLowerCase()}function Nm(e){return Ue(e).toUpperCase()}function $m(e,i,o){if(e=Ue(e),e&&(o||i===r))return hu(e);if(!e||!(i=br(i)))return e;var c=Ur(e),l=Ur(i),p=lu(c,l),w=fu(c,l)+1;return Si(c,p,w).join("")}function Fm(e,i,o){if(e=Ue(e),e&&(o||i===r))return e.slice(0,pu(e)+1);if(!e||!(i=br(i)))return e;var c=Ur(e),l=fu(c,Ur(i))+1;return Si(c,0,l).join("")}function Dm(e,i,o){if(e=Ue(e),e&&(o||i===r))return e.replace(gt,"");if(!e||!(i=br(i)))return e;var c=Ur(e),l=lu(c,Ur(i));return Si(c,l).join("")}function Lm(e,i){var o=se,c=pe;if(ut(i)){var l="separator"in i?i.separator:l;o="length"in i?we(i.length):o,c="omission"in i?br(i.omission):c}e=Ue(e);var p=e.length;if(on(e)){var w=Ur(e);p=w.length}if(o>=p)return e;var x=o-an(c);if(x<1)return c;var R=w?Si(w,0,x).join(""):e.slice(0,x);if(l===r)return R+c;if(w&&(x+=R.length-x),Za(l)){if(e.slice(x).search(l)){var z,k=R;for(l.global||(l=ga(l.source,Ue(Sr.exec(l))+"g")),l.lastIndex=0;z=l.exec(k);)var K=z.index;R=R.slice(0,K===r?x:K)}}else if(e.indexOf(br(l),x)!=x){var Z=R.lastIndexOf(l);Z>-1&&(R=R.slice(0,Z))}return R+c}function Um(e){return e=Ue(e),e&&lt.test(e)?e.replace(gi,fp):e}var jm=pn(function(e,i,o){return e+(o?" ":"")+i.toUpperCase()}),rc=rh("toUpperCase");function el(e,i,o){return e=Ue(e),i=o?r:i,i===r?ap(e)?gp(e):Xd(e):e.match(i)||[]}var tl=Se(function(e,i){try{return Mt(e,r,i)}catch(o){return Xa(o)?o:new ve(o)}}),Mm=si(function(e,i){return Pr(i,function(o){o=Jr(o),ii(e,o,Qa(e[o],e))}),e});function qm(e){var i=e==null?0:e.length,o=he();return e=i?st(e,function(c){if(typeof c[1]!="function")throw new Or(f);return[o(c[0]),c[1]]}):[],Se(function(c){for(var l=-1;++l<i;){var p=e[l];if(Mt(p[0],this,c))return Mt(p[1],this,c)}})}function zm(e){return fg(Ar(e,j))}function ic(e){return function(){return e}}function km(e,i){return e==null||e!==e?i:e}var Bm=nh(),Hm=nh(!0);function fr(e){return e}function nc(e){return Fu(typeof e=="function"?e:Ar(e,j))}function Vm(e){return Lu(Ar(e,j))}function Km(e,i){return Uu(e,Ar(i,j))}var Wm=Se(function(e,i){return function(o){return Ln(o,e,i)}}),Gm=Se(function(e,i){return function(o){return Ln(e,o,i)}});function sc(e,i,o){var c=qt(i),l=Js(i,c);o==null&&!(ut(i)&&(l.length||!c.length))&&(o=i,i=e,e=this,l=Js(i,qt(i)));var p=!(ut(o)&&"chain"in o)||!!o.chain,w=ai(e);return Pr(l,function(x){var R=i[x];e[x]=R,w&&(e.prototype[x]=function(){var z=this.__chain__;if(p||z){var k=e(this.__wrapped__),K=k.__actions__=ur(this.__actions__);return K.push({func:R,args:arguments,thisArg:e}),k.__chain__=z,k}return R.apply(e,mi([this.value()],arguments))})}),e}function Jm(){return Ce._===this&&(Ce._=_p),this}function oc(){}function Qm(e){return e=we(e),Se(function(i){return ju(i,e)})}var Ym=Ua(st),Xm=Ua(su),Zm=Ua(ca);function rl(e){return Ha(e)?ua(Jr(e)):Ag(e)}function e1(e){return function(i){return e==null?r:zi(e,i)}}var t1=oh(),r1=oh(!0);function ac(){return[]}function cc(){return!1}function i1(){return{}}function n1(){return""}function s1(){return!0}function o1(e,i){if(e=we(e),e<1||e>Q)return[];var o=X,c=Gt(e,X);i=he(i),e-=X;for(var l=fa(c,i);++o<e;)i(o);return l}function a1(e){return be(e)?st(e,Jr):wr(e)?[e]:ur(Eh(Ue(e)))}function c1(e){var i=++bp;return Ue(e)+i}var u1=to(function(e,i){return e+i},0),h1=ja("ceil"),l1=to(function(e,i){return e/i},1),f1=ja("floor");function d1(e){return e&&e.length?Gs(e,fr,Ia):r}function p1(e,i){return e&&e.length?Gs(e,he(i,2),Ia):r}function g1(e){return cu(e,fr)}function y1(e,i){return cu(e,he(i,2))}function v1(e){return e&&e.length?Gs(e,fr,Oa):r}function m1(e,i){return e&&e.length?Gs(e,he(i,2),Oa):r}var b1=to(function(e,i){return e*i},1),w1=ja("round"),_1=to(function(e,i){return e-i},0);function E1(e){return e&&e.length?la(e,fr):0}function I1(e,i){return e&&e.length?la(e,he(i,2)):0}return d.after=V0,d.ary=$h,d.assign=Nv,d.assignIn=Wh,d.assignInWith=go,d.assignWith=$v,d.at=Fv,d.before=Fh,d.bind=Qa,d.bindAll=Mm,d.bindKey=Dh,d.castArray=iv,d.chain=Rh,d.chunk=fy,d.compact=dy,d.concat=py,d.cond=qm,d.conforms=zm,d.constant=ic,d.countBy=E0,d.create=Dv,d.curry=Lh,d.curryRight=Uh,d.debounce=jh,d.defaults=Lv,d.defaultsDeep=Uv,d.defer=K0,d.delay=W0,d.difference=gy,d.differenceBy=yy,d.differenceWith=vy,d.drop=my,d.dropRight=by,d.dropRightWhile=wy,d.dropWhile=_y,d.fill=Ey,d.filter=S0,d.flatMap=O0,d.flatMapDeep=C0,d.flatMapDepth=A0,d.flatten=Ph,d.flattenDeep=Iy,d.flattenDepth=Sy,d.flip=G0,d.flow=Bm,d.flowRight=Hm,d.fromPairs=xy,d.functions=Hv,d.functionsIn=Vv,d.groupBy=R0,d.initial=Oy,d.intersection=Cy,d.intersectionBy=Ay,d.intersectionWith=Ry,d.invert=Wv,d.invertBy=Gv,d.invokeMap=N0,d.iteratee=nc,d.keyBy=$0,d.keys=qt,d.keysIn=lr,d.map=co,d.mapKeys=Qv,d.mapValues=Yv,d.matches=Vm,d.matchesProperty=Km,d.memoize=ho,d.merge=Xv,d.mergeWith=Gh,d.method=Wm,d.methodOf=Gm,d.mixin=sc,d.negate=lo,d.nthArg=Qm,d.omit=Zv,d.omitBy=em,d.once=J0,d.orderBy=F0,d.over=Ym,d.overArgs=Q0,d.overEvery=Xm,d.overSome=Zm,d.partial=Ya,d.partialRight=Mh,d.partition=D0,d.pick=tm,d.pickBy=Jh,d.property=rl,d.propertyOf=e1,d.pull=Fy,d.pullAll=Ch,d.pullAllBy=Dy,d.pullAllWith=Ly,d.pullAt=Uy,d.range=t1,d.rangeRight=r1,d.rearg=Y0,d.reject=j0,d.remove=jy,d.rest=X0,d.reverse=Ga,d.sampleSize=q0,d.set=im,d.setWith=nm,d.shuffle=z0,d.slice=My,d.sortBy=H0,d.sortedUniq=Ky,d.sortedUniqBy=Wy,d.split=Om,d.spread=Z0,d.tail=Gy,d.take=Jy,d.takeRight=Qy,d.takeRightWhile=Yy,d.takeWhile=Xy,d.tap=d0,d.throttle=ev,d.thru=ao,d.toArray=Hh,d.toPairs=Qh,d.toPairsIn=Yh,d.toPath=a1,d.toPlainObject=Kh,d.transform=sm,d.unary=tv,d.union=Zy,d.unionBy=e0,d.unionWith=t0,d.uniq=r0,d.uniqBy=i0,d.uniqWith=n0,d.unset=om,d.unzip=Ja,d.unzipWith=Ah,d.update=am,d.updateWith=cm,d.values=vn,d.valuesIn=um,d.without=s0,d.words=el,d.wrap=rv,d.xor=o0,d.xorBy=a0,d.xorWith=c0,d.zip=u0,d.zipObject=h0,d.zipObjectDeep=l0,d.zipWith=f0,d.entries=Qh,d.entriesIn=Yh,d.extend=Wh,d.extendWith=go,sc(d,d),d.add=u1,d.attempt=tl,d.camelCase=dm,d.capitalize=Xh,d.ceil=h1,d.clamp=hm,d.clone=nv,d.cloneDeep=ov,d.cloneDeepWith=av,d.cloneWith=sv,d.conformsTo=cv,d.deburr=Zh,d.defaultTo=km,d.divide=l1,d.endsWith=pm,d.eq=Mr,d.escape=gm,d.escapeRegExp=ym,d.every=I0,d.find=x0,d.findIndex=Sh,d.findKey=jv,d.findLast=P0,d.findLastIndex=xh,d.findLastKey=Mv,d.floor=f1,d.forEach=Th,d.forEachRight=Nh,d.forIn=qv,d.forInRight=zv,d.forOwn=kv,d.forOwnRight=Bv,d.get=ec,d.gt=uv,d.gte=hv,d.has=Kv,d.hasIn=tc,d.head=Oh,d.identity=fr,d.includes=T0,d.indexOf=Py,d.inRange=lm,d.invoke=Jv,d.isArguments=Hi,d.isArray=be,d.isArrayBuffer=lv,d.isArrayLike=hr,d.isArrayLikeObject=_t,d.isBoolean=fv,d.isBuffer=xi,d.isDate=dv,d.isElement=pv,d.isEmpty=gv,d.isEqual=yv,d.isEqualWith=vv,d.isError=Xa,d.isFinite=mv,d.isFunction=ai,d.isInteger=qh,d.isLength=fo,d.isMap=zh,d.isMatch=bv,d.isMatchWith=wv,d.isNaN=_v,d.isNative=Ev,d.isNil=Sv,d.isNull=Iv,d.isNumber=kh,d.isObject=ut,d.isObjectLike=vt,d.isPlainObject=kn,d.isRegExp=Za,d.isSafeInteger=xv,d.isSet=Bh,d.isString=po,d.isSymbol=wr,d.isTypedArray=yn,d.isUndefined=Pv,d.isWeakMap=Ov,d.isWeakSet=Cv,d.join=Ty,d.kebabCase=vm,d.last=Tr,d.lastIndexOf=Ny,d.lowerCase=mm,d.lowerFirst=bm,d.lt=Av,d.lte=Rv,d.max=d1,d.maxBy=p1,d.mean=g1,d.meanBy=y1,d.min=v1,d.minBy=m1,d.stubArray=ac,d.stubFalse=cc,d.stubObject=i1,d.stubString=n1,d.stubTrue=s1,d.multiply=b1,d.nth=$y,d.noConflict=Jm,d.noop=oc,d.now=uo,d.pad=wm,d.padEnd=_m,d.padStart=Em,d.parseInt=Im,d.random=fm,d.reduce=L0,d.reduceRight=U0,d.repeat=Sm,d.replace=xm,d.result=rm,d.round=w1,d.runInContext=A,d.sample=M0,d.size=k0,d.snakeCase=Pm,d.some=B0,d.sortedIndex=qy,d.sortedIndexBy=zy,d.sortedIndexOf=ky,d.sortedLastIndex=By,d.sortedLastIndexBy=Hy,d.sortedLastIndexOf=Vy,d.startCase=Cm,d.startsWith=Am,d.subtract=_1,d.sum=E1,d.sumBy=I1,d.template=Rm,d.times=o1,d.toFinite=ci,d.toInteger=we,d.toLength=Vh,d.toLower=Tm,d.toNumber=Nr,d.toSafeInteger=Tv,d.toString=Ue,d.toUpper=Nm,d.trim=$m,d.trimEnd=Fm,d.trimStart=Dm,d.truncate=Lm,d.unescape=Um,d.uniqueId=c1,d.upperCase=jm,d.upperFirst=rc,d.each=Th,d.eachRight=Nh,d.first=Oh,sc(d,function(){var e={};return Wr(d,function(i,o){Me.call(d.prototype,o)||(e[o]=i)}),e}(),{chain:!1}),d.VERSION=s,Pr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),Pr(["drop","take"],function(e,i){Oe.prototype[e]=function(o){o=o===r?1:Ut(we(o),0);var c=this.__filtered__&&!i?new Oe(this):this.clone();return c.__filtered__?c.__takeCount__=Gt(o,c.__takeCount__):c.__views__.push({size:Gt(o,X),type:e+(c.__dir__<0?"Right":"")}),c},Oe.prototype[e+"Right"]=function(o){return this.reverse()[e](o).reverse()}}),Pr(["filter","map","takeWhile"],function(e,i){var o=i+1,c=o==m||o==ie;Oe.prototype[e]=function(l){var p=this.clone();return p.__iteratees__.push({iteratee:he(l,3),type:o}),p.__filtered__=p.__filtered__||c,p}}),Pr(["head","last"],function(e,i){var o="take"+(i?"Right":"");Oe.prototype[e]=function(){return this[o](1).value()[0]}}),Pr(["initial","tail"],function(e,i){var o="drop"+(i?"":"Right");Oe.prototype[e]=function(){return this.__filtered__?new Oe(this):this[o](1)}}),Oe.prototype.compact=function(){return this.filter(fr)},Oe.prototype.find=function(e){return this.filter(e).head()},Oe.prototype.findLast=function(e){return this.reverse().find(e)},Oe.prototype.invokeMap=Se(function(e,i){return typeof e=="function"?new Oe(this):this.map(function(o){return Ln(o,e,i)})}),Oe.prototype.reject=function(e){return this.filter(lo(he(e)))},Oe.prototype.slice=function(e,i){e=we(e);var o=this;return o.__filtered__&&(e>0||i<0)?new Oe(o):(e<0?o=o.takeRight(-e):e&&(o=o.drop(e)),i!==r&&(i=we(i),o=i<0?o.dropRight(-i):o.take(i-e)),o)},Oe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Oe.prototype.toArray=function(){return this.take(X)},Wr(Oe.prototype,function(e,i){var o=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),l=d[c?"take"+(i=="last"?"Right":""):i],p=c||/^find/.test(i);l&&(d.prototype[i]=function(){var w=this.__wrapped__,x=c?[1]:arguments,R=w instanceof Oe,z=x[0],k=R||be(w),K=function(xe){var Ae=l.apply(d,mi([xe],x));return c&&Z?Ae[0]:Ae};k&&o&&typeof z=="function"&&z.length!=1&&(R=k=!1);var Z=this.__chain__,ae=!!this.__actions__.length,le=p&&!Z,Ee=R&&!ae;if(!p&&k){w=Ee?w:new Oe(this);var fe=e.apply(w,x);return fe.__actions__.push({func:ao,args:[K],thisArg:r}),new Cr(fe,Z)}return le&&Ee?e.apply(this,x):(fe=this.thru(K),le?c?fe.value()[0]:fe.value():fe)})}),Pr(["pop","push","shift","sort","splice","unshift"],function(e){var i=$s[e],o=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var p=this.value();return i.apply(be(p)?p:[],l)}return this[o](function(w){return i.apply(be(w)?w:[],l)})}}),Wr(Oe.prototype,function(e,i){var o=d[i];if(o){var c=o.name+"";Me.call(ln,c)||(ln[c]=[]),ln[c].push({name:i,func:o})}}),ln[eo(r,ye).name]=[{name:"wrapper",func:r}],Oe.prototype.clone=Up,Oe.prototype.reverse=jp,Oe.prototype.value=Mp,d.prototype.at=p0,d.prototype.chain=g0,d.prototype.commit=y0,d.prototype.next=v0,d.prototype.plant=b0,d.prototype.reverse=w0,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=_0,d.prototype.first=d.prototype.head,An&&(d.prototype[An]=m0),d},cn=yp();wt?((wt.exports=cn)._=cn,Ge._=cn):Ce._=cn}).call(Yn)})(jc,jc.exports);var KS=Object.defineProperty,WS=Object.defineProperties,GS=Object.getOwnPropertyDescriptors,Of=Object.getOwnPropertySymbols,JS=Object.prototype.hasOwnProperty,QS=Object.prototype.propertyIsEnumerable,Cf=(n,t,r)=>t in n?KS(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,mo=(n,t)=>{for(var r in t||(t={}))JS.call(t,r)&&Cf(n,r,t[r]);if(Of)for(var r of Of(t))QS.call(t,r)&&Cf(n,r,t[r]);return n},YS=(n,t)=>WS(n,GS(t));function Fr(n,t,r){let s;const a=Mc(n);return t.rpcMap&&(s=t.rpcMap[a]),s||(s=`${VS}?chainId=eip155:${a}&projectId=${r}`),s}function Mc(n){return n.includes("eip155")?Number(n.split(":")[1]):Number(n)}function Vd(n){return n.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function XS(n,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(n));if(!r.length)return[];const s=[];return r.forEach(a=>{const u=t.namespaces[a].accounts;s.push(...u)}),s}function ZS(n={},t={}){const r=Af(n),s=Af(t);return jc.exports.merge(r,s)}function Af(n){var t,r,s,a;const u={};if(!jS(n))return u;for(const[f,g]of Object.entries(n)){const E=ru(f)?[f]:g.chains,N=g.methods||[],T=g.events||[],j=g.rpcMap||{},G=Xn(f);u[G]=YS(mo(mo({},u[G]),g),{chains:Ec(E,(t=u[G])==null?void 0:t.chains),methods:Ec(N,(r=u[G])==null?void 0:r.methods),events:Ec(T,(s=u[G])==null?void 0:s.events),rpcMap:mo(mo({},j),(a=u[G])==null?void 0:a.rpcMap)})}return u}function ex(n){return n.includes(":")?n.split(":")[2]:n}function tx(n){const t={};for(const[r,s]of Object.entries(n)){const a=s.methods||[],u=s.events||[],f=s.accounts||[],g=ru(r)?[r]:s.chains?s.chains:Vd(s.accounts);t[r]={chains:g,methods:a,events:u,accounts:f}}return t}function Ic(n){return typeof n=="number"?n:n.includes("0x")?parseInt(n,16):n.includes(":")?Number(n.split(":")[1]):Number(n)}const Kd={},It=n=>Kd[n],Sc=(n,t)=>{Kd[n]=t};class rx{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Fr(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(Ri.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Fr(t,this.namespace);return typeof s>"u"?void 0:new Ai(new Qi(s,It("disableProviderPing")))}}class ix{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=It("events"),this.client=It("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){const s=Mc(t);if(!this.httpProviders[s]){const a=r||Fr(`${this.name}:${s}`,this.namespace,this.client.core.projectId);if(!a)throw new Error(`No RPC url provided for chainId: ${s}`);this.setHttpProvider(s,a)}this.chainId=s,this.events.emit(Ri.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Fr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ai(new Qi(s,It("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Mc(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class nx{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(!this.httpProviders[t]){const s=r||Fr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.chainId=t,this.events.emit(Ri.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Fr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ai(new Qi(s,It("disableProviderPing")))}}class sx{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Fr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(Ri.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Fr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ai(new Qi(s,It("disableProviderPing")))}}class ox{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(Ri.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r);t[r]=this.createHttpProvider(r,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);return typeof s>"u"?void 0:new Ai(new Qi(s,It("disableProviderPing")))}}class ax{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(!this.httpProviders[t]){const s=r||Fr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.chainId=t,this.events.emit(Ri.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Fr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ai(new Qi(s,It("disableProviderPing")))}}class cx{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=It("events"),this.client=It("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(!this.httpProviders[t]){const s=r||Fr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.chainId=t,this.events.emit(Ri.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Fr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ai(new Qi(s,It("disableProviderPing")))}}var ux=Object.defineProperty,hx=Object.defineProperties,lx=Object.getOwnPropertyDescriptors,Rf=Object.getOwnPropertySymbols,fx=Object.prototype.hasOwnProperty,dx=Object.prototype.propertyIsEnumerable,Tf=(n,t,r)=>t in n?ux(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,bo=(n,t)=>{for(var r in t||(t={}))fx.call(t,r)&&Tf(n,r,t[r]);if(Rf)for(var r of Rf(t))dx.call(t,r)&&Tf(n,r,t[r]);return n},xc=(n,t)=>hx(n,lx(t));class iu{constructor(t){this.events=new Bt,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Re.pino(Re.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||xf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new iu(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:bo({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){this.request(t,s).then(a=>r(null,a)).catch(a=>r(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:wf("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=tx(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==kd)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(_f(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await NS.init({logger:this.providerOpts.logger||xf,relayUrl:this.providerOpts.relayUrl||kS,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Xn(r)))];Sc("client",this.client),Sc("events",this.events),Sc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=XS(r,this.session),a=Vd(s),u=ZS(this.namespaces,this.optionalNamespaces),f=xc(bo({},u[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new ix({namespace:f});break;case"solana":this.rpcProviders[r]=new nx({namespace:f});break;case"cosmos":this.rpcProviders[r]=new sx({namespace:f});break;case"polkadot":this.rpcProviders[r]=new rx({namespace:f});break;case"cip34":this.rpcProviders[r]=new ox({namespace:f});break;case"elrond":this.rpcProviders[r]=new ax({namespace:f});break;case"multiversx":this.rpcProviders[r]=new cx({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&_f(a)&&this.events.emit("accountsChanged",a.map(ex))}else if(s.name==="chainChanged"){const a=r.chainId,u=r.event.data,f=Xn(a),g=Ic(a)!==Ic(u)?`${f}:${Ic(u)}`:a;this.onChainChanged(g)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,u=(s=this.client)==null?void 0:s.session.get(t);this.session=xc(bo({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",xc(bo({},wf("USER_DISCONNECTED")),{data:t.topic}))}),this.on(Ri.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(f=>Xn(f)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=Xn(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,u]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(u),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${Pf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${Pf}/${t}`)}}const px=iu,gx="wc",yx="ethereum_provider",vx=`${gx}@2:${yx}:`,mx="https://rpc.walletconnect.com/v1/",qc=["eth_sendTransaction","personal_sign"],bx=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],zc=["chainChanged","accountsChanged"],wx=["message","disconnect","connect"];var _x=Object.defineProperty,Ex=Object.defineProperties,Ix=Object.getOwnPropertyDescriptors,Nf=Object.getOwnPropertySymbols,Sx=Object.prototype.hasOwnProperty,xx=Object.prototype.propertyIsEnumerable,$f=(n,t,r)=>t in n?_x(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Zn=(n,t)=>{for(var r in t||(t={}))Sx.call(t,r)&&$f(n,r,t[r]);if(Nf)for(var r of Nf(t))xx.call(t,r)&&$f(n,r,t[r]);return n},Ff=(n,t)=>Ex(n,Ix(t));function Ro(n){return Number(n[0].split(":")[1])}function Pc(n){return`0x${n.toString(16)}`}function Px(n){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:u,optionalEvents:f,rpcMap:g}=n;if(!Oc(t))throw new Error("Invalid chains");const E={chains:t,methods:s||qc,events:u||zc,rpcMap:Zn({},t.length?{[Ro(t)]:g[Ro(t)]}:{})},N=u==null?void 0:u.filter(J=>!zc.includes(J)),T=s==null?void 0:s.filter(J=>!qc.includes(J));if(!r&&!f&&!a&&!(N!=null&&N.length)&&!(T!=null&&T.length))return{required:t.length?E:void 0};const j=(N==null?void 0:N.length)&&(T==null?void 0:T.length)||!r,G={chains:[...new Set(j?E.chains.concat(r||[]):r)],methods:[...new Set(E.methods.concat(a!=null&&a.length?a:bx))],events:[...new Set(E.events.concat(f||wx))],rpcMap:g};return{required:t.length?E:void 0,optional:r.length?G:void 0}}class nu{constructor(){this.events=new Bt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=vx,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new nu;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=Px(this.rpc);try{const a=await new Promise(async(f,g)=>{var E;this.rpc.showQrModal&&((E=this.modal)==null||E.subscribeModal(N=>{!N.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Ff(Zn({namespaces:Zn({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(N=>{f(N)}).catch(N=>{g(new Error(N.message))})});if(!a)return;const u=z1(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:Pc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Pc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Ff(Zn({},B1("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Pc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],u=(s=t==null?void 0:t.optionalChains)!=null?s:[],f=a.concat(u);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=a.length?(t==null?void 0:t.methods)||qc:[],E=a.length?(t==null?void 0:t.events)||zc:[],N=(t==null?void 0:t.optionalMethods)||[],T=(t==null?void 0:t.optionalEvents)||[],j=(t==null?void 0:t.rpcMap)||this.buildRpcMap(f,t.projectId),G=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(J=>this.formatChainId(J)),optionalChains:u.map(J=>this.formatChainId(J)),methods:g,events:E,optionalMethods:N,optionalEvents:T,rpcMap:j,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:G,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Ro(this.rpc.chains):Ro(this.rpc.optionalChains),this.signer=await px.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await k1(()=>import("./index-ebaac700.js").then(a=>a.i),["assets/index-ebaac700.js","assets/app-0b588ede.js","assets/index-d08623ec.js","assets/553dfaf1b2580ee0aaf77dd5d8550a208ebdc2715e468c65082ee71fbd9fef73.css"]);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Zn({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&Oc(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),s&&Oc(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${mx}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const qx=nu;export{qx as EthereumProvider,wx as OPTIONAL_EVENTS,bx as OPTIONAL_METHODS,zc as REQUIRED_EVENTS,qc as REQUIRED_METHODS,nu as default};
